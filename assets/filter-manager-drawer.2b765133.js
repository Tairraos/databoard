import{e as T,Y as $,aD as L,b7 as O,b8 as P,b2 as q,b3 as x,I,J as N,x as S,aI as z,a4 as J,bV as M,r as U,aq as c,o as E,s as k,w as F,j as w,h as g,K as V,p as j,f as K,O as W,L as Y}from"./App.50392300.js";import{I as G}from"./warning.48f82ac3.js";import{I as H}from"./document.93a18ff6.js";import{F as Q,f as R}from"./filter-collapse-item.50a244eb.js";import"./arrow-left.f404f0ed.js";import"./edit.5eaf138a.js";import"./delete.b13af974.js";import"./release.3d8d837e.js";import"./drag.0397a33d.js";import"./config.3c16c364.js";const X=T({name:"FilterManagerDrawer",components:{IconDocument:H,FilterCollapseItem:Q},setup(){const a=$(),d=L(),h=O(),p=P(),r=q(),y=x(),_=I(!1),i=I(null);N(()=>h.filter.show,e=>{_.value=e}),N(_,e=>{e||(h.filter.show=!1)});const v=S(()=>p.dataFilters),f=S(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(t=>{for(const n in t.apiData)t.apiData[n].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(t.id),e[s.id].names.push(t.alias)):e[s.id]={ids:[t.id],names:[t.alias]}})}),e}),D=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:y.screen.id,createAt:"",updateAt:""})};return z(R,{usedFilters:f,editFilterName:(e,o)=>{const t=e.trim();t&&o.name!==t&&(o.name=t,o.id>0&&p.updateName(o))},removeFilter:e=>{if(e>0){const o=d.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>J(G),onPositiveClick:async()=>{o.loading=!0;try{await p.delete(e);const t=f.value[e];t&&[...r.coms,...r.subComs].filter(n=>t.ids.includes(n.id)).forEach(n=>{for(const m in n.apiData){const s=m,u=n.apiData[s],b=u.pageFilters.find(C=>C.id===e);u.pageFilters=u.pageFilters.filter(C=>C.id!==e),b&&b.enabled&&M(n.id,s,n.apis[s],u)}})}catch(t){a.error(t.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await p.update(e);const o=f.value[e.id];o&&[...r.coms,...r.subComs].filter(t=>o.ids.includes(t.id)).forEach(t=>{for(const n in t.apiData){const m=n,s=t.apiData[m],u=s.pageFilters.find(b=>b.id===e.id);u&&u.enabled&&M(t.id,m,t.apis[m],s)}})}else await p.create(e),i.value=null}}),{visible:_,dataFilters:v,newDataFilter:i,addFilter:D}}});const Z={class:"filter-manager-title"},ee=g("span",null,"\u5E2E\u52A9\u6587\u6863",-1),te={key:1,class:"panel-info"},ae=g("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1);function se(a,d,h,p,r,y){const _=c("IconDocument"),i=c("n-icon"),v=c("router-link"),f=c("filter-collapse-item"),D=c("n-button"),A=c("n-drawer-content"),B=c("n-drawer");return E(),k(B,{show:a.visible,"onUpdate:show":d[1]||(d[1]=l=>a.visible=l),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp","show-mask":""},{default:F(()=>[w(A,{closable:""},{header:F(()=>[g("p",Z,[V(" \u6570\u636E\u8FC7\u6EE4\u5668"),g("span",{class:"create-filter",onClick:d[0]||(d[0]=(...l)=>a.addFilter&&a.addFilter(...l))},"\u65B0\u5EFA"),w(v,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:F(()=>[w(i,{size:12},{default:F(()=>[w(_)]),_:1}),ee]),_:1})])]),default:F(()=>[a.newDataFilter?(E(),k(f,{key:0,"data-filter":a.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):j("",!0),(E(!0),K(Y,null,W(a.dataFilters,l=>(E(),k(f,{key:l.id,"data-filter":l,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),a.dataFilters.length===0&&!a.newDataFilter?(E(),K("div",te,[ae,w(D,{focusable:!1,onClick:a.addFilter},{default:F(()=>[V(" \u65B0\u5EFA ")]),_:1},8,["onClick"])])):j("",!0)]),_:1})]),_:1},8,["show"])}const me=U(X,[["render",se]]);export{me as default};
