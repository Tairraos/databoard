var Ie=Object.defineProperty;var Re=(e,t,n)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Y=(e,t,n)=>(Re(e,typeof t!="symbol"?t+"":t,n),n);import{r as Z,o as F,f as q,h as $,e as J,b9 as ie,x,n as I,p as Me,I as z,bF as Te,aj as Ee,al as Xe,aq as N,s as se,w as ye,j as oe,bj as te,bG as Be,t as pe,bH as Ye,b8 as Le,bI as Fe,a4 as M,z as j,bB as De,bJ as He,bd as We,bk as xe,J as Oe,bK as Ae,bh as Ge,bL as Ve,L as je,O as Ne,as as qe,at as Ze}from"./App.6555cd13.js";import{c as Je}from"./index.8fbef3df.js";import{a as P,o as L,b as _,c as Ke}from"./dom.554d1048.js";import{u as _e}from"./index.a9f93a13.js";import"./templates.d735a5d3.js";import"./warning.088cc602.js";const Ue={},Qe={t:"1639130833808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},Pe=$("path",{d:"M341.33333333 579.33333333C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c85.336 0 170.664 58 256 174C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-85.336 0-170.664-48.664-256-146z m96-5.6C490.66933333 632.13333333 543.99733333 661.33333333 597.33333333 661.33333333s106.664-29.2 160-87.6C703.99733333 504.13333333 650.66933333 469.33333333 597.33333333 469.33333333s-106.664 34.8-160 104.4zM597.33333333 629.33333333a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"3986"},null,-1),et=[Pe];function tt(e,t){return F(),q("svg",Qe,et)}const nt=Z(Ue,[["render",tt]]),st={},ot={t:"1639130872871",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4135",width:"64",height:"64"},at=$("path",{d:"M651.14133333 413.01333333l-56.344 56.344C542.30933333 470.45333333 489.82133333 505.23733333 437.33333333 573.73333333a416 416 0 0 0 26.48 26.6l-49.976 49.984c-24.168-19.76-48.336-43.416-72.504-70.984C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c17.936 0 35.872 2.56 53.808 7.68z m113.968 67.056c29.408 26.2 58.816 59.28 88.224 99.264C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-22.456 0-44.92-3.368-67.376-10.112l54.456-54.456c4.304 0.376 8.616 0.568 12.92 0.568 53.336 0 106.664-29.2 160-87.6-13.368-17.44-26.736-32.704-40.112-45.784l47.888-47.88zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"4136"},null,-1),it=$("path",{d:"M770.34933333 339.06133333l45.256 45.256-407.288 407.288-45.256-45.256z","p-id":"4137"},null,-1),lt=[at,it];function rt(e,t){return F(),q("svg",ot,lt)}const ct=Z(st,[["render",rt]]),dt=J({name:"AlignLine",setup(){const e=ie();return{alignLine:x(()=>e.alignLine),canvas:x(()=>e.canvas)}}});const ut={key:0,class:"ident-line-wp"};function ht(e,t,n,o,s,a){return e.alignLine.enable&&e.alignLine.show?(F(),q("div",ut,[$("div",{class:"ident-line x-line",style:I({width:`${e.canvas.width}px`,top:`${e.alignLine.top}px`})},null,4),$("div",{class:"ident-line x-line",style:I({width:`${e.canvas.width}px`,top:`${e.alignLine.horizontal}px`})},null,4),$("div",{class:"ident-line x-line",style:I({width:`${e.canvas.width}px`,top:`${e.alignLine.bottom}px`})},null,4),$("div",{class:"ident-line y-line",style:I({height:`${e.canvas.height}px`,left:`${e.alignLine.left}px`})},null,4),$("div",{class:"ident-line y-line",style:I({height:`${e.canvas.height}px`,left:`${e.alignLine.vertical}px`})},null,4),$("div",{class:"ident-line y-line",style:I({height:`${e.canvas.height}px`,left:`${e.alignLine.right}px`})},null,4)])):Me("",!0)}const ft=Z(dt,[["render",ht],["__scopeId","data-v-5c5ebe5b"]]),ne=e=>`${e}px`,we=(e,t,n,o)=>{const s=e!=null?e:document.createElement("canvas");s.width=t*o,s.height=n*o,s.style.width=ne(t),s.style.height=ne(n);const a=s.getContext("2d");return a&&a.setTransform(o,0,0,o,0,0),s},Se=(e,t,n,o)=>{var h,v;const s=parseFloat(e.style.transform.match(new RegExp("(?<=X\\()(.+)","ig"))[0]),{height:a,scale:r,offset:c}=t;let i=0;return t.direction=="TB"?i=n-(((h=e.parentElement)==null?void 0:h.offsetLeft)||0)-s:i=o-(((v=e.parentElement)==null?void 0:v.offsetTop)||0)-s,i=i-a+t.indicatorLineWidth,{coor:Math.floor((i-c)/r),dist:i}},mt=(e,t)=>{const{scale:n,offset:o}=t;return{coor:e,dist:parseFloat((e*n+o).toFixed(3))}},ae=class{constructor(t,n,o,s=0){Y(this,"guideLine");Y(this,"coor",-1);this.el=t,this.options=n,this.constructGuide(o,s)}constructGuide(t,n){const{el:o}=this,s=document.createElement("div");s.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",P(s,"ruler-line"),this.guideLine=s;const{coor:a}=this;this.setLine(t,n),t&&this.coorChange("add",this.coor,a);let r=o.querySelector(".lines-wrapper");r||(r=document.createElement("div"),P(r,"lines-wrapper"),o.appendChild(r)),r.appendChild(s),L(s,"mousedown",this.moving.bind(this)),L(s,"dblclick",this.dblclick.bind(this))}moving(t){ae.isMoveing=!0;const{options:n}=this;t.preventDefault(),t.stopPropagation();const{coor:o}=this,s=r=>{n.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(r)},a=()=>{ae.isMoveing=!1,document.body.style.cursor="",_(document,"mousemove",s),_(document,"mouseup",a);const{coor:r}=this;r<0?this.coorChange("delete",o,o):this.coorChange("update",r,o)};L(document,"mousemove",s),L(document,"mouseup",a)}setLine(t,n=0){const{el:o,options:s,guideLine:a}=this,r=t?Se(o,s,t.clientX,t.clientY):mt(n,s);s.direction==="TB"?a.style.left=ne(r.dist):a.style.top=ne(r.dist),a.innerHTML=`
      <div class="line-action">
        <span class="line-value">${r.coor}</span>
      </div>`,this.coor=r.coor}dblclick(t){t.preventDefault(),t.stopPropagation(),this.destroy()}coorChange(t,n,o){const{options:s}=this;s.coorChange&&s.coorChange(t,n,o)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:t,coor:n}=this;this.coorChange("delete",n,n),_(t,"mousedown",this.moving.bind(this)),_(t,"dblclick",this.dblclick.bind(this)),t.remove()}};let K=ae;Y(K,"isMoveing",!1);class $e{constructor(t,n){Y(this,"el");Y(this,"canvas");Y(this,"ctx");Y(this,"ruler",{width:0,height:0});Y(this,"indicator");Y(this,"indicatorValue");Y(this,"guideLines",[]);Y(this,"options",{direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2});this.el=t,this.options={...this.options,...n},this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:o,width:s,height:a,ratio:r}=n,c=Math.max(o==="TB"?t.offsetWidth:t.offsetHeight,s),i=a;this.ruler.width=c,this.ruler.height=i;const f=we(null,c,i,r);P(f,"canvas-ruler"),t.appendChild(f),this.canvas=f,this.ctx=f.getContext("2d"),this.drawRuler(),L(f,"mouseenter",this.constructIndicator.bind(this)),L(f,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,s,a),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o,{offset:r,scale:c}=n,i=0,f=a/1.5,h=a/1.2;for(let v=0;v<=s;v+=1){const g=v-r;if(g<0)continue;let b=-1,w=-1;g%50===0?(b=Math.floor(g/c),w=i):g%25===0?w=f:g%5===0&&(w=h),w>=0&&(t.moveTo(v+.5,a+.5),t.lineTo(v+.5,w),b>-1&&t.fillText(`${b}`,v+2.5,a/1.5))}}constructIndicator(t){if(K.isMoveing)return;const{el:n,options:o,canvas:s}=this,a=document.createElement("div"),r=document.createElement("span");P(a,"ruler-indicator"),P(r,"indicator-value"),a.appendChild(r),this.indicator=a,this.indicatorValue=r,n.appendChild(a);const c=h=>{const v=Se(n,o,h.clientX,h.clientY);a.style.left=ne(v.dist),r.textContent=`${v.coor}`};c(t);const i=h=>{c(h)},f=()=>{_(s,"mousemove",i),_(s,"mouseout",f),a.remove()};L(s,"mousemove",i),L(s,"mouseout",f)}createGuideLine(t){t.preventDefault(),t.stopPropagation();const{el:n,options:o}=this;this.guideLines.push(new K(n,o,t))}setGuideLines(t){const{el:n,options:o}=this;t.forEach(s=>{this.guideLines.push(new K(n,o,null,s))})}setSize(t,n,o){const{el:s,options:a}=this;a.width=t,a.height=n,a.scale=o;const{direction:r,width:c,height:i,ratio:f}=a,h=Math.max(r==="TB"?s.offsetWidth:s.offsetHeight,c),v=i;this.ruler.width=h,this.ruler.height=v,we(this.canvas,h,v,f),this.drawRuler(),this.guideLines.forEach(g=>g.setLine(null,g.coor))}setScale(t){this.options.scale=t,this.drawRuler(),this.guideLines.forEach(n=>n.setLine(null,n.coor))}toggleGuide(t){const n=t?"show":"hide";this.guideLines.forEach(o=>o[n]())}clearGuides(){this.guideLines.forEach(t=>t.destroy()),this.guideLines=[]}destroy(){const{el:t,canvas:n}=this;this.clearGuides(),_(n,"mouseenter",this.constructIndicator.bind(this)),_(n,"mousedown",this.createGuideLine.bind(this)),t.remove()}}const vt=J({name:"Ruler",components:{IconLineShow:nt,IconLineHide:ct},setup(){const e=ie(),t=z(null),n=z(null),o=z(null),s=z(null),a=z(!0),r=z(0),c=z(0),i=document.documentElement.clientWidth;Te(()=>{if(t.value&&n.value){const{canvas:v,guideLine:g}=e,b=Math.max(v.width,i);o.value?o.value.setSize(b,20,v.scale):(o.value=new $e(t.value,{direction:"TB",width:b,scale:v.scale,coorChange:(w,p,W)=>{w==="add"?g.h.push(p):w==="update"&&p!==W?(g.h=g.h.filter(D=>D!==W),g.h.push(p)):w==="delete"&&(g.h=g.h.filter(D=>D!==p))}}),o.value.setGuideLines(g.h)),s.value?s.value.setSize(v.height,20,v.scale):(s.value=new $e(n.value,{direction:"LR",width:v.height,scale:v.scale,coorChange:(w,p,W)=>{w==="add"?g.v.push(p):w==="update"&&p!==W?(g.v=g.v.filter(D=>D!==W),g.v.push(p)):w==="delete"&&(g.v=g.v.filter(D=>D!==p))}}),s.value.setGuideLines(g.v))}});const f=()=>{o.value&&s.value&&(a.value=!a.value,o.value.toggleGuide(a.value),s.value.toggleGuide(a.value))},h=v=>{const g=v.target;r.value=g.scrollLeft,c.value=g.scrollTop};return Ee(()=>{const v=document.getElementById("canvas-wp");v==null||v.addEventListener("scroll",h)}),Xe(()=>{const v=document.getElementById("canvas-wp");v==null||v.removeEventListener("scroll",h)}),{visible:a,hRulerWpRef:t,vRulerWpRef:n,toggleGuides:f,vScroll:c,hScroll:r}}});const gt={class:"canvas-ruler-wp"};function yt(e,t,n,o,s,a){const r=N("IconLineShow"),c=N("n-icon"),i=N("IconLineHide");return F(),q("div",gt,[$("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:I(`transform: translateX(-${e.hScroll}px);`)},null,4),$("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:I(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),$("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:t[0]||(t[0]=(...f)=>e.toggleGuides&&e.toggleGuides(...f))},[e.visible?(F(),se(c,{key:0},{default:ye(()=>[oe(r)]),_:1})):(F(),se(c,{key:1},{default:ye(()=>[oe(i)]),_:1}))])])}const pt=Z(vt,[["render",yt]]),xt={class:"canvas-selection"},wt=["d"],$t=J({__name:"canvas-area",props:{startX:{type:Number,default:0},startY:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0}},setup(e){return(t,n)=>(F(),q("svg",xt,[$("path",{fill:"none",stroke:"rgba(255,255,255,0.5)",d:`M ${e.startX},${e.startY} L ${e.startX},${e.startY+e.height} L ${e.startX+e.width},${e.startY+e.height} L ${e.startX+e.width},${e.startY} Z`,style:{"stroke-width":"1","stroke-dasharray":"3, 3"}},null,8,wt)]))}});const bt=Z($t,[["__scopeId","data-v-5262200c"]]),Ct=[{direction:"lt",angle:0,cursor:"nwse-resize",singleCursor:"nw-resize"},{direction:"t",angle:45,cursor:"ns-resize",singleCursor:"n-resize"},{direction:"rt",angle:90,cursor:"nesw-resize",singleCursor:"ne-resize"},{direction:"r",angle:135,cursor:"ew-resize",singleCursor:"e-resize"},{direction:"rb",angle:180,cursor:"nwse-resize",singleCursor:"se-resize"},{direction:"b",angle:225,cursor:"ns-resize",singleCursor:"s-resize"},{direction:"lb",angle:270,cursor:"nesw-resize",singleCursor:"sw-resize"},{direction:"l",angle:315,cursor:"ew-resize",singleCursor:"w-resize"}],be=[{start:338,end:23,cursor:"nwse-resize",singleCursor:"nw-resize"},{start:23,end:68,cursor:"ns-resize",singleCursor:"n-resize"},{start:68,end:113,cursor:"nesw-resize",singleCursor:"ne-resize"},{start:113,end:158,cursor:"ew-resize",singleCursor:"e-resize"},{start:158,end:203,cursor:"nwse-resize",singleCursor:"se-resize"},{start:203,end:248,cursor:"ns-resize",singleCursor:"s-resize"},{start:248,end:293,cursor:"nesw-resize",singleCursor:"sw-resize"},{start:293,end:338,cursor:"ew-resize",singleCursor:"w-resize"}],Mt=e=>{const t=(e+360)%360,n={};let o=-1;return Ct.forEach(s=>{const a=(s.angle+t)%360,r=be.length,c=0;for(;c<r;){o=(o+1)%r;const i=be[o];if(a<23||a>=338){n[s.direction]="nwse-resize";break}if(i.start<=a&&a<i.end){n[s.direction]=i.cursor;break}}}),n};function Lt(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}function ee(e,t,n){const o=Be(n);return{x:(e.x-t.x)*Math.cos(o)-(e.y-t.y)*Math.sin(o)+t.x,y:(e.x-t.x)*Math.sin(o)+(e.y-t.y)*Math.cos(o)+t.y}}function _t(e,t,n,o,s,a){const r=Lt(n,o),c=ee(o,r,-t.deg),i=ee(n,r,-t.deg);e[0]==="l"?(a.x=Math.round(i.x/s),a.w=Math.round((c.x-i.x)/s)):e[0]==="r"&&(a.x=Math.round(c.x/s),a.w=Math.round((i.x-c.x)/s)),e[1]==="t"?(a.y=Math.round(i.y/s),a.h=Math.round((c.y-i.y)/s)):e[1]==="b"&&(a.y=Math.round(c.y/s),a.h=Math.round((i.y-c.y)/s))}function St(e,t,n,o,s,a,r){const c=ee(o,n,-t.deg);if(e==="t"||e==="b"){const i=ee({x:n.x,y:c.y},n,t.deg),f=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(f>0){const h={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};r.h=Math.round(f/a),r.x=Math.round(h.x/a-t.w/2),r.y=Math.round((h.y-f/2)/a)}}if(e==="l"||e==="r"){const i=ee({x:c.x,y:n.y},n,t.deg),f=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(f>0){const h={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};r.w=Math.round(f/a),r.x=Math.round((h.x-f/2)/a),r.y=Math.round(h.y/a-t.h/2)}}}function zt(e,t,n,o,s,a){e==="t"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="rt"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="r"?a.w=Math.round(t.w+(o.x-n.x)/s):e==="rb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s)):e==="b"?a.h=Math.round(t.h+(o.y-n.y)/s):e==="lb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="l"?(a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="lt"&&(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s))}const kt=(e,t,n,o,s,a,r)=>{const c={...n.attr},i=Object.create(null);let f,h,v;const g={x:0,y:0};if(s)h={x:e.clientX,y:e.clientY};else{const p={x:(c.x+c.w/2)*o,y:(c.y+c.h/2)*o};f=document.getElementById("canvas-coms").getBoundingClientRect(),h={x:e.clientX-f.left,y:e.clientY-f.top},v={x:p.x-(h.x-p.x),y:p.y-(h.y-p.y)}}const b=p=>{s?(g.x=p.clientX,g.y=p.clientY,zt(t,c,h,g,o,i)):(g.x=p.clientX-f.left,g.y=p.clientY-f.top,t.length===1?St(t,c,h,g,v,o,i):_t(t,c,g,v,o,i)),i.x!=null&&(n.attr.x=i.x),i.y!=null&&(n.attr.y=i.y),i.w!=null&&(n.scaling.w=Math.max(10,i.w)),i.h!=null&&(n.scaling.h=Math.max(10,i.h)),a()},w=()=>{_(document,"mousemove",b),_(document,"mouseup",w),r()};L(document,"mousemove",b),L(document,"mouseup",w)},It=(e,t,n,o,s,a)=>{const{x:r,y:c}=t.attr,i=h=>{t.attr.x=r+Math.round((h.clientX-e.clientX)/n/o)*o,t.attr.y=c+Math.round((h.clientY-e.clientY)/n/o)*o,s()},f=()=>{_(document,"mousemove",i),_(document,"mouseup",f),a()};L(document,"mousemove",i),L(document,"mouseup",f)},Rt=(e,t,n,o)=>{const s=t.getBoundingClientRect(),a=s.left+s.width/2,r=s.top+s.height/2;let c=0;const i=Math.atan2(r-e.clientY,a-e.clientX)*180/Math.PI-n.attr.deg,f=v=>{const g=Math.atan2(r-v.clientY,a-v.clientX)*180/Math.PI-i;c=Math.round(g%360),n.attr.deg=c<0?c+360:c},h=()=>{_(document,"mousemove",f),_(document,"mouseup",h),o(c)};L(document,"mousemove",f),L(document,"mouseup",h)},ze=(e,t)=>{e.attr.deg=0,e.children.forEach(n=>{if(n.type===te.layer)ze(n,t);else{const o=Math.round((n.attr.deg+t)%360);n.attr.deg=o<0?o+360:o}})},Tt=J({name:"ReferLine",props:{pos:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(e){const o=x(()=>({height:`${e.pos.y+60/e.scale}px`,borderLeftWidth:`${.9/e.scale}px`})),s=x(()=>({width:`${e.pos.x+60/e.scale}px`,borderTopWidth:`${.9/e.scale}px`})),a=x(()=>({fontSize:`${12/e.scale}px`,top:`-${6/e.scale}px`,left:`-${6/e.scale}px`}));return{topLineStyle:o,leftLineStyle:s,accountStyle:a}}});const Et={class:"nav-line"};function Xt(e,t,n,o,s,a){return F(),q("div",Et,[$("div",{class:"nav-line-top",style:I(e.topLineStyle)},null,4),$("div",{class:"nav-line-left",style:I(e.leftLineStyle)},null,4),$("div",{class:"nav-line-account",style:I(e.accountStyle)},pe(e.pos.x)+", "+pe(e.pos.y),5)])}const Bt=Z(Tt,[["render",Xt],["__scopeId","data-v-750e08db"]]),Yt=J({name:"TransformLayer",props:{com:{type:Object,required:!0},parentCom:{type:Object},editable:Boolean},setup(e,t){Ye(e.com);const n=He(),o=ie(),s=Le(),{showMenu:a,hideMenu:r}=_e(),c=z(!1),i=x(()=>e.com.type===te.layer),f=x(()=>o.canvas.scale),h=x(()=>o.referLine),v=x(()=>{let{x:u,y:d}=e.com.attr;return T().coms.forEach(l=>{u+=l.attr.x,d+=l.attr.y}),{x:u,y:d}}),g=x(()=>({"datav-transform":!0,selected:e.com.selected,hided:e.com.hided,locked:e.com.locked})),b=x(()=>{const{x:u,y:d,w:m,h:l}=e.com.attr;return{top:0,left:0,width:`${m}px`,height:`${l}px`,transform:`translate(${u}px, ${d}px)`}}),w=x(()=>({"datav-scale":!0,hovered:e.com.hovered,"--relative-hovered":U.value.hovered})),p=x(()=>{const{zoom:u,sx:d,sy:m}=e.com.scaling,l=u?`scale(${d.toFixed(6)}, ${m.toFixed(6)})`:void 0;return i.value?{transform:l||"none"}:{display:e.com.hided?"none":"block",transform:l}}),W=x(()=>{const{hided:u,attr:d,scaling:m}=e.com,l={overflow:"visible",display:u?"none":"block",transform:`rotate(${d.deg}deg)`,opacity:d.opacity},{zoom:S,sx:E,sy:V}=m;return S&&(l.transform=`scale(${(1/E).toFixed(6)}, ${(1/V).toFixed(6)}) ${l.transform} scale(${E.toFixed(6)}, ${V.toFixed(6)})`),l}),D=x(()=>{const{selected:u,attr:d}=e.com,m={cursor:u?"move":"inherit"};if(i.value)d.apply3d&&(m.perspective=`${d.perspective}px`,m.perspectiveOrigin=`${d.perspectiveOrigin.x}% ${d.perspectiveOrigin.y}%`);else{const{zoom:l,sx:S,sy:E}=e.com.scaling;m.transform=l?`scale(${(1/S).toFixed(6)}, ${(1/E).toFixed(6)}) ${m.transform} scale(${S.toFixed(6)}, ${E.toFixed(6)})`:`rotate(${e.com.attr.deg}deg)`}return m}),le=x(()=>{const{hided:u,attr:d}=e.com,m=o.pageConfig.styleFilterParams;let l="";return m.enable&&(l=`hue-rotate(${m.hue}deg) contrast(${m.contrast}%) opacity(${m.opacity}%) saturate(${m.saturate}%) brightness(${m.brightness}%)`),{display:u?"none":"block",transform:`scaleX(${d.filpH?-1:1}) scaleY(${d.filpV?-1:1}) rotateZ(360deg)`,filter:l}}),re=x(()=>({width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`})),H=x(()=>Mt(e.com.attr.deg)),ce=x(()=>{const{zoom:u,sx:d,sy:m}=e.com.scaling,l=u?`scale(${1/d/f.value}, ${1/m/f.value})`:`scale(${1/f.value}, ${1/f.value})`;return{t:{name:"top",style:{cursor:H.value.t,transform:l}},rt:{name:"top-right",style:{cursor:H.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:l}},r:{name:"right",style:{cursor:H.value.r,transform:l}},rb:{name:"bottom-right",style:{cursor:H.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:l}},b:{name:"bottom",style:{cursor:H.value.b,transform:l}},lb:{name:"bottom-left",style:{cursor:H.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:l}},l:{name:"left",style:{cursor:H.value.l,transform:l}},lt:{name:"top-left",style:{cursor:H.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:l}}}}),U=x(()=>{var m;let u=(m=e.parentCom)==null?void 0:m.selected,d=!1;if(i.value&&!u){const l=Fe(e.com);u=l.hovered||l.selected,d=l.selected}return{hovered:u,selected:d}}),de=(u,d)=>{const m=(l,S)=>l===S?1:0;return`rotate3d(${m(u,"x")}, ${m(u,"y")}, ${m(u,"z")}, ${d}deg)`},ue=u=>{const{attr:d}=u,m={justifyContent:"center",alignItems:"center",display:"block",opacity:1,transform:"translate3d(0, 0, 0)",width:"auto",height:"auto",position:"absolute",transformOrigin:`${d.w/2+d.x}px ${d.h/2+d.y}`},{attr:l,config:S}=e.com;if(l.apply3d){const E=S.find(ke=>ke.transform3d.id===u.id),{rotate3d:V,scale3d:ge,translate3d:me}=E.transform3d;m.transform=`translate3d(${me.x}px, ${me.y}px, ${me.z}px) scale3d(${ge.x}, ${ge.y}, 1) ${de(V.axis,V.deg)}`}return m},he=()=>{e.parentCom?e.editable&&!e.com.selected&&(e.com.hovered=!0):e.com.selected||(e.com.hovered=!0)},y=()=>{e.com.hovered=!1},C=u=>{const d=De(u);(d||!e.com.selected)&&s.select(e.com.id,e.com.parentId,d)},R=u=>{if(e.parentCom&&!e.editable){const d=T(),m=d.editables.lastIndexOf(!1);a(u,d.coms[m])}else a(u,e.com)},O=u=>{if(e.parentCom&&!e.editable){const d=T(),m=d.editables.lastIndexOf(!1);d.instances[m].proxy.onMove(u)}else A(u)},A=u=>{if(o.contextMenu.show)return r(),!1;if(!e.com.selected)return Ke(u.target,"mouseup",C),!1;s.selectedComs.forEach(d=>{It(u,d,f.value,o.pageConfig.grid,()=>{e.com.id===d.id&&(c.value=!0,o.calcAlignLine(e.com))},()=>{if(e.com.id===d.id)if(c.value){c.value=!1,o.hideAlignLine(e.com.id);const m=T();m.coms.length>0&&s.resizeParents(m.coms)}else u.button===0&&s.select(e.com.id,e.com.parentId)})})},X=(u,d)=>{if(r(),!e.com.selected)return!1;const m=(l,S)=>{l.scaling.w=l.attr.w,l.scaling.h=l.attr.h,kt(u,d,l,f.value,S,()=>{l.scaling.zoom=!0,l.scaling.sx=l.scaling.w/l.attr.w,l.scaling.sy=l.scaling.h/l.attr.h},()=>{i.value&&s.resizeChildren(l),l.scaling.zoom=!1,l.scaling.sx=1,l.scaling.sy=1,l.attr.w=l.scaling.w,l.attr.h=l.scaling.h;const E=T();E.coms.length>0&&s.resizeParents(E.coms)})};s.selectedComs.length>1?s.selectedComs.forEach(l=>{m(l,!0)}):m(e.com,o.isNormalResizeMode)},k=u=>{r(),s.selectedComs.forEach(d=>{Rt(u,n.vnode.el,d,m=>{i.value&&ze(d,m)})})},T=()=>{const u=[],d=[],m=[],l=S=>{var V;const E=S.props.parentCom;E&&(u.push(E),d.push((V=S.props.editable)!=null?V:!1),m.push(S.parent),l(S.parent))};return l(n),{coms:u,editables:d,instances:m}},G=u=>{e.parentCom&&!e.editable&&(e.parentCom.selected?C(u):T().instances[0].proxy.selectCom(u))},B=u=>M("div",{key:u.id,class:"slider-item",style:ue(u)},{default:()=>t.slots.default({data:u,editable:U.value.selected})}),Q=()=>M("div",{class:"datav-com",style:le.value},{default:()=>[t.slots.default(),M("div",{class:"datav-wrapper-event-disable",style:re.value})]}),fe=(u,d)=>{const m=M("span",{class:"control-point",style:d.style,onMousedown:j(l=>{X(l,u)},["stop"])});return d.rotateStyle?M("i",{class:`${d.name}-handler`,"data-html2canvas-ignore":!0},M("span",{class:"rotate-handler",style:d.rotateStyle,onMousedown:j(l=>{k(l)},["stop"])},m)):M("i",{class:`${d.name}-handler`,"data-html2canvas-ignore":!0},m)},ve=()=>M("div",{class:{"transform-handler":!0,hided:!e.com.selected||e.com.locked},style:D.value},{default:()=>{let u=[];i.value?u=e.com.children.map(d=>B(d)):u.push(Q());for(const[d,m]of Object.entries(ce.value))u.push(fe(d,m));return u.push(M("div",{class:"transform-bg"})),u}});return{scale:f,referLine:h,referLinePos:v,transformClass:g,transformStyle:b,scaleClass:w,scaleStyle:p,createTransform:ve,createSlider:()=>M("div",{class:"datav-layer slider",style:W.value},ve()),onEnter:he,onLeave:y,onDown:O,onMove:A,selectCom:C,showContextMenu:R,selectInnerItem:G}},render(){const{scale:e,referLine:t,referLinePos:n}=this;return M("div",{class:this.transformClass,style:this.transformStyle},{default:()=>[t.enable&&this.$props.com.selected?M(Bt,{scale:e,pos:n}):null,M("div",{class:this.scaleClass,style:this.scaleStyle,onMouseenter:j(this.onEnter,["stop"]),onMouseleave:j(this.onLeave,["stop"]),onMousedown:j(this.onDown,["stop"]),onContextmenu:j(this.showContextMenu,["stop"]),onDblclick:j(this.selectInnerItem,["stop"]),onClick:j(()=>{},["stop"])},this.$props.com.type===te.layer?this.createSlider():this.createTransform())]})}});const Ce=Z(Yt,[["__scopeId","data-v-19713a14"]]),Ft=J({name:"DatavTransform",props:{com:{type:Object,required:!0}},setup(){const e=(t,n,o)=>t.type===te.com?M(Ce,{com:t,parentCom:n,editable:o},{default:()=>M(N(t.name),{com:t,style:{transform:"translateZ(0)",opacity:t.attr.opacity}})}):M(Ce,{com:t,parentCom:n,editable:o},{default:({data:s,editable:a})=>e(s,t,a)});return{create:e}},render(){return this.create(this.$props.com)}}),Dt=J({name:"CanvasMain",components:{AlignLine:ft,Ruler:pt,CanvasArea:bt,DatavTransform:Ft},setup(){const e=We(),t=Le(),n=ie(),{hideMenu:o}=_e(),{pageConfig:s,canvas:a}=xe(n),{coms:r}=xe(t),c=z(!1),i=z(0),f=z(0),h=z(0),v=z(0),g=z(0),b=z(0),w=60,p=60,W=x(()=>({width:`${a.value.width}px`,height:`${a.value.height}px`})),D=x(()=>({width:`${s.value.width}px`,height:`${s.value.height}px`,transform:`scale(${a.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${s.value.bgimage})`,backgroundColor:s.value.bgcolor})),le=async y=>{y.preventDefault();try{const C=y.dataTransfer.getData("text");if(C){e.addLoading();let R=await Je(C);const{scale:O}=a.value,{left:A,top:X}=e.getPanelOffset,k=document.getElementById("canvas-wp"),T=(k==null?void 0:k.scrollLeft)||0,G=(k==null?void 0:k.scrollTop)||0,B=(T+y.clientX-A)/O,Q=(G+y.clientY-X)/O;R.attr.x=Math.round(B-R.attr.w/2),R.attr.y=Math.round(Q-R.attr.h/2),await Ae(R),e.removeLoading()}}catch(C){Ge("dropToAddCom",C.message)}},re=y=>{y.preventDefault(),y.stopPropagation(),y.dataTransfer.dropEffect="copy"},H=y=>{const C=y.target;["canvas-panel","screen-shot","canvas-panel-wrap"].includes(C.className)?c.value=!0:c.value=!1},ce=()=>{c.value&&(c.value=!1,t.select(""))},U=()=>{g.value=0,b.value=0},de=()=>r.value.filter(y=>y.locked||y.hided||!y.hovered?(y.selected=!1,!1):(y.selected=!0,!0)),ue=()=>{const{scale:y}=a.value,C=(h.value-w)/y,R=(v.value-p)/y,O=g.value/y,A=b.value/y;r.value.forEach(X=>{if(X.locked||X.hided)return;const{x:k,y:T,w:G,h:B}=X.attr,Q={x:C,y:R,w:O,h:A},fe={x:k,y:T,w:G,h:B};X.hovered=Ve(Q,fe)})},he=y=>{if(c.value=!0,n.contextMenu.show)return c.value=!1,o(),!1;const C=document.getElementById("screen-wp");i.value=C.clientWidth,f.value=C.clientHeight;const R=C.getBoundingClientRect(),O=R.x,A=R.y,X=y.clientX,k=y.clientY;h.value=X-O,v.value=k-A;const T=B=>{B.clientX<X&&(h.value=B.clientX-O),B.clientY<k&&(v.value=B.clientY-A),g.value=Math.abs(B.clientX-X),b.value=Math.abs(B.clientY-k),ue(),c.value=!1},G=()=>{_(document,"mousemove",T),_(document,"mouseup",G),U(),de(),c.value&&H(y)};L(document,"mousemove",T),L(document,"mouseup",G)};return Oe(()=>n.canvas.scale,()=>{U(),o()}),{ComType:te,coms:r,canvasPanelStyle:D,screenShotStyle:W,selectionW:i,selectionH:f,areaStartX:h,areaStartY:v,areaWidth:g,areaHeight:b,dragOver:re,dropToAddCom:le,handleMouseDown:he,cancelSelected:ce}}});const Ht=e=>(qe("data-v-812ec0c1"),e=e(),Ze(),e),Wt={class:"canvas-main"},Ot=Ht(()=>$("div",{class:"thumbnail"},null,-1));function At(e,t,n,o,s,a){const r=N("datav-transform"),c=N("align-line"),i=N("ruler"),f=N("canvas-area");return F(),q("div",Wt,[$("div",{id:"canvas-wp",class:"canvas-panel-wrap",onClick:t[3]||(t[3]=(...h)=>e.cancelSelected&&e.cancelSelected(...h))},[$("div",{id:"screen-wp",class:"screen-shot",style:I(e.screenShotStyle),onMousedown:t[2]||(t[2]=(...h)=>e.handleMouseDown&&e.handleMouseDown(...h))},[$("div",{id:"canvas-coms",class:"canvas-panel",style:I(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...h)=>e.dragOver&&e.dragOver(...h)),onDrop:t[1]||(t[1]=(...h)=>e.dropToAddCom&&e.dropToAddCom(...h))},[(F(!0),q(je,null,Ne(e.coms,h=>(F(),se(r,{key:h.id,com:h},null,8,["com"]))),128))],36),oe(c),oe(i)],36),e.areaWidth>0||e.areaHeight>0?(F(),se(f,{key:0,"start-x":e.areaStartX,"start-y":e.areaStartY,width:e.areaWidth,height:e.areaHeight,style:I({width:`${e.selectionW}px`,height:`${e.selectionH}px`})},null,8,["start-x","start-y","width","height","style"])):Me("",!0)]),Ot])}const Ut=Z(Dt,[["render",At],["__scopeId","data-v-812ec0c1"]]);export{Ut as default};
