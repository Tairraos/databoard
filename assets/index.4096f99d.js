import{a6 as i,aa as y,ad as v,a4 as X,a9 as z,aA as L,a5 as P,bf as me,aX as t,ae as K,aV as a,aZ as c,ab as m,ah as $,a7 as G,aI as R,bc as Y,ak as J,ag as W,ac as N,aL as Z,b8 as ve,b9 as fe}from"./vendor.d49f6c0b.js";import{a as O,w as j,a2 as ge,J as x,C as ye,x as pe,$ as V,X as ke,Y as be}from"./AppRoot.e99935fe.js";import{I as Ce}from"./delete.72d54e44.js";import{I as we}from"./back.0296c12f.js";import{d as Q,e as q,b as he,c as xe,I as $e,a as Ie}from"./group.8affbec8.js";import{I as U}from"./hide.565acfe8.js";import{I as Me}from"./view-grid.d3d61ef7.js";import{u as ee}from"./index.9cf894d9.js";import{I as De}from"./arrow-right.db77a0c2.js";import"./dom.022ad87e.js";import"./warning.618daeb9.js";const Be={},Se={t:"1639130612954",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},Ee=v("path",{d:"M116.4921875 116.4921875l0 186.12132317 791.015625 0 0-186.12132317-791.015625 0zM860.9774817 256.08317987l-697.9549634 0 0-93.06066158 697.95496341 0 0 93.06066158zM116.4921875 581.79549619l791.015625 0 0-186.12132317-791.015625 0 0 186.12132317zM163.0225183 442.20450381l697.9549634 0 0 93.06066158-697.95496341 0 0-93.06066158zM116.4921875 860.9774817l791.015625 1e-8 0-186.12132317-791.015625 0 0 186.12132317zM163.0225183 721.38648933l697.9549634 0 0 93.0606616-697.95496341 0 0-93.0606616z","p-id":"3986"},null,-1),Le=[Ee];function Te(o,w){return i(),y("svg",Se,Le)}var Ge=O(Be,[["render",Te]]);const Fe=X({name:"LayerManagerWrap",props:{rank:{type:Number,default:3}},setup(o,w){const d=j(),b=(f,p,g)=>{const I={com:f,idx:p,level:g};return g<o.rank&&f.children&&!f.fold?[w.slots.default(I),...h(f.children,g+1)]:w.slots.default(I)},h=(f,p)=>{const g=f.length-1;return f.map((I,B)=>b(f[g-B],B,p))};return()=>h(d.coms,0)}});const He=["title"],Ve={key:2,class:"layer-item-span"},ze={class:"layer-manager-thumbail"},Ne={class:"layer-thumbail-item"},_e=["onMouseup"],Ae=X({__name:"layer-manager-item",props:{com:null,level:null,showText:{type:Boolean}},emits:["dragGroup"],setup(o,{emit:w}){const d=o,{showMenu:b}=ee(),h=z(!1),f=L(()=>ge(d.com)),p=k=>{d.com.renameing=k===1},g=k=>{d.com.hovered=d.com.selected?!1:k===1},I=k=>{d.com.hided=k===1},B=k=>{d.com.locked=k===1},_=()=>{d.com.fold=!d.com.fold},A=()=>{d.com.type===x.layer&&(h.value=!0,w("dragGroup",{key:"enter"}))},S=()=>{d.com.type===x.layer&&(h.value=!1,w("dragGroup",{key:"leave"}))},F=()=>{d.com.type===x.layer&&(h.value=!1,w("dragGroup",{key:"drop",level:d.level+1,com:d.com.children[0]}))};return(k,e)=>{const C=P("n-icon"),E=P("g-com-icon"),H=me("focus");return i(),y("div",{title:o.com.alias,class:m({"layer-manager-com":o.com.type===t(x).com,"layer-manager-group":o.com.type===t(x).layer,"layer-manager-item":!0,"layer-manager-thumbail-wrap":!o.showText,"--child-hovered":t(f).hovered||h.value,"--child-selected":t(f).selected,hided:o.com.hided,locked:o.com.locked,hovered:o.com.hovered}),style:N({paddingLeft:`${6+o.level*10}px`}),draggable:"true",onMouseenter:e[12]||(e[12]=r=>g(1)),onMouseleave:e[13]||(e[13]=r=>g(0)),onContextmenu:e[14]||(e[14]=r=>t(b)(r,o.com))},[o.com.type===t(x).layer?(i(),y(K,{key:0},[a(C,{class:m(["fold-toggle-btn",{"icon-fold":o.com.fold}])},{default:c(()=>[a(t(De))]),_:1},8,["class"]),a(C,{class:"layer-item-icon"},{default:c(()=>[a(t(Q))]),_:1})],64)):$("",!0),o.showText?(i(),y(K,{key:1},[o.com.type===t(x).com?(i(),G(E,{key:0,icon:o.com.icon},null,8,["icon"])):$("",!0),o.com.renameing?R((i(),y("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=r=>o.com.alias=r),class:"layer-item-input",onBlur:e[1]||(e[1]=r=>p(0)),onKeydown:e[2]||(e[2]=J(r=>p(0),["enter"]))},null,544)),[[Y,o.com.alias,void 0,{trim:!0}],[H]]):(i(),y("span",Ve,[v("span",{class:"layer-item-text",onDblclick:e[3]||(e[3]=r=>p(1))},W(o.com.alias),33)])),o.com.hided?(i(),G(C,{key:3,class:"show-toggle-btn",onClick:e[4]||(e[4]=r=>I(0))},{default:c(()=>[a(t(U))]),_:1})):$("",!0),o.com.locked?(i(),G(C,{key:4,class:"show-toggle-btn",onClick:e[5]||(e[5]=r=>B(0))},{default:c(()=>[a(t(q))]),_:1})):$("",!0)],64)):(i(),y(K,{key:2},[o.com.type===t(x).com?(i(),y("div",{key:0,class:"layer-item-thumbail",style:N(`background-image: url(${o.com.img})`)},null,4)):$("",!0),v("div",ze,[o.com.renameing?R((i(),y("input",{key:0,"onUpdate:modelValue":e[6]||(e[6]=r=>o.com.alias=r),class:"layer-item-input",onBlur:e[7]||(e[7]=r=>p(0)),onKeydown:e[8]||(e[8]=J(r=>p(0),["enter"]))},null,544)),[[Y,o.com.alias,void 0,{trim:!0}],[H]]):(i(),y("span",{key:1,class:"layer-item-span",onDragenter:A,onDragleave:S,onDrop:F},[v("span",{class:"layer-item-text",onDblclick:e[9]||(e[9]=r=>p(1))},W(o.com.alias),33)],32))]),v("div",Ne,[o.com.hided?(i(),G(C,{key:0,class:"show-toggle-btn",onClick:e[10]||(e[10]=r=>I(0))},{default:c(()=>[a(t(U))]),_:1})):$("",!0),o.com.locked?(i(),G(C,{key:1,class:"show-toggle-btn",onClick:e[11]||(e[11]=r=>B(0))},{default:c(()=>[a(t(q))]),_:1})):$("",!0)])],64)),o.com.type===t(x).layer?(i(),y("div",{key:3,class:"group-fold-controller",style:N({width:`${o.level>0?50:40}px`,transform:`translateX(-${6+o.level*10}px)`}),onMouseup:Z(_,["stop"])},null,44,_e)):$("",!0)],46,He)}}});var Ke=O(Ae,[["__scopeId","data-v-543aeddb"]]);const te=o=>(ve("data-v-853bc1ec"),o=o(),fe(),o),Pe={class:"layer-manager"},qe={class:"layer-manager-top"},Ue=te(()=>v("div",{class:"layer-num"},"\u56FE\u5C42",-1)),Xe={class:"layer-layout"},Oe={class:"layer-toolbar layer-toolbar-top"},Re={class:"layer-manager-wrap"},Ye=te(()=>v("div",{class:"draging-wrap"},null,-1)),Je={class:"layer-toolbar layer-toolbar-bottom"},We=X({__name:"index",setup(o){const w=ye(),d=pe(),b=j(),{isLocked:h,isHided:f,disableGroup:p,moveCom:g,lockCom:I,hideCom:B,confirmDeleteCom:_,composeComs:A}=ee(),S=z(!1),F=L(()=>w.layer.show),k=z(!1),e=z({visible:!1,x:0,y:0,toLevel:0,toIndex:0,toCom:null,drop:!1}),C=L(()=>b.selectedComs.length>0),E=L(()=>({enable:C.value})),H=L(()=>({enable:C.value,checked:h.value})),r=L(()=>({enable:C.value,checked:f.value})),oe=L(()=>({enable:C.value&&!p.value})),ae=()=>{w.setPanelState(ke.layer,!F.value)},le=(n,l)=>{const s=be(n);n.shiftKey&&!s?b.selects(l):(!l.selected||n.button===0&&(s||b.selectedComs.length>1))&&b.select(l.id,l.parentId,s)},ne=()=>{b.select("")},se=(n,l)=>{if(d.contextMenu.show||l.renameing)return n.preventDefault(),!1;if(k.value=!0,l.selected){const s=document.querySelector(".draging-wrap");s.innerHTML="",document.querySelectorAll(".layer-manager-wrap .selected").forEach(M=>{s.appendChild(M.cloneNode(!0))}),n.dataTransfer.setDragImage(s,0,1)}else b.select(l.id,l.parentId)},re=()=>{k.value=!1,e.value.visible=!1,e.value.drop=!1;const n=e.value;b.moveTo(n.toLevel,n.toIndex,n.toCom);const l=document.querySelector(".draging-wrap");l.innerHTML=""},ie=(n,l,s,u)=>{if(e.value.drop)return;const M=48,T=n.clientY-104,D=T%M>24,ue=D?Math.ceil(T/M):Math.floor(T/M);e.value.visible=!0,e.value.y=ue*M,e.value.x=s*10,e.value.toLevel=s,e.value.toIndex=D?l+1:l,e.value.toCom=u},ce=n=>{n.preventDefault(),n.stopPropagation(),n.dataTransfer.dropEffect="copy"},de=n=>{n.key==="enter"?(e.value.visible=!1,e.value.drop=!0):n.key==="leave"?(e.value.visible=!0,e.value.drop=!1):(e.value.toLevel=n.level,e.value.toIndex=0,e.value.toCom=n.com)};return(n,l)=>{const s=P("n-icon");return i(),y("div",{class:m(["g-aside layer-panel-wp",{"--hide":!t(F)}])},[v("div",Pe,[v("div",qe,[Ue,v("div",Xe,[a(s,{title:"\u7F29\u7565\u56FE\u7248",class:m(["btn-icon",{selected:!S.value}]),onClick:l[0]||(l[0]=u=>S.value=!1)},{default:c(()=>[a(t(Me))]),_:1},8,["class"]),a(s,{title:"\u6587\u5B57\u7248",class:m(["btn-icon",{selected:S.value}]),onClick:l[1]||(l[1]=u=>S.value=!0)},{default:c(()=>[a(t(Ge))]),_:1},8,["class"]),a(s,{title:"\u6536\u8D77",class:"btn-icon",onClick:ae},{default:c(()=>[a(t(we))]),_:1})])]),v("div",Oe,[a(s,{title:"\u4E0A\u79FB\u4E00\u5C42",class:m(["toolbar-icon standard",t(E)]),onClick:l[2]||(l[2]=u=>t(g)(t(V).down))},{default:c(()=>[a(t(he))]),_:1},8,["class"]),a(s,{title:"\u4E0B\u79FB\u4E00\u5C42",class:m(["toolbar-icon standard",t(E)]),onClick:l[3]||(l[3]=u=>t(g)(t(V).up))},{default:c(()=>[a(t(xe))]),_:1},8,["class"]),a(s,{title:"\u7F6E\u9876",class:m(["toolbar-icon standard",t(E)]),onClick:l[4]||(l[4]=u=>t(g)(t(V).bottom))},{default:c(()=>[a(t($e))]),_:1},8,["class"]),a(s,{title:"\u7F6E\u5E95",class:m(["toolbar-icon standard",t(E)]),onClick:l[5]||(l[5]=u=>t(g)(t(V).top))},{default:c(()=>[a(t(Ie))]),_:1},8,["class"])]),v("div",Re,[a(Fe,null,{default:c(({com:u,idx:M,level:T})=>[a(Ke,{com:u,level:T,"show-text":S.value,class:m({selected:u.selected&&!k.value}),onMouseup:D=>le(D,u),onDragstart:D=>se(D,u),onDragend:re,onDragenter:Z(D=>ie(D,M,T,u),["self"]),onDragover:ce,onDragGroup:de},null,8,["com","level","show-text","class","onMouseup","onDragstart","onDragenter"])]),_:1}),v("div",{class:"last-flex-item",onClick:ne}),e.value.visible?(i(),y("div",{key:0,class:"layer-move-to-line",style:N({width:`calc(100% - ${e.value.x}px)`,transform:`translate(${e.value.x}px, ${e.value.y}px)`})},null,4)):$("",!0),Ye]),v("div",Je,[a(s,{title:"\u6210\u7EC4",class:m(["toolbar-icon standard",t(oe)]),onClick:t(A)},{default:c(()=>[a(t(Q))]),_:1},8,["class","onClick"]),a(s,{title:"\u5220\u9664",class:m(["toolbar-icon standard",t(E)]),onClick:t(_)},{default:c(()=>[a(t(Ce))]),_:1},8,["class","onClick"]),a(s,{title:"\u9501\u5B9A",class:m(["toolbar-icon standard",t(H)]),onClick:t(I)},{default:c(()=>[a(t(q))]),_:1},8,["class","onClick"]),a(s,{title:"\u9690\u85CF",class:m(["toolbar-icon standard",t(r)]),onClick:t(B)},{default:c(()=>[a(t(U))]),_:1},8,["class","onClick"])])])],2)}}});var it=O(We,[["__scopeId","data-v-853bc1ec"]]);export{it as default};
