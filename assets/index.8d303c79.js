var Ie=Object.defineProperty;var Re=(e,t,n)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var B=(e,t,n)=>(Re(e,typeof t!="symbol"?t+"":t,n),n);import{f as Z,o as Y,m as j,x as $,e as U,aR as re,v as w,B as R,n as Me,s as k,bl as Te,a0 as Ee,a2 as Xe,r as q,h as ae,w as ye,j as ie,b0 as te,bm as Be,t as pe,bn as Ye,aQ as Le,bo as De,V as L,y as N,bh as Fe,bp as We,aV as He,aS as Oe,b1 as xe,E as Ae,a1 as Ge,aZ as Ve,bq as Ne,P as qe,Q as je,a7 as Ze,a8 as Qe}from"./App.49df06d9.js";import{c as Ue}from"./index.10007f8d.js";import{a as P,o as _,b as S,c as Je}from"./dom.20ecd84c.js";import{u as _e}from"./index.ea5b026b.js";import"./templates.7801017d.js";import"./warning.68e51252.js";const Ke={},Pe={t:"1639130833808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},et=$("path",{d:"M341.33333333 579.33333333C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c85.336 0 170.664 58 256 174C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-85.336 0-170.664-48.664-256-146z m96-5.6C490.66933333 632.13333333 543.99733333 661.33333333 597.33333333 661.33333333s106.664-29.2 160-87.6C703.99733333 504.13333333 650.66933333 469.33333333 597.33333333 469.33333333s-106.664 34.8-160 104.4zM597.33333333 629.33333333a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"3986"},null,-1),tt=[et];function nt(e,t){return Y(),j("svg",Pe,tt)}const st=Z(Ke,[["render",nt]]),ot={},at={t:"1639130872871",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4135",width:"64",height:"64"},it=$("path",{d:"M651.14133333 413.01333333l-56.344 56.344C542.30933333 470.45333333 489.82133333 505.23733333 437.33333333 573.73333333a416 416 0 0 0 26.48 26.6l-49.976 49.984c-24.168-19.76-48.336-43.416-72.504-70.984C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c17.936 0 35.872 2.56 53.808 7.68z m113.968 67.056c29.408 26.2 58.816 59.28 88.224 99.264C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-22.456 0-44.92-3.368-67.376-10.112l54.456-54.456c4.304 0.376 8.616 0.568 12.92 0.568 53.336 0 106.664-29.2 160-87.6-13.368-17.44-26.736-32.704-40.112-45.784l47.888-47.88zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"4136"},null,-1),lt=$("path",{d:"M770.34933333 339.06133333l45.256 45.256-407.288 407.288-45.256-45.256z","p-id":"4137"},null,-1),rt=[it,lt];function ct(e,t){return Y(),j("svg",at,rt)}const dt=Z(ot,[["render",ct]]),ut=U({name:"AlignLine",setup(){const e=re();return{alignLine:w(()=>e.alignLine),canvas:w(()=>e.canvas)}}});const ht={key:0,class:"ident-line-wp"};function ft(e,t,n,o,s,a){return e.alignLine.enable&&e.alignLine.show?(Y(),j("div",ht,[$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.top}px`})},null,4),$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.horizontal}px`})},null,4),$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.bottom}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.left}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.vertical}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.right}px`})},null,4)])):Me("",!0)}const mt=Z(ut,[["render",ft],["__scopeId","data-v-5c5ebe5b"]]),ne=e=>`${e}px`,we=(e,t,n,o)=>{const s=e!=null?e:document.createElement("canvas");s.width=t*o,s.height=n*o,s.style.width=ne(t),s.style.height=ne(n);const a=s.getContext("2d");return a&&a.setTransform(o,0,0,o,0,0),s},Se=(e,t,n,o)=>{var m,v;const s=parseFloat(e.style.transform.match(new RegExp("(?<=X\\()(.+)","ig"))[0]),{height:a,scale:l,offset:u}=t;let i=0;return t.direction=="TB"?i=n-(((m=e.parentElement)==null?void 0:m.offsetLeft)||0)-s:i=o-(((v=e.parentElement)==null?void 0:v.offsetTop)||0)-s,i=i-a+t.indicatorLineWidth,{coor:Math.floor((i-u)/l),dist:i}},vt=(e,t)=>{const{scale:n,offset:o}=t;return{coor:e,dist:parseFloat((e*n+o).toFixed(3))}},le=class{constructor(t,n,o,s=0){B(this,"guideLine");B(this,"coor",-1);this.el=t,this.options=n,this.constructGuide(o,s)}constructGuide(t,n){const{el:o}=this,s=document.createElement("div");s.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",P(s,"ruler-line"),this.guideLine=s;const{coor:a}=this;this.setLine(t,n),t&&this.coorChange("add",this.coor,a);let l=o.querySelector(".lines-wrapper");l||(l=document.createElement("div"),P(l,"lines-wrapper"),o.appendChild(l)),l.appendChild(s),_(s,"mousedown",this.moving.bind(this)),_(s,"dblclick",this.dblclick.bind(this))}moving(t){le.isMoveing=!0;const{options:n}=this;t.preventDefault(),t.stopPropagation();const{coor:o}=this,s=l=>{n.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(l)},a=()=>{le.isMoveing=!1,document.body.style.cursor="",S(document,"mousemove",s),S(document,"mouseup",a);const{coor:l}=this;l<0?this.coorChange("delete",o,o):this.coorChange("update",l,o)};_(document,"mousemove",s),_(document,"mouseup",a)}setLine(t,n=0){const{el:o,options:s,guideLine:a}=this,l=t?Se(o,s,t.clientX,t.clientY):vt(n,s);s.direction==="TB"?a.style.left=ne(l.dist):a.style.top=ne(l.dist),a.innerHTML=`
      <div class="line-action">
        <span class="line-value">${l.coor}</span>
      </div>`,this.coor=l.coor}dblclick(t){t.preventDefault(),t.stopPropagation(),this.destroy()}coorChange(t,n,o){const{options:s}=this;s.coorChange&&s.coorChange(t,n,o)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:t,coor:n}=this;this.coorChange("delete",n,n),S(t,"mousedown",this.moving.bind(this)),S(t,"dblclick",this.dblclick.bind(this)),t.remove()}};let J=le;B(J,"isMoveing",!1);class $e{constructor(t,n){B(this,"el");B(this,"canvas");B(this,"ctx");B(this,"ruler",{width:0,height:0});B(this,"indicator");B(this,"indicatorValue");B(this,"guideLines",[]);B(this,"options",{direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2});this.el=t,this.options={...this.options,...n},this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:o,width:s,height:a,ratio:l}=n,u=Math.max(o==="TB"?t.offsetWidth:t.offsetHeight,s),i=a;this.ruler.width=u,this.ruler.height=i;const h=we(null,u,i,l);P(h,"canvas-ruler"),t.appendChild(h),this.canvas=h,this.ctx=h.getContext("2d"),this.drawRuler(),_(h,"mouseenter",this.constructIndicator.bind(this)),_(h,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,s,a),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o,{offset:l,scale:u}=n,i=0,h=a/1.5,m=a/1.2;for(let v=0;v<=s;v+=1){const g=v-l;if(g<0)continue;let M=-1,p=-1;g%50===0?(M=Math.floor(g/u),p=i):g%25===0?p=h:g%5===0&&(p=m),p>=0&&(t.moveTo(v+.5,a+.5),t.lineTo(v+.5,p),M>-1&&t.fillText(`${M}`,v+2.5,a/1.5))}}constructIndicator(t){if(J.isMoveing)return;const{el:n,options:o,canvas:s}=this,a=document.createElement("div"),l=document.createElement("span");P(a,"ruler-indicator"),P(l,"indicator-value"),a.appendChild(l),this.indicator=a,this.indicatorValue=l,n.appendChild(a);const u=m=>{const v=Se(n,o,m.clientX,m.clientY);a.style.left=ne(v.dist),l.textContent=`${v.coor}`};u(t);const i=m=>{u(m)},h=()=>{S(s,"mousemove",i),S(s,"mouseout",h),a.remove()};_(s,"mousemove",i),_(s,"mouseout",h)}createGuideLine(t){t.preventDefault(),t.stopPropagation();const{el:n,options:o}=this;this.guideLines.push(new J(n,o,t))}setGuideLines(t){const{el:n,options:o}=this;t.forEach(s=>{this.guideLines.push(new J(n,o,null,s))})}setSize(t,n,o){const{el:s,options:a}=this;a.width=t,a.height=n,a.scale=o;const{direction:l,width:u,height:i,ratio:h}=a,m=Math.max(l==="TB"?s.offsetWidth:s.offsetHeight,u),v=i;this.ruler.width=m,this.ruler.height=v,we(this.canvas,m,v,h),this.drawRuler(),this.guideLines.forEach(g=>g.setLine(null,g.coor))}setScale(t){this.options.scale=t,this.drawRuler(),this.guideLines.forEach(n=>n.setLine(null,n.coor))}toggleGuide(t){const n=t?"show":"hide";this.guideLines.forEach(o=>o[n]())}clearGuides(){this.guideLines.forEach(t=>t.destroy()),this.guideLines=[]}destroy(){const{el:t,canvas:n}=this;this.clearGuides(),S(n,"mouseenter",this.constructIndicator.bind(this)),S(n,"mousedown",this.createGuideLine.bind(this)),t.remove()}}const gt=U({name:"Ruler",components:{IconLineShow:st,IconLineHide:dt},setup(){const e=re(),t=k(null),n=k(null),o=k(null),s=k(null),a=k(!0),l=k(0),u=k(0),i=document.documentElement.clientWidth;Te(()=>{if(t.value&&n.value){const{canvas:v,guideLine:g}=e,M=Math.max(v.width,i);o.value?o.value.setSize(M,20,v.scale):(o.value=new $e(t.value,{direction:"TB",width:M,scale:v.scale,coorChange:(p,x,H)=>{p==="add"?g.h.push(x):p==="update"&&x!==H?(g.h=g.h.filter(D=>D!==H),g.h.push(x)):p==="delete"&&(g.h=g.h.filter(D=>D!==x))}}),o.value.setGuideLines(g.h)),s.value?s.value.setSize(v.height,20,v.scale):(s.value=new $e(n.value,{direction:"LR",width:v.height,scale:v.scale,coorChange:(p,x,H)=>{p==="add"?g.v.push(x):p==="update"&&x!==H?(g.v=g.v.filter(D=>D!==H),g.v.push(x)):p==="delete"&&(g.v=g.v.filter(D=>D!==x))}}),s.value.setGuideLines(g.v))}});const h=()=>{o.value&&s.value&&(a.value=!a.value,o.value.toggleGuide(a.value),s.value.toggleGuide(a.value))},m=v=>{const g=v.target;l.value=g.scrollLeft,u.value=g.scrollTop};return Ee(()=>{const v=document.getElementById("canvas-wp");v==null||v.addEventListener("scroll",m)}),Xe(()=>{const v=document.getElementById("canvas-wp");v==null||v.removeEventListener("scroll",m)}),{visible:a,hRulerWpRef:t,vRulerWpRef:n,toggleGuides:h,vScroll:u,hScroll:l}}});const yt={class:"canvas-ruler-wp"};function pt(e,t,n,o,s,a){const l=q("IconLineShow"),u=q("n-icon"),i=q("IconLineHide");return Y(),j("div",yt,[$("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:R(`transform: translateX(-${e.hScroll}px);`)},null,4),$("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:R(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),$("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:t[0]||(t[0]=(...h)=>e.toggleGuides&&e.toggleGuides(...h))},[e.visible?(Y(),ae(u,{key:0},{default:ye(()=>[ie(l)]),_:1})):(Y(),ae(u,{key:1},{default:ye(()=>[ie(i)]),_:1}))])])}const xt=Z(gt,[["render",pt]]),wt={class:"canvas-selection"},$t=["d"],bt=U({__name:"canvas-area",props:{startX:{type:Number,default:0},startY:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0}},setup(e){return(t,n)=>(Y(),j("svg",wt,[$("path",{fill:"none",stroke:"rgba(255,255,255,0.5)",d:`M ${e.startX},${e.startY} L ${e.startX},${e.startY+e.height} L ${e.startX+e.width},${e.startY+e.height} L ${e.startX+e.width},${e.startY} Z`,style:{"stroke-width":"1","stroke-dasharray":"3, 3"}},null,8,$t)]))}});const Ct=Z(bt,[["__scopeId","data-v-5262200c"]]),Mt=[{direction:"lt",angle:0,cursor:"nwse-resize",singleCursor:"nw-resize"},{direction:"t",angle:45,cursor:"ns-resize",singleCursor:"n-resize"},{direction:"rt",angle:90,cursor:"nesw-resize",singleCursor:"ne-resize"},{direction:"r",angle:135,cursor:"ew-resize",singleCursor:"e-resize"},{direction:"rb",angle:180,cursor:"nwse-resize",singleCursor:"se-resize"},{direction:"b",angle:225,cursor:"ns-resize",singleCursor:"s-resize"},{direction:"lb",angle:270,cursor:"nesw-resize",singleCursor:"sw-resize"},{direction:"l",angle:315,cursor:"ew-resize",singleCursor:"w-resize"}],be=[{start:338,end:23,cursor:"nwse-resize",singleCursor:"nw-resize"},{start:23,end:68,cursor:"ns-resize",singleCursor:"n-resize"},{start:68,end:113,cursor:"nesw-resize",singleCursor:"ne-resize"},{start:113,end:158,cursor:"ew-resize",singleCursor:"e-resize"},{start:158,end:203,cursor:"nwse-resize",singleCursor:"se-resize"},{start:203,end:248,cursor:"ns-resize",singleCursor:"s-resize"},{start:248,end:293,cursor:"nesw-resize",singleCursor:"sw-resize"},{start:293,end:338,cursor:"ew-resize",singleCursor:"w-resize"}],Lt=e=>{const t=(e+360)%360,n={};let o=-1;return Mt.forEach(s=>{const a=(s.angle+t)%360,l=be.length,u=0;for(;u<l;){o=(o+1)%l;const i=be[o];if(a<23||a>=338){n[s.direction]="nwse-resize";break}if(i.start<=a&&a<i.end){n[s.direction]=i.cursor;break}}}),n};function _t(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}function ee(e,t,n){const o=Be(n);return{x:(e.x-t.x)*Math.cos(o)-(e.y-t.y)*Math.sin(o)+t.x,y:(e.x-t.x)*Math.sin(o)+(e.y-t.y)*Math.cos(o)+t.y}}function St(e,t,n,o,s,a){const l=_t(n,o),u=ee(o,l,-t.deg),i=ee(n,l,-t.deg);e[0]==="l"?(a.x=Math.round(i.x/s),a.w=Math.round((u.x-i.x)/s)):e[0]==="r"&&(a.x=Math.round(u.x/s),a.w=Math.round((i.x-u.x)/s)),e[1]==="t"?(a.y=Math.round(i.y/s),a.h=Math.round((u.y-i.y)/s)):e[1]==="b"&&(a.y=Math.round(u.y/s),a.h=Math.round((i.y-u.y)/s))}function zt(e,t,n,o,s,a,l){const u=ee(o,n,-t.deg);if(e==="t"||e==="b"){const i=ee({x:n.x,y:u.y},n,t.deg),h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(h>0){const m={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};l.h=Math.round(h/a),l.x=Math.round(m.x/a-t.w/2),l.y=Math.round((m.y-h/2)/a)}}if(e==="l"||e==="r"){const i=ee({x:u.x,y:n.y},n,t.deg),h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(h>0){const m={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};l.w=Math.round(h/a),l.x=Math.round((m.x-h/2)/a),l.y=Math.round(m.y/a-t.h/2)}}}function kt(e,t,n,o,s,a){e==="t"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="rt"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="r"?a.w=Math.round(t.w+(o.x-n.x)/s):e==="rb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s)):e==="b"?a.h=Math.round(t.h+(o.y-n.y)/s):e==="lb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="l"?(a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="lt"&&(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s))}const It=(e,t,n,o,s,a,l)=>{const u={...n.attr},i=Object.create(null);let h,m,v;const g={x:0,y:0};if(s)m={x:e.clientX,y:e.clientY};else{const x={x:(u.x+u.w/2)*o,y:(u.y+u.h/2)*o};h=document.getElementById("canvas-coms").getBoundingClientRect(),m={x:e.clientX-h.left,y:e.clientY-h.top},v={x:x.x-(m.x-x.x),y:x.y-(m.y-x.y)}}const M=x=>{s?(g.x=x.clientX,g.y=x.clientY,kt(t,u,m,g,o,i)):(g.x=x.clientX-h.left,g.y=x.clientY-h.top,t.length===1?zt(t,u,m,g,v,o,i):St(t,u,g,v,o,i)),i.x!=null&&(n.attr.x=i.x),i.y!=null&&(n.attr.y=i.y),i.w!=null&&(n.scaling.w=Math.max(10,i.w)),i.h!=null&&(n.scaling.h=Math.max(10,i.h)),a()},p=()=>{S(document,"mousemove",M),S(document,"mouseup",p),l()};_(document,"mousemove",M),_(document,"mouseup",p)},Rt=(e,t,n,o,s,a)=>{const{x:l,y:u}=t.attr,i=m=>{t.attr.x=l+Math.round((m.clientX-e.clientX)/n/o)*o,t.attr.y=u+Math.round((m.clientY-e.clientY)/n/o)*o,s()},h=()=>{S(document,"mousemove",i),S(document,"mouseup",h),a()};_(document,"mousemove",i),_(document,"mouseup",h)},Tt=(e,t,n,o)=>{const s=t.getBoundingClientRect(),a=s.left+s.width/2,l=s.top+s.height/2;let u=0;const i=Math.atan2(l-e.clientY,a-e.clientX)*180/Math.PI-n.attr.deg,h=v=>{const g=Math.atan2(l-v.clientY,a-v.clientX)*180/Math.PI-i;u=Math.round(g%360),n.attr.deg=u<0?u+360:u},m=()=>{S(document,"mousemove",h),S(document,"mouseup",m),o(u)};_(document,"mousemove",h),_(document,"mouseup",m)},ze=(e,t)=>{e.attr.deg=0,e.children.forEach(n=>{if(n.type===te.layer)ze(n,t);else{const o=Math.round((n.attr.deg+t)%360);n.attr.deg=o<0?o+360:o}})},Et=U({name:"ReferLine",props:{pos:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(e){const o=w(()=>({height:`${e.pos.y+60/e.scale}px`,borderLeftWidth:`${.9/e.scale}px`})),s=w(()=>({width:`${e.pos.x+60/e.scale}px`,borderTopWidth:`${.9/e.scale}px`})),a=w(()=>({fontSize:`${12/e.scale}px`,top:`-${6/e.scale}px`,left:`-${6/e.scale}px`}));return{topLineStyle:o,leftLineStyle:s,accountStyle:a}}});const Xt={class:"nav-line"};function Bt(e,t,n,o,s,a){return Y(),j("div",Xt,[$("div",{class:"nav-line-top",style:R(e.topLineStyle)},null,4),$("div",{class:"nav-line-left",style:R(e.leftLineStyle)},null,4),$("div",{class:"nav-line-account",style:R(e.accountStyle)},pe(e.pos.x)+", "+pe(e.pos.y),5)])}const Yt=Z(Et,[["render",Bt],["__scopeId","data-v-750e08db"]]),Dt=U({name:"TransformLayer",props:{com:{type:Object,required:!0},parentCom:{type:Object},editable:Boolean},setup(e,t){Ye(e.com);const n=We(),o=re(),s=Le(),{showMenu:a,hideMenu:l}=_e(),u=k(!1),i=w(()=>e.com.type===te.layer),h=w(()=>o.canvas.scale),m=w(()=>o.referLine),v=w(()=>{let{x:d,y:c}=e.com.attr;return b().coms.forEach(r=>{d+=r.attr.x,c+=r.attr.y}),{x:d,y:c}}),g=w(()=>({"datav-transform":!0,selected:e.com.selected,hided:e.com.hided,locked:e.com.locked})),M=w(()=>{const{x:d,y:c,w:f,h:r}=e.com.attr;return{top:0,left:0,width:`${f}px`,height:`${r}px`,transform:`translate(${d}px, ${c}px)`}}),p=w(()=>({"datav-scale":!0,hovered:e.com.hovered,"--relative-hovered":se.value.hovered})),x=w(()=>{const{zoom:d,sx:c,sy:f}=e.com.scaling,r=d?`scale(${c.toFixed(6)}, ${f.toFixed(6)})`:void 0;return i.value?{transform:r||"none"}:{display:e.com.hided?"none":"block",transform:r}}),H=w(()=>{const{hided:d,attr:c,scaling:f}=e.com,r={overflow:"visible",display:d?"none":"block",transform:`rotate(${c.deg}deg)`,opacity:c.opacity},{zoom:z,sx:T,sy:V}=f;return z&&(r.transform=`scale(${(1/T).toFixed(6)}, ${(1/V).toFixed(6)}) ${r.transform} scale(${T.toFixed(6)}, ${V.toFixed(6)})`),r}),D=w(()=>{const{selected:d,attr:c}=e.com,f={cursor:d?"move":"inherit"};if(i.value)c.apply3d&&(f.perspective=`${c.perspective}px`,f.perspectiveOrigin=`${c.perspectiveOrigin.x}% ${c.perspectiveOrigin.y}%`);else{const{zoom:r,sx:z,sy:T}=e.com.scaling;f.transform=r?`scale(${(1/z).toFixed(6)}, ${(1/T).toFixed(6)}) ${f.transform} scale(${z.toFixed(6)}, ${T.toFixed(6)})`:`rotate(${e.com.attr.deg}deg)`}return f}),ce=w(()=>{const{hided:d,attr:c}=e.com,f=o.pageConfig.styleFilterParams;let r="";return f.enable&&(r=`hue-rotate(${f.hue}deg) contrast(${f.contrast}%) opacity(${f.opacity}%) saturate(${f.saturate}%) brightness(${f.brightness}%)`),{display:d?"none":"block",transform:`scaleX(${c.filpH?-1:1}) scaleY(${c.filpV?-1:1}) rotateZ(360deg)`,filter:r}}),de=w(()=>({width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`})),F=w(()=>Lt(e.com.attr.deg)),ue=w(()=>{const{zoom:d,sx:c,sy:f}=e.com.scaling,r=d?`scale(${1/c/h.value}, ${1/f/h.value})`:`scale(${1/h.value}, ${1/h.value})`;return{t:{name:"top",style:{cursor:F.value.t,transform:r}},rt:{name:"top-right",style:{cursor:F.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:r}},r:{name:"right",style:{cursor:F.value.r,transform:r}},rb:{name:"bottom-right",style:{cursor:F.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:r}},b:{name:"bottom",style:{cursor:F.value.b,transform:r}},lb:{name:"bottom-left",style:{cursor:F.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:r}},l:{name:"left",style:{cursor:F.value.l,transform:r}},lt:{name:"top-left",style:{cursor:F.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:r}}}}),se=w(()=>{var f;let d=(f=e.parentCom)==null?void 0:f.selected,c=!1;if(i.value&&!d){const r=De(e.com);d=r.hovered||r.selected,c=r.selected}return{hovered:d,selected:c}}),oe=(d,c)=>{const f=(r,z)=>r===z?1:0;return`rotate3d(${f(d,"x")}, ${f(d,"y")}, ${f(d,"z")}, ${c}deg)`},he=d=>{const{attr:c}=d,f={justifyContent:"center",alignItems:"center",display:"block",opacity:1,transform:"translate3d(0, 0, 0)",width:"auto",height:"auto",position:"absolute",transformOrigin:`${c.w/2+c.x}px ${c.h/2+c.y}`},{attr:r,config:z}=e.com;if(r.apply3d){const T=z.find(ke=>ke.transform3d.id===d.id),{rotate3d:V,scale3d:ge,translate3d:ve}=T.transform3d;f.transform=`translate3d(${ve.x}px, ${ve.y}px, ${ve.z}px) scale3d(${ge.x}, ${ge.y}, 1) ${oe(V.axis,V.deg)}`}return f},fe=()=>{e.parentCom?e.editable&&!e.com.selected&&(e.com.hovered=!0):e.com.selected||(e.com.hovered=!0)},me=()=>{e.com.hovered=!1},y=d=>{const c=Fe(d);(c||!e.com.selected)&&s.select(e.com.id,e.com.parentId,c)},I=d=>{if(e.parentCom&&!e.editable){const c=b(),f=c.editables.lastIndexOf(!1);a(d,c.coms[f])}else a(d,e.com)},C=d=>{if(e.parentCom&&!e.editable){const c=b(),f=c.editables.lastIndexOf(!1);c.instances[f].proxy.onMove(d)}else W(d)},W=d=>{if(o.contextMenu.show)return l(),!1;if(!e.com.selected)return Je(d.target,"mouseup",y),!1;s.selectedComs.forEach(c=>{Rt(d,c,h.value,o.pageConfig.grid,()=>{e.com.id===c.id&&(u.value=!0,o.calcAlignLine(e.com))},()=>{if(e.com.id===c.id)if(u.value){u.value=!1,o.hideAlignLine(e.com.id);const f=b();f.coms.length>0&&s.resizeParents(f.coms)}else d.button===0&&s.select(e.com.id,e.com.parentId)})})},O=(d,c)=>{if(l(),!e.com.selected)return!1;const f=(r,z)=>{r.scaling.w=r.attr.w,r.scaling.h=r.attr.h,It(d,c,r,h.value,z,()=>{r.scaling.zoom=!0,r.scaling.sx=r.scaling.w/r.attr.w,r.scaling.sy=r.scaling.h/r.attr.h},()=>{i.value&&s.resizeChildren(r),r.scaling.zoom=!1,r.scaling.sx=1,r.scaling.sy=1,r.attr.w=r.scaling.w,r.attr.h=r.scaling.h;const T=b();T.coms.length>0&&s.resizeParents(T.coms)})};s.selectedComs.length>1?s.selectedComs.forEach(r=>{f(r,!0)}):f(e.com,o.isNormalResizeMode)},E=d=>{l(),s.selectedComs.forEach(c=>{Tt(d,n.vnode.el,c,f=>{i.value&&ze(c,f)})})},b=()=>{const d=[],c=[],f=[],r=z=>{var V;const T=z.props.parentCom;T&&(d.push(T),c.push((V=z.props.editable)!=null?V:!1),f.push(z.parent),r(z.parent))};return r(n),{coms:d,editables:c,instances:f}},A=d=>{e.parentCom&&!e.editable&&(e.parentCom.selected?y(d):b().instances[0].proxy.selectCom(d))},G=d=>L("div",{key:d.id,class:"slider-item",style:he(d)},{default:()=>t.slots.default({data:d,editable:se.value.selected})}),X=()=>L("div",{class:"datav-com",style:ce.value},{default:()=>[t.slots.default(),L("div",{class:"datav-wrapper-event-disable",style:de.value})]}),K=(d,c)=>{const f=L("span",{class:"control-point",style:c.style,onMousedown:N(r=>{O(r,d)},["stop"])});return c.rotateStyle?L("i",{class:`${c.name}-handler`,"data-html2canvas-ignore":!0},L("span",{class:"rotate-handler",style:c.rotateStyle,onMousedown:N(r=>{E(r)},["stop"])},f)):L("i",{class:`${c.name}-handler`,"data-html2canvas-ignore":!0},f)},Q=()=>L("div",{class:{"transform-handler":!0,hided:!e.com.selected||e.com.locked},style:D.value},{default:()=>{let d=[];i.value?d=e.com.children.map(c=>G(c)):d.push(X());for(const[c,f]of Object.entries(ue.value))d.push(K(c,f));return d.push(L("div",{class:"transform-bg"})),d}});return{scale:h,referLine:m,referLinePos:v,transformClass:g,transformStyle:M,scaleClass:p,scaleStyle:x,createTransform:Q,createSlider:()=>L("div",{class:"datav-layer slider",style:H.value},Q()),onEnter:fe,onLeave:me,onDown:C,onMove:W,selectCom:y,showContextMenu:I,selectInnerItem:A}},render(){const{scale:e,referLine:t,referLinePos:n}=this;return L("div",{class:this.transformClass,style:this.transformStyle},{default:()=>[t.enable&&this.$props.com.selected?L(Yt,{scale:e,pos:n}):null,L("div",{class:this.scaleClass,style:this.scaleStyle,onMouseenter:N(this.onEnter,["stop"]),onMouseleave:N(this.onLeave,["stop"]),onMousedown:N(this.onDown,["stop"]),onContextmenu:N(this.showContextMenu,["stop"]),onDblclick:N(this.selectInnerItem,["stop"]),onClick:N(()=>{},["stop"])},this.$props.com.type===te.layer?this.createSlider():this.createTransform())]})}});const Ce=Z(Dt,[["__scopeId","data-v-19713a14"]]),Ft=U({name:"DatavTransform",props:{com:{type:Object,required:!0}},setup(){const e=(t,n,o)=>t.type===te.com?L(Ce,{com:t,parentCom:n,editable:o},{default:()=>L(q(t.name),{com:t,style:{transform:"translateZ(0)",opacity:t.attr.opacity}})}):L(Ce,{com:t,parentCom:n,editable:o},{default:({data:s,editable:a})=>e(s,t,a)});return{create:e}},render(){return this.create(this.$props.com)}}),Wt=U({name:"CanvasMain",components:{AlignLine:mt,Ruler:xt,CanvasArea:Ct,DatavTransform:Ft},setup(){const e=He(),t=Le(),n=re(),o=Oe(),{hideMenu:s}=_e(),{pageConfig:a,canvas:l}=xe(n),{coms:u}=xe(t),i=k(!1),h=k(0),m=k(0),v=k(0),g=k(0),M=k(0),p=k(0),x=60,H=60,D=w(()=>({width:`${l.value.width}px`,height:`${l.value.height}px`})),ce=w(()=>({width:`${a.value.width}px`,height:`${a.value.height}px`,transform:`scale(${l.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${a.value.bgimage})`,backgroundColor:a.value.bgcolor})),de=async y=>{y.preventDefault();try{const I=y.dataTransfer.getData("text");if(I){e.addLoading();let C=await Ue(I);const{scale:W}=l.value,{left:O,top:E}=e.getPanelOffset,b=document.getElementById("canvas-wp"),A=(b==null?void 0:b.scrollLeft)||0,G=(b==null?void 0:b.scrollTop)||0,X=(A+y.clientX-O)/W,K=(G+y.clientY-E)/W;C.attr.x=Math.round(X-C.attr.w/2),C.attr.y=Math.round(K-C.attr.h/2),await t.add(C),t.select(C.id),e.removeLoading(),C.apis.source&&(await C.loadData(),Ge(()=>{var Q;(Q=o.events[C.id])==null||Q.requestData()}))}}catch(I){Ve("dropToAddCom",I.message)}},F=y=>{y.preventDefault(),y.stopPropagation(),y.dataTransfer.dropEffect="copy"},ue=y=>{const I=y.target;["canvas-panel","screen-shot","canvas-panel-wrap"].includes(I.className)?i.value=!0:i.value=!1},se=()=>{i.value&&(i.value=!1,t.select(""))},oe=()=>{M.value=0,p.value=0},he=()=>u.value.filter(y=>y.locked||y.hided||!y.hovered?(y.selected=!1,!1):(y.selected=!0,!0)),fe=()=>{const{scale:y}=l.value,I=(v.value-x)/y,C=(g.value-H)/y,W=M.value/y,O=p.value/y;u.value.forEach(E=>{if(E.locked||E.hided)return;const{x:b,y:A,w:G,h:X}=E.attr,K={x:I,y:C,w:W,h:O},Q={x:b,y:A,w:G,h:X};E.hovered=Ne(K,Q)})},me=y=>{if(i.value=!0,n.contextMenu.show)return i.value=!1,s(),!1;const I=document.getElementById("screen-wp");h.value=I.clientWidth,m.value=I.clientHeight;const C=I.getBoundingClientRect(),W=C.x,O=C.y,E=y.clientX,b=y.clientY;v.value=E-W,g.value=b-O;const A=X=>{X.clientX<E&&(v.value=X.clientX-W),X.clientY<b&&(g.value=X.clientY-O),M.value=Math.abs(X.clientX-E),p.value=Math.abs(X.clientY-b),fe(),i.value=!1},G=()=>{S(document,"mousemove",A),S(document,"mouseup",G),oe(),he(),i.value&&ue(y)};_(document,"mousemove",A),_(document,"mouseup",G)};return Ae(()=>n.canvas.scale,()=>{oe(),s()}),{ComType:te,coms:u,canvasPanelStyle:ce,screenShotStyle:D,selectionW:h,selectionH:m,areaStartX:v,areaStartY:g,areaWidth:M,areaHeight:p,dragOver:F,dropToAddCom:de,handleMouseDown:me,cancelSelected:se}}});const Ht=e=>(Ze("data-v-aa1f8bdf"),e=e(),Qe(),e),Ot={class:"canvas-main"},At=Ht(()=>$("div",{class:"thumbnail"},null,-1));function Gt(e,t,n,o,s,a){const l=q("datav-transform"),u=q("align-line"),i=q("ruler"),h=q("canvas-area");return Y(),j("div",Ot,[$("div",{id:"canvas-wp",class:"canvas-panel-wrap",onClick:t[3]||(t[3]=(...m)=>e.cancelSelected&&e.cancelSelected(...m))},[$("div",{id:"screen-wp",class:"screen-shot",style:R(e.screenShotStyle),onMousedown:t[2]||(t[2]=(...m)=>e.handleMouseDown&&e.handleMouseDown(...m))},[$("div",{id:"canvas-coms",class:"canvas-panel",style:R(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...m)=>e.dragOver&&e.dragOver(...m)),onDrop:t[1]||(t[1]=(...m)=>e.dropToAddCom&&e.dropToAddCom(...m))},[(Y(!0),j(qe,null,je(e.coms,m=>(Y(),ae(l,{key:m.id,com:m},null,8,["com"]))),128))],36),ie(u),ie(i)],36),e.areaWidth>0||e.areaHeight>0?(Y(),ae(h,{key:0,"start-x":e.areaStartX,"start-y":e.areaStartY,width:e.areaWidth,height:e.areaHeight,style:R({width:`${e.selectionW}px`,height:`${e.selectionH}px`})},null,8,["start-x","start-y","width","height","style"])):Me("",!0)]),At])}const Kt=Z(Wt,[["render",Gt],["__scopeId","data-v-aa1f8bdf"]]);export{Kt as default};
