import{f as U,o as i,m as y,x as v,e as j,aQ as J,s as z,v as L,bo as me,r as K,ao as ve,a$ as t,b0 as x,P as A,j as l,w as c,p as m,n as $,h as G,ak as Q,al as W,ap as X,t as Y,B as N,y as Z,aV as fe,aR as ge,bj as V,bg as ye,bh as pe,a7 as ke,a8 as be}from"./App.488876ce.js";import{I as Ce}from"./delete.561cf48c.js";import{I as we}from"./back.45107c1b.js";import{d as ee,b as he,c as xe,I as $e,a as Ie}from"./group.8be386df.js";import{I as q}from"./lock.2d202b45.js";import{I as R}from"./hide.114c085d.js";import{I as Me}from"./view-grid.88ad7723.js";import{u as te}from"./index.717cfe10.js";import{I as De}from"./arrow-right.245fa02e.js";import"./dom.3a106cf3.js";import"./warning.da0cf4e8.js";const Be={},Se={t:"1639130612954",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},Ee=v("path",{d:"M116.4921875 116.4921875l0 186.12132317 791.015625 0 0-186.12132317-791.015625 0zM860.9774817 256.08317987l-697.9549634 0 0-93.06066158 697.95496341 0 0 93.06066158zM116.4921875 581.79549619l791.015625 0 0-186.12132317-791.015625 0 0 186.12132317zM163.0225183 442.20450381l697.9549634 0 0 93.06066158-697.95496341 0 0-93.06066158zM116.4921875 860.9774817l791.015625 1e-8 0-186.12132317-791.015625 0 0 186.12132317zM163.0225183 721.38648933l697.9549634 0 0 93.0606616-697.95496341 0 0-93.0606616z","p-id":"3986"},null,-1),Le=[Ee];function Te(o,w){return i(),y("svg",Se,Le)}const Ge=U(Be,[["render",Te]]),Fe=j({name:"LayerManagerWrap",props:{rank:{type:Number,default:3}},setup(o,w){const d=J(),b=(f,p,g)=>{const I={com:f,idx:p,level:g};return g<o.rank&&f.children&&!f.fold?[w.slots.default(I),...h(f.children,g+1)]:w.slots.default(I)},h=(f,p)=>{const g=f.length-1;return f.map((I,B)=>b(f[g-B],B,p))};return()=>h(d.coms,0)}}),He=["title"],Ve={key:2,class:"layer-item-span"},ze={class:"layer-manager-thumbail"},Ne={class:"layer-thumbail-item"},_e=["onMouseup"],Pe=j({__name:"layer-manager-item",props:{com:null,level:null,showText:{type:Boolean}},emits:["dragGroup"],setup(o,{emit:w}){const d=o,{showMenu:b}=te(),h=z(!1),f=L(()=>me(d.com)),p=k=>{d.com.renameing=k===1},g=k=>{d.com.hovered=d.com.selected?!1:k===1},I=k=>{d.com.hided=k===1},B=k=>{d.com.locked=k===1},_=()=>{d.com.fold=!d.com.fold},P=()=>{d.com.type===x.layer&&(h.value=!0,w("dragGroup",{key:"enter"}))},S=()=>{d.com.type===x.layer&&(h.value=!1,w("dragGroup",{key:"leave"}))},F=()=>{d.com.type===x.layer&&(h.value=!1,w("dragGroup",{key:"drop",level:d.level+1,com:d.com.children[0]}))};return(k,e)=>{const C=K("n-icon"),E=K("g-com-icon"),H=ve("focus");return i(),y("div",{title:o.com.alias,class:m({"layer-manager-com":o.com.type===t(x).com,"layer-manager-group":o.com.type===t(x).layer,"layer-manager-item":!0,"layer-manager-thumbail-wrap":!o.showText,"--child-hovered":t(f).hovered||h.value,"--child-selected":t(f).selected,hided:o.com.hided,locked:o.com.locked,hovered:o.com.hovered}),style:N({paddingLeft:`${6+o.level*10}px`}),draggable:"true",onMouseenter:e[12]||(e[12]=r=>g(1)),onMouseleave:e[13]||(e[13]=r=>g(0)),onContextmenu:e[14]||(e[14]=r=>t(b)(r,o.com))},[o.com.type===t(x).layer?(i(),y(A,{key:0},[l(C,{class:m(["fold-toggle-btn",{"icon-fold":o.com.fold}])},{default:c(()=>[l(t(De))]),_:1},8,["class"]),l(C,{class:"layer-item-icon"},{default:c(()=>[l(t(ee))]),_:1})],64)):$("",!0),o.showText?(i(),y(A,{key:1},[o.com.type===t(x).com?(i(),G(E,{key:0,icon:o.com.icon},null,8,["icon"])):$("",!0),o.com.renameing?Q((i(),y("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=r=>o.com.alias=r),class:"layer-item-input",onBlur:e[1]||(e[1]=r=>p(0)),onKeydown:e[2]||(e[2]=X(r=>p(0),["enter"]))},null,544)),[[W,o.com.alias,void 0,{trim:!0}],[H]]):(i(),y("span",Ve,[v("span",{class:"layer-item-text",onDblclick:e[3]||(e[3]=r=>p(1))},Y(o.com.alias),33)])),o.com.hided?(i(),G(C,{key:3,class:"show-toggle-btn",onClick:e[4]||(e[4]=r=>I(0))},{default:c(()=>[l(t(R))]),_:1})):$("",!0),o.com.locked?(i(),G(C,{key:4,class:"show-toggle-btn",onClick:e[5]||(e[5]=r=>B(0))},{default:c(()=>[l(t(q))]),_:1})):$("",!0)],64)):(i(),y(A,{key:2},[o.com.type===t(x).com?(i(),y("div",{key:0,class:"layer-item-thumbail",style:N(`background-image: url(${o.com.img})`)},null,4)):$("",!0),v("div",ze,[o.com.renameing?Q((i(),y("input",{key:0,"onUpdate:modelValue":e[6]||(e[6]=r=>o.com.alias=r),class:"layer-item-input",onBlur:e[7]||(e[7]=r=>p(0)),onKeydown:e[8]||(e[8]=X(r=>p(0),["enter"]))},null,544)),[[W,o.com.alias,void 0,{trim:!0}],[H]]):(i(),y("span",{key:1,class:"layer-item-span",onDragenter:P,onDragleave:S,onDrop:F},[v("span",{class:"layer-item-text",onDblclick:e[9]||(e[9]=r=>p(1))},Y(o.com.alias),33)],32))]),v("div",Ne,[o.com.hided?(i(),G(C,{key:0,class:"show-toggle-btn",onClick:e[10]||(e[10]=r=>I(0))},{default:c(()=>[l(t(R))]),_:1})):$("",!0),o.com.locked?(i(),G(C,{key:1,class:"show-toggle-btn",onClick:e[11]||(e[11]=r=>B(0))},{default:c(()=>[l(t(q))]),_:1})):$("",!0)])],64)),o.com.type===t(x).layer?(i(),y("div",{key:3,class:"group-fold-controller",style:N({width:`${o.level>0?50:40}px`,transform:`translateX(-${6+o.level*10}px)`}),onMouseup:Z(_,["stop"])},null,44,_e)):$("",!0)],46,He)}}});const Ae=U(Pe,[["__scopeId","data-v-613b6fd8"]]),oe=o=>(ke("data-v-f0ca8762"),o=o(),be(),o),Ke={class:"layer-manager"},qe={class:"layer-manager-top"},Re=oe(()=>v("div",{class:"layer-num"},"\u56FE\u5C42",-1)),Ue={class:"layer-layout"},je={class:"layer-toolbar layer-toolbar-top"},Oe={class:"layer-manager-wrap"},Qe=oe(()=>v("div",{class:"draging-wrap"},null,-1)),We={class:"layer-toolbar layer-toolbar-bottom"},Xe=j({__name:"index",setup(o){const w=fe(),d=ge(),b=J(),{isLocked:h,isHided:f,disableGroup:p,moveCom:g,lockCom:I,hideCom:B,confirmDeleteCom:_,composeComs:P}=te(),S=z(!1),F=L(()=>w.layer.show),k=z(!1),e=z({visible:!1,x:0,y:0,toLevel:0,toIndex:0,toCom:null,drop:!1}),C=L(()=>b.selectedComs.length>0),E=L(()=>({enable:C.value})),H=L(()=>({enable:C.value,checked:h.value})),r=L(()=>({enable:C.value,checked:f.value})),le=L(()=>({enable:C.value&&!p.value})),ae=()=>{w.setPanelState(ye.layer,!F.value)},ne=(n,a)=>{const s=pe(n);n.shiftKey&&!s?b.selects(a):(!a.selected||n.button===0&&(s||b.selectedComs.length>1))&&b.select(a.id,a.parentId,s)},se=()=>{b.select("")},re=(n,a)=>{if(d.contextMenu.show||a.renameing)return n.preventDefault(),!1;if(k.value=!0,a.selected){const s=document.querySelector(".draging-wrap");s.innerHTML="",document.querySelectorAll(".layer-manager-wrap .selected").forEach(M=>{s.appendChild(M.cloneNode(!0))}),n.dataTransfer.setDragImage(s,0,1)}else b.select(a.id,a.parentId)},ie=()=>{k.value=!1,e.value.visible=!1,e.value.drop=!1;const n=e.value;b.moveTo(n.toLevel,n.toIndex,n.toCom);const a=document.querySelector(".draging-wrap");a.innerHTML=""},ce=(n,a,s,u)=>{if(e.value.drop)return;const M=48,T=n.clientY-104,D=T%M>24,O=D?Math.ceil(T/M):Math.floor(T/M);e.value.visible=!0,e.value.y=(O<0?0:O)*M,e.value.x=s*10,e.value.toLevel=s,e.value.toIndex=D?a+1:a,e.value.toCom=u},de=n=>{n.preventDefault(),n.stopPropagation(),n.dataTransfer.dropEffect="copy"},ue=n=>{n.key==="enter"?(e.value.visible=!1,e.value.drop=!0):n.key==="leave"?(e.value.visible=!0,e.value.drop=!1):(e.value.toLevel=n.level,e.value.toIndex=0,e.value.toCom=n.com)};return(n,a)=>{const s=K("n-icon");return i(),y("div",{class:m(["g-aside layer-panel-wp",{"--hide":!t(F)}])},[v("div",Ke,[v("div",qe,[Re,v("div",Ue,[l(s,{title:"\u7F29\u7565\u56FE\u7248",class:m(["btn-icon",{selected:!S.value}]),onClick:a[0]||(a[0]=u=>S.value=!1)},{default:c(()=>[l(t(Me))]),_:1},8,["class"]),l(s,{title:"\u6587\u5B57\u7248",class:m(["btn-icon",{selected:S.value}]),onClick:a[1]||(a[1]=u=>S.value=!0)},{default:c(()=>[l(t(Ge))]),_:1},8,["class"]),l(s,{title:"\u6536\u8D77",class:"btn-icon",onClick:ae},{default:c(()=>[l(t(we))]),_:1})])]),v("div",je,[l(s,{title:"\u4E0A\u79FB\u4E00\u5C42",class:m(["toolbar-icon standard",t(E)]),onClick:a[2]||(a[2]=u=>t(g)(t(V).down))},{default:c(()=>[l(t(he))]),_:1},8,["class"]),l(s,{title:"\u4E0B\u79FB\u4E00\u5C42",class:m(["toolbar-icon standard",t(E)]),onClick:a[3]||(a[3]=u=>t(g)(t(V).up))},{default:c(()=>[l(t(xe))]),_:1},8,["class"]),l(s,{title:"\u7F6E\u9876",class:m(["toolbar-icon standard",t(E)]),onClick:a[4]||(a[4]=u=>t(g)(t(V).bottom))},{default:c(()=>[l(t($e))]),_:1},8,["class"]),l(s,{title:"\u7F6E\u5E95",class:m(["toolbar-icon standard",t(E)]),onClick:a[5]||(a[5]=u=>t(g)(t(V).top))},{default:c(()=>[l(t(Ie))]),_:1},8,["class"])]),v("div",Oe,[l(Fe,null,{default:c(({com:u,idx:M,level:T})=>[l(Ae,{com:u,level:T,"show-text":S.value,class:m({selected:u.selected&&!k.value}),onMouseup:D=>ne(D,u),onDragstart:D=>re(D,u),onDragend:ie,onDragenter:Z(D=>ce(D,M,T,u),["self"]),onDragover:de,onDragGroup:ue},null,8,["com","level","show-text","class","onMouseup","onDragstart","onDragenter"])]),_:1}),v("div",{class:"last-flex-item",onClick:se}),e.value.visible?(i(),y("div",{key:0,class:"layer-move-to-line",style:N({width:`calc(100% - ${e.value.x}px)`,transform:`translate(${e.value.x}px, ${e.value.y}px)`})},null,4)):$("",!0),Qe]),v("div",We,[l(s,{title:"\u6210\u7EC4",class:m(["toolbar-icon standard",t(le)]),onClick:t(P)},{default:c(()=>[l(t(ee))]),_:1},8,["class","onClick"]),l(s,{title:"\u5220\u9664",class:m(["toolbar-icon standard",t(E)]),onClick:t(_)},{default:c(()=>[l(t(Ce))]),_:1},8,["class","onClick"]),l(s,{title:"\u9501\u5B9A",class:m(["toolbar-icon standard",t(H)]),onClick:t(I)},{default:c(()=>[l(t(q))]),_:1},8,["class","onClick"]),l(s,{title:"\u9690\u85CF",class:m(["toolbar-icon standard",t(r)]),onClick:t(B)},{default:c(()=>[l(t(R))]),_:1},8,["class","onClick"])])])],2)}}});const it=U(Xe,[["__scopeId","data-v-f0ca8762"]]);export{it as default};
