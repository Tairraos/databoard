import{e as T,C as $,ai as K,aV as P,aW as Q,aQ as W,s as B,E as I,v as N,an as x,V as z,bG as M,f as G,r as u,o as F,h as D,w as p,j as _,x as h,l as S,n as V,m as j,Q as L,P as O}from"./App.488876ce.js";import{I as U}from"./warning.da0cf4e8.js";import{I as q}from"./document.422f4791.js";import{F as H,f as J}from"./filter-collapse-item.ad8c33d7.js";import"./arrow-left.8799fcdd.js";import"./edit.725315c0.js";import"./delete.561cf48c.js";import"./release.93cb7bd2.js";import"./drag.c621632f.js";import"./config.3c16c364.js";const R=T({name:"FilterManagerDrawer",components:{IconDocument:q,FilterCollapseItem:H},setup(){const a=$(),c=K(),v=P(),d=Q(),r=W(),E=B(!1),i=B(null);I(()=>v.filter.show,e=>{E.value=e}),I(E,e=>{e||(v.filter.show=!1)});const b=N(()=>d.dataFilters),m=N(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(t=>{for(const o in t.apiData)t.apiData[o].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(t.id),e[s.id].names.push(t.alias)):e[s.id]={ids:[t.id],names:[t.alias]}})}),e}),w=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})};return x(J,{usedFilters:m,editFilterName:(e,n)=>{const t=e.trim();t&&n.name!==t&&(n.name=t,n.id>0&&d.updateName(n))},removeFilter:e=>{if(e>0){const n=c.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>z(U),onPositiveClick:async()=>{n.loading=!0;try{await d.delete(e);const t=m.value[e];t&&[...r.coms,...r.subComs].filter(o=>t.ids.includes(o.id)).forEach(o=>{for(const f in o.apiData){const s=f,l=o.apiData[s],g=l.pageFilters.find(C=>C.id===e);l.pageFilters=l.pageFilters.filter(C=>C.id!==e),g&&g.enabled&&M(o.id,s,o.apis[s],l)}})}catch(t){a.error(t.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await d.update(e);const n=m.value[e.id];n&&[...r.coms,...r.subComs].filter(t=>n.ids.includes(t.id)).forEach(t=>{for(const o in t.apiData){const f=o,s=t.apiData[f],l=s.pageFilters.find(g=>g.id===e.id);l&&l.enabled&&M(t.id,f,t.apis[f],s)}})}else await d.create(e),i.value=null}}),{visible:E,dataFilters:b,newDataFilter:i,addFilter:w}}});const X={class:"filter-manager-title"},Y=h("span",null,"\u5E2E\u52A9\u6587\u6863",-1),Z={key:1,class:"panel-info"},ee=h("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1);function te(a,c,v,d,r,E){const i=u("IconDocument"),b=u("n-icon"),m=u("router-link"),w=u("filter-collapse-item"),k=u("n-button"),y=u("n-drawer-content"),A=u("n-drawer");return F(),D(A,{show:a.visible,"onUpdate:show":c[1]||(c[1]=e=>a.visible=e),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp","show-mask":""},{default:p(()=>[_(y,{closable:""},{header:p(()=>[h("p",X,[S(" \u6570\u636E\u8FC7\u6EE4\u5668"),h("span",{class:"create-filter",onClick:c[0]||(c[0]=(...e)=>a.addFilter&&a.addFilter(...e))},"\u65B0\u5EFA"),_(m,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[_(b,{size:12},{default:p(()=>[_(i)]),_:1}),Y]),_:1})])]),default:p(()=>[a.newDataFilter?(F(),D(w,{key:0,"data-filter":a.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):V("",!0),(F(!0),j(O,null,L(a.dataFilters,e=>(F(),D(w,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),a.dataFilters.length===0&&!a.newDataFilter?(F(),j("div",Z,[ee,_(k,{focusable:!1,onClick:a.addFilter},{default:p(()=>[S(" \u65B0\u5EFA ")]),_:1},8,["onClick"])])):V("",!0)]),_:1})]),_:1},8,["show"])}const fe=G(R,[["render",te]]);export{fe as default};
