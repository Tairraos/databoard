import{r as ie,o as h,f as x,h as y,af as ue,ag as ce,ah as le,e as se,Y as de,aa as fe,I as B,ai as ge,J as pe,aj as me,ak as N,al as he,s as P,p as L,j,w as T,k as m,v as z,q as k,am as ve,L as be,an as ye,ao as we}from"./App.c8de2d3d.js";import{I as Oe}from"./copy.3a9ecbda.js";import{I as je}from"./fullscreen.d8b5c117.js";const Se={},Ce={t:"1640016230719",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3997",width:"64",height:"64"},Ie=y("path",{d:"M244.39466667 305.41596445l-49.95299556 49.95299555a9.10222222 9.10222222 0 0 0 5.38851556 15.43736889l182.26289778 21.55406222a9.24785778 9.24785778 0 0 0 10.19448888-10.19448889L370.73351111 199.97582222a9.10222222 9.10222222 0 0 0-15.51018666-5.31569777L305.48878222 244.39466667 153.37244445 92.35114667a9.13863111 9.13863111 0 0 0-12.8159289 0L92.27832889 140.48369778a9.10222222 9.10222222 0 0 0 0 12.88874667l152.18915556 152.11633777z m638.75754666-213.13763556a9.13863111 9.13863111 0 0 0-12.81592888 0l-152.18915556 152.04352-49.66172444-49.73454222a9.10222222 9.10222222 0 0 0-15.51018667 5.27928888v0.0364089l-21.48124445 182.19008c-0.72817778 5.82542222 4.22343111 10.77703111 10.12167112 10.19448888l182.26289777-21.55406222a9.10222222 9.10222222 0 0 0 5.38851556-15.51018666l-49.95299556-49.95299556L931.4304 153.37244445a9.13863111 9.13863111 0 0 0 0-12.8159289l-48.27818667-48.27818666z m-230.10417778 731.60021333a9.10222222 9.10222222 0 0 0 15.4373689 5.38851556l49.66172444-49.73454223 152.18915556 151.97070223a9.13863111 9.13863111 0 0 0 12.81592888 0l48.27818667-48.05973333a9.10222222 9.10222222 0 0 0 0-12.88874667l-152.18915555-152.18915556 49.95299555-49.88017777a9.10222222 9.10222222 0 0 0-5.27928889-15.51018667h-0.03640889l-182.26289777-21.48124445a9.10222222 9.10222222 0 0 0-10.1944889 10.15808v-0.03640888l21.55406223 182.26289777zM140.48369778 931.4304a9.13863111 9.13863111 0 0 0 12.81592889 0l152.18915555-152.04352 49.66172445 49.73454222c5.38851555 5.31569778 14.56355555 2.18453333 15.51018666-5.38851555l21.48124445-182.11726222a9.10222222 9.10222222 0 0 0-10.15808-10.1944889h0.03640889l-182.26289778 21.55406223a9.10222222 9.10222222 0 0 0-5.38851556 15.51018667l49.95299556 49.80736-152.11633778 152.04352a9.13863111 9.13863111 0 0 0 0 12.81592888l48.27818667 48.27818667z","p-id":"3998"},null,-1),Pe=[Ie];function Te(e,n){return h(),x("svg",Ce,Pe)}const Fe=ie(Se,[["render",Te]]);function $e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function W(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?_(Object(t),!0).forEach(function(r){$e(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Ae(e,n){if(e==null)return{};var t={},r=Object.keys(e),a,o;for(o=0;o<r.length;o++)a=r[o],!(n.indexOf(a)>=0)&&(t[a]=e[a]);return t}function xe(e,n){if(e==null)return{};var t=Ae(e,n),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(n.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,r)||(t[r]=e[r]))}return t}function Me(e,n){return De(e)||Ee(e,n)||Be(e,n)||Ne()}function De(e){if(Array.isArray(e))return e}function Ee(e,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var t=[],r=!0,a=!1,o=void 0;try{for(var i=e[Symbol.iterator](),l;!(r=(l=i.next()).done)&&(t.push(l.value),!(n&&t.length===n));r=!0);}catch(c){a=!0,o=c}finally{try{!r&&i.return!=null&&i.return()}finally{if(a)throw o}}return t}}function Be(e,n){if(!!e){if(typeof e=="string")return V(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V(e,n)}}function V(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function Ne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Le(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?q(Object(t),!0).forEach(function(r){Le(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function ze(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(r){return n.reduceRight(function(a,o){return o(a)},r)}}function b(e){return function n(){for(var t=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return n.apply(t,[].concat(a,l))}}}function C(e){return{}.toString.call(e).includes("Object")}function ke(e){return!Object.keys(e).length}function w(e){return typeof e=="function"}function _e(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function We(e,n){return C(n)||p("changeType"),Object.keys(n).some(function(t){return!_e(e,t)})&&p("changeField"),n}function Ve(e){w(e)||p("selectorType")}function qe(e){w(e)||C(e)||p("handlerType"),C(e)&&Object.values(e).some(function(n){return!w(n)})&&p("handlersType")}function He(e){e||p("initialIsRequired"),C(e)||p("initialType"),ke(e)&&p("initialContent")}function Re(e,n){throw new Error(e[n]||e.default)}var Ue={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},p=b(Re)(Ue),S={changes:We,selector:Ve,handler:qe,initial:He};function Ke(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};S.initial(e),S.handler(n);var t={current:e},r=b(Ge)(t,n),a=b(Ye)(t),o=b(S.changes)(e),i=b(Je)(t);function l(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(f){return f};return S.selector(u),u(t.current)}function c(u){ze(r,a,o,i)(u)}return[l,c]}function Je(e,n){return w(n)?n(e.current):n}function Ye(e,n){return e.current=H(H({},e.current),n),n}function Ge(e,n,t){return w(n)?n(e.current):Object.keys(t).forEach(function(r){var a;return(a=n[r])===null||a===void 0?void 0:a.call(n,e.current[r])}),t}var Qe={create:Ke},Xe={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function Ze(e){return function n(){for(var t=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return n.apply(t,[].concat(a,l))}}}function et(e){return{}.toString.call(e).includes("Object")}function tt(e){return e||R("configIsRequired"),et(e)||R("configType"),e.urls?(nt(),{paths:{vs:e.urls.monacoBase}}):e}function nt(){console.warn(G.deprecation)}function rt(e,n){throw new Error(e[n]||e.default)}var G={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},R=Ze(rt)(G),at={config:tt},ot=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return function(a){return t.reduceRight(function(o,i){return i(o)},a)}};function Q(e,n){return Object.keys(n).forEach(function(t){n[t]instanceof Object&&e[t]&&Object.assign(n[t],Q(e[t],n[t]))}),W(W({},e),n)}var it={type:"cancelation",msg:"operation is manually canceled"};function F(e){var n=!1,t=new Promise(function(r,a){e.then(function(o){return n?a(it):r(o)}),e.catch(a)});return t.cancel=function(){return n=!0},t}var ut=Qe.create({config:Xe,isInitialized:!1,resolve:null,reject:null,monaco:null}),X=Me(ut,2),O=X[0],I=X[1];function ct(e){var n=at.config(e),t=n.monaco,r=xe(n,["monaco"]);I(function(a){return{config:Q(a.config,r),monaco:t}})}function lt(){var e=O(function(n){var t=n.monaco,r=n.isInitialized,a=n.resolve;return{monaco:t,isInitialized:r,resolve:a}});if(!e.isInitialized){if(I({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),F($);if(window.monaco&&window.monaco.editor)return Z(window.monaco),e.resolve(window.monaco),F($);ot(st,ft)(gt)}return F($)}function st(e){return document.body.appendChild(e)}function dt(e){var n=document.createElement("script");return e&&(n.src=e),n}function ft(e){var n=O(function(r){var a=r.config,o=r.reject;return{config:a,reject:o}}),t=dt("".concat(n.config.paths.vs,"/loader.js"));return t.onload=function(){return e()},t.onerror=n.reject,t}function gt(){var e=O(function(t){var r=t.config,a=t.resolve,o=t.reject;return{config:r,resolve:a,reject:o}}),n=window.require;n.config(e.config),n(["vs/editor/editor.main"],function(t){Z(t),e.resolve(t)},function(t){e.reject(t)})}function Z(e){O().monaco||I({monaco:e})}function pt(){return O(function(e){var n=e.monaco;return n})}var $=new Promise(function(e,n){return I({resolve:e,reject:n})}),mt={config:ct,init:lt,__getMonacoInstance:pt};const U=mt,K={automaticLayout:!0,contextmenu:!1,fixedOverflowWidgets:!0,fontFamily:'Menlo-Regular, Monaco, Menlo, Consolas, "Ubuntu Mono", monospace',formatOnPaste:!0,formatOnType:!0,insertSpaces:!0,lineDecorationsWidth:7,lineHeight:15,lineNumbersMinChars:3,minimap:{enabled:!1},quickSuggestions:!1,readOnly:!1,roundedSelection:!1,scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:6,horizontalScrollbarSize:6,alwaysConsumeMouseWheel:!1,arrowSize:0},snippetSuggestions:"none",tabSize:2,theme:"vs-dark",wordBasedSuggestions:!1,wordWrap:"on",cursorStyle:"line",selectOnLineNumbers:!0,autoIndent:"advanced",glyphMargin:!1,guides:{indentation:!0},renderLineHighlight:"line",renderWhitespace:"none",scrollBeyondLastColumn:2},ht=e=>{const n="datav-dark-theme";return e.editor.defineTheme(n,{base:"vs-dark",inherit:!0,rules:[{token:"key",foreground:"dddddd"},{token:"string.key.json",foreground:"dddddd"},{token:"string.value.json",foreground:"b4e98c"}],colors:{"editor.background":"#0e1013","editor.lineHighlightBackground":"#1f2329","editorLineNumber.foreground":"#576369","editorCursor.foreground":"#2483ff"}}),n};let M=[];const vt=(e,n)=>{const t=[];for(let r=0;r<M.length;r++){const a=M[r];t.push({label:`:${a}`,insertText:a,kind:e.languages.CompletionItemKind.Variable,detail:"CallbackId",range:n})}return t},J=new Map,bt=(e,n,t)=>{if(t&&t.length>0){if(M=t,J.has(n))return;J.set(n,1),e.languages.registerCompletionItemProvider(n,{triggerCharacters:[":"],provideCompletionItems(r,a){const o=r.getWordUntilPosition(a),i={startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:o.startColumn,endColumn:o.endColumn};return{suggestions:vt(e,i)}}})}},Y=(e,n)=>{let t=n;return(ue(t)||ce(t))&&(t=JSON.stringify(t,null,2)),le(t)?t:`${t}`},A=(e,n)=>{n==="sql"||e.getAction("editor.action.formatDocument").run()},yt={key:0,class:"datav-editor-actions"},wt={class:"datav-fullscreen-editor-wp"},Ot=y("section",{style:{display:"flex",position:"relative","text-align":"initial",width:"100%",height:"100%"}},null,-1),jt=[Ot],Pt=se({__name:"index",props:{language:{type:String,default:"plaintext"},code:{type:[String,Array,Object],default:""},readOnly:Boolean,useMinimap:Boolean,lineNumbers:{type:String,default:"on"},wordWrap:{type:String,default:"on"},autoFormat:Boolean,options:{type:Object,default(){return{}}},completions:Array,extra:Object,height:{type:Number,default:240},editorClass:String,fullScreenTitle:{type:String,default:"\u5168\u5C4F\u6A21\u5F0F"}},emits:["change","blur"],setup(e,{emit:n}){const t=e;U.config({paths:{vs:"https://unpkg.com/monaco-editor@0.33.0/min/vs"}});const r=de(),a="datav-dark-theme",o=`datav-editor-${fe()}`,i=B(!1),l=B(!1);let c=null,u=null,f=null;const ee=()=>{u&&ye(u.getValue()).then(()=>{r.success("\u590D\u5236\u6210\u529F")})},te=()=>{if(u){const s=u.getValue();n("change",{value:s,extra:t.extra})}},D=()=>{if(u){const s=u.getValue();n("blur",{value:s,extra:t.extra}),t.autoFormat&&A(u,t.language)}},E=ge(te,300),ne=()=>{i.value=!i.value,i.value&&N(()=>{re()})},re=()=>{const s=document.querySelector(".datav-fullscreen-editor > section");if(s){const d=Object.assign({},K,t.options,{tabSize:2,value:"",language:t.language,theme:a,readOnly:t.readOnly,minimap:{enabled:t.useMinimap},lineNumbers:t.lineNumbers,wordWrap:t.wordWrap}),g=c.editor.create(s,d);g.setValue(u.getValue()),t.autoFormat&&setTimeout(()=>{A(g,t.language)},1200),g.onDidChangeModelContent(()=>E()),g.onDidBlurEditorText(()=>D()),f=g}},ae=()=>{f&&(u&&!t.readOnly&&(u.setValue(f.getValue()),u.focus()),f.dispose())};return pe(()=>t.code,s=>{if(u){const d=Y(t.language,s);u.setValue(d)}}),me(async()=>{const s=setTimeout(()=>{l.value=!0},200);c=await U.init(),clearTimeout(s),l.value=!1,ht(c),bt(c,t.language,t.completions),await N();const d=document.getElementById(o);if(d){const g=Object.assign({},K,t.options,{tabSize:2,value:"",language:t.language,theme:a,readOnly:t.readOnly,minimap:{enabled:t.useMinimap},lineNumbers:t.lineNumbers,wordWrap:t.wordWrap}),v=c.editor.create(d,g),oe=Y(t.language,t.code);v.setValue(oe),t.autoFormat&&A(v,t.language),t.height>0&&(d.style.height=`${t.height}px`),v.onDidChangeModelContent(()=>E()),v.onDidBlurEditorText(()=>D()),u=v}}),he(()=>{u==null||u.dispose(),f==null||f.dispose()}),(s,d)=>(h(),x(be,null,[l.value?(h(),P(we,{key:0})):L("",!0),y("div",{id:o,class:k(["datav-editor",[{"--read-only":e.readOnly},e.editorClass]])},[l.value?L("",!0):(h(),x("div",yt,[j(m(z),{class:"action-btn",title:"\u70B9\u51FB\u590D\u5236",onClick:ee},{default:T(()=>[j(m(Oe))]),_:1}),j(m(z),{class:"action-btn",title:i.value?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F\u6A21\u5F0F\u4E0B\u7F16\u8F91\u6216\u67E5\u770B",onClick:ne},{default:T(()=>[i.value?(h(),P(m(Fe),{key:0})):(h(),P(m(je),{key:1}))]),_:1},8,["title"])]))],2),j(m(ve),{show:i.value,"onUpdate:show":d[0]||(d[0]=g=>i.value=g),title:`${e.fullScreenTitle}${e.readOnly?" ( \u53EA\u8BFB )":""}`,preset:"dialog","show-icon":!1,"mask-closable":!1,class:"datav-fullscreen-editor-dialog",style:{width:"90%","margin-top":"1%"},onAfterLeave:ae},{default:T(()=>[y("div",wt,[y("div",{class:k(["datav-editor datav-fullscreen-editor",[{"--read-only":e.readOnly}]])},jt,2)])]),_:1},8,["show","title"])],64))}});export{Pt as default};
