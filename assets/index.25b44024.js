var Ae=Object.defineProperty;var xe=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var fe=(s,e,t)=>e in s?Ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ie=(s,e)=>{for(var t in e||(e={}))He.call(e,t)&&fe(s,t,e[t]);if(xe)for(var t of xe(e))Oe.call(e,t)&&fe(s,t,e[t]);return s};var W=(s,e,t)=>(fe(s,typeof e!="symbol"?e+"":e,t),t);import{a6 as C,aa as k,ad as w,a4 as q,aC as x,ac as b,ah as he,a9 as T,aF as Ge,aj as Ne,ax as Ve,a5 as V,a7 as P,a$ as $e,aX as ce,ag as be,aZ as S,ab as G,ai as Le,ae as Q,af as de,aN as E,ba as pe,bb as ve,bq as ze,b6 as me,bk as Ce,aB as qe,n as je}from"./vendor.d03ee3fb.js";import{a as N,x as le,J as ge,a0 as Ze,a1 as ke,w as ye,Y as Ie,a2 as Je,C as Ue,y as Ke,I as Qe,a3 as Pe}from"./AppRoot.2c69a8d3.js";import{c as et}from"./index.81881c31.js";import{a as ne,o as X,b as B,c as Re}from"./dom.616b1dc0.js";import{u as we}from"./index.8e553625.js";import"./templates.31a29605.js";import"./warning.07582945.js";const tt={},st={t:"1639130833808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},nt=w("path",{d:"M341.33333333 579.33333333C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c85.336 0 170.664 58 256 174C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-85.336 0-170.664-48.664-256-146z m96-5.6C490.66933333 632.13333333 543.99733333 661.33333333 597.33333333 661.33333333s106.664-29.2 160-87.6C703.99733333 504.13333333 650.66933333 469.33333333 597.33333333 469.33333333s-106.664 34.8-160 104.4zM597.33333333 629.33333333a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"3986"},null,-1),ot=[nt];function at(s,e){return C(),k("svg",st,ot)}var rt=N(tt,[["render",at]]);const lt={},it={t:"1639130872871",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4135",width:"64",height:"64"},ct=w("path",{d:"M651.14133333 413.01333333l-56.344 56.344C542.30933333 470.45333333 489.82133333 505.23733333 437.33333333 573.73333333a416 416 0 0 0 26.48 26.6l-49.976 49.984c-24.168-19.76-48.336-43.416-72.504-70.984C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c17.936 0 35.872 2.56 53.808 7.68z m113.968 67.056c29.408 26.2 58.816 59.28 88.224 99.264C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-22.456 0-44.92-3.368-67.376-10.112l54.456-54.456c4.304 0.376 8.616 0.568 12.92 0.568 53.336 0 106.664-29.2 160-87.6-13.368-17.44-26.736-32.704-40.112-45.784l47.888-47.88zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"4136"},null,-1),dt=w("path",{d:"M770.34933333 339.06133333l45.256 45.256-407.288 407.288-45.256-45.256z","p-id":"4137"},null,-1),ut=[ct,dt];function ht(s,e){return C(),k("svg",it,ut)}var ft=N(lt,[["render",ht]]);const mt=q({name:"AlignLine",setup(){const s=le();return{alignLine:x(()=>s.alignLine),canvas:x(()=>s.canvas)}}}),pt={key:0,class:"ident-line-wp"};function vt(s,e,t,o,n,a){return s.alignLine.enable&&s.alignLine.show?(C(),k("div",pt,[w("div",{class:"ident-line x-line",style:b({width:`${s.canvas.width}px`,top:`${s.alignLine.top}px`})},null,4),w("div",{class:"ident-line x-line",style:b({width:`${s.canvas.width}px`,top:`${s.alignLine.horizontal}px`})},null,4),w("div",{class:"ident-line x-line",style:b({width:`${s.canvas.width}px`,top:`${s.alignLine.bottom}px`})},null,4),w("div",{class:"ident-line y-line",style:b({height:`${s.canvas.height}px`,left:`${s.alignLine.left}px`})},null,4),w("div",{class:"ident-line y-line",style:b({height:`${s.canvas.height}px`,left:`${s.alignLine.vertical}px`})},null,4),w("div",{class:"ident-line y-line",style:b({height:`${s.canvas.height}px`,left:`${s.alignLine.right}px`})},null,4)])):he("",!0)}var gt=N(mt,[["render",vt],["__scopeId","data-v-0f9e3b7f"]]);const re=s=>`${s}px`,Me=(s,e,t,o)=>{const n=s!=null?s:document.createElement("canvas");n.width=e*o,n.height=t*o,n.style.width=re(e),n.style.height=re(t);const a=n.getContext("2d");return a&&a.setTransform(o,0,0,o,0,0),n},Ee=(s,e,t,o)=>{var p,v;const n=parseFloat(s.style.transform.match(/(?<=X\()(.+)/ig)[0]),{height:a,scale:d,offset:h}=e;let i=0;return e.direction=="TB"?i=t-(((p=s.parentElement)==null?void 0:p.offsetLeft)||0)-n:i=o-(((v=s.parentElement)==null?void 0:v.offsetTop)||0)-n,i=i-a+e.indicatorLineWidth,{coor:Math.floor((i-h)/d),dist:i}},yt=(s,e)=>{const{scale:t,offset:o}=e;return{coor:s,dist:parseFloat((s*t+o).toFixed(3))}},ue=class{constructor(e,t,o,n=0){W(this,"guideLine");W(this,"coor",-1);this.el=e,this.options=t,this.constructGuide(o,n)}constructGuide(e,t){const{el:o}=this,n=document.createElement("div");n.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",ne(n,"ruler-line"),this.guideLine=n;const{coor:a}=this;this.setLine(e,t),e&&this.coorChange("add",this.coor,a);let d=o.querySelector(".lines-wrapper");d||(d=document.createElement("div"),ne(d,"lines-wrapper"),o.appendChild(d)),d.appendChild(n),X(n,"mousedown",this.moving.bind(this)),X(n,"dblclick",this.dblclick.bind(this))}moving(e){ue.isMoveing=!0;const{options:t}=this;e.preventDefault(),e.stopPropagation();const{coor:o}=this,n=d=>{t.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(d)},a=()=>{ue.isMoveing=!1,document.body.style.cursor="",B(document,"mousemove",n),B(document,"mouseup",a);const{coor:d}=this;d<0?this.coorChange("delete",o,o):this.coorChange("update",d,o)};X(document,"mousemove",n),X(document,"mouseup",a)}setLine(e,t=0){const{el:o,options:n,guideLine:a}=this,d=e?Ee(o,n,e.clientX,e.clientY):yt(t,n);n.direction==="TB"?a.style.left=re(d.dist):a.style.top=re(d.dist),a.innerHTML=`
      <div class="line-action">
        <span class="line-value">${d.coor}</span>
      </div>`,this.coor=d.coor}dblclick(e){e.preventDefault(),e.stopPropagation(),this.destroy()}coorChange(e,t,o){const{options:n}=this;n.coorChange&&n.coorChange(e,t,o)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:e,coor:t}=this;this.coorChange("delete",t,t),B(e,"mousedown",this.moving.bind(this)),B(e,"dblclick",this.dblclick.bind(this)),e.remove()}};let oe=ue;W(oe,"isMoveing",!1);class _e{constructor(e,t){W(this,"el");W(this,"canvas");W(this,"ctx");W(this,"ruler",{width:0,height:0});W(this,"indicator");W(this,"indicatorValue");W(this,"guideLines",[]);W(this,"options",{direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2});this.el=e,this.options=ie(ie({},this.options),t),this.constructRuler()}constructRuler(){const{el:e,options:t}=this,{direction:o,width:n,height:a,ratio:d}=t,h=Math.max(o==="TB"?e.offsetWidth:e.offsetHeight,n),i=a;this.ruler.width=h,this.ruler.height=i;const f=Me(null,h,i,d);ne(f,"canvas-ruler"),e.appendChild(f),this.canvas=f,this.ctx=f.getContext("2d"),this.drawRuler(),X(f,"mouseenter",this.constructIndicator.bind(this)),X(f,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:e,options:t,ruler:o}=this,{width:n,height:a}=o;e.beginPath(),e.fillStyle=t.bgColor,e.fillRect(0,0,n,a),e.closePath(),e.beginPath(),e.font=`${t.fontSize} ${t.fontFamily}`,e.textAlign="left",e.fillStyle=t.fontColor,e.strokeStyle=t.strokeStyle,e.lineWidth=t.lineWidth,this.drawPoints(),e.stroke()}drawPoints(){const{ctx:e,options:t,ruler:o}=this,{width:n,height:a}=o,{offset:d,scale:h}=t,i=0,f=a/1.5,p=a/1.2;for(let v=0;v<=n;v+=1){const y=v-d;if(y<0)continue;let I=-1,M=-1;y%50===0?(I=Math.floor(y/h),M=i):y%25===0?M=f:y%5===0&&(M=p),M>=0&&(e.moveTo(v+.5,a+.5),e.lineTo(v+.5,M),I>-1&&e.fillText(`${I}`,v+2.5,a/1.5))}}constructIndicator(e){if(oe.isMoveing)return;const{el:t,options:o,canvas:n}=this,a=document.createElement("div"),d=document.createElement("span");ne(a,"ruler-indicator"),ne(d,"indicator-value"),a.appendChild(d),this.indicator=a,this.indicatorValue=d,t.appendChild(a);const h=p=>{const v=Ee(t,o,p.clientX,p.clientY);a.style.left=re(v.dist),d.textContent=`${v.coor}`};h(e);const i=p=>{h(p)},f=()=>{B(n,"mousemove",i),B(n,"mouseout",f),a.remove()};X(n,"mousemove",i),X(n,"mouseout",f)}createGuideLine(e){e.preventDefault(),e.stopPropagation();const{el:t,options:o}=this;this.guideLines.push(new oe(t,o,e))}setGuideLines(e){const{el:t,options:o}=this;e.forEach(n=>{this.guideLines.push(new oe(t,o,null,n))})}setSize(e,t,o){const{el:n,options:a}=this;a.width=e,a.height=t,a.scale=o;const{direction:d,width:h,height:i,ratio:f}=a,p=Math.max(d==="TB"?n.offsetWidth:n.offsetHeight,h),v=i;this.ruler.width=p,this.ruler.height=v,Me(this.canvas,p,v,f),this.drawRuler(),this.guideLines.forEach(y=>y.setLine(null,y.coor))}setScale(e){this.options.scale=e,this.drawRuler(),this.guideLines.forEach(t=>t.setLine(null,t.coor))}toggleGuide(e){const t=e?"show":"hide";this.guideLines.forEach(o=>o[t]())}clearGuides(){this.guideLines.forEach(e=>e.destroy()),this.guideLines=[]}destroy(){const{el:e,canvas:t}=this;this.clearGuides(),B(t,"mouseenter",this.constructIndicator.bind(this)),B(t,"mousedown",this.createGuideLine.bind(this)),e.remove()}}const wt=q({name:"Ruler",components:{IconLineShow:rt,IconLineHide:ft},setup(){const s=le(),e=T(null),t=T(null),o=T(null),n=T(null),a=T(!0),d=T(0),h=T(0),i=document.documentElement.clientWidth;Ge(()=>{if(e.value&&t.value){const{canvas:v,guideLine:y}=s,I=Math.max(v.width,i);o.value?o.value.setSize(I,20,v.scale):(o.value=new _e(e.value,{direction:"TB",width:I,scale:v.scale,coorChange:(M,_,A)=>{M==="add"?y.h.push(_):M==="update"&&_!==A?(y.h=y.h.filter(Y=>Y!==A),y.h.push(_)):M==="delete"&&(y.h=y.h.filter(Y=>Y!==_))}}),o.value.setGuideLines(y.h)),n.value?n.value.setSize(v.height,20,v.scale):(n.value=new _e(t.value,{direction:"LR",width:v.height,scale:v.scale,coorChange:(M,_,A)=>{M==="add"?y.v.push(_):M==="update"&&_!==A?(y.v=y.v.filter(Y=>Y!==A),y.v.push(_)):M==="delete"&&(y.v=y.v.filter(Y=>Y!==_))}}),n.value.setGuideLines(y.v))}});const f=()=>{o.value&&n.value&&(a.value=!a.value,o.value.toggleGuide(a.value),n.value.toggleGuide(a.value))},p=v=>{const y=v.target;d.value=y.scrollLeft,h.value=y.scrollTop};return Ne(()=>{const v=document.getElementById("canvas-wp");v==null||v.addEventListener("scroll",p)}),Ve(()=>{const v=document.getElementById("canvas-wp");v==null||v.removeEventListener("scroll",p)}),{visible:a,hRulerWpRef:e,vRulerWpRef:t,toggleGuides:f,vScroll:h,hScroll:d}}}),xt={class:"canvas-ruler-wp"};function $t(s,e,t,o,n,a){const d=V("IconLineShow"),h=V("n-icon"),i=V("IconLineHide");return C(),k("div",xt,[w("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:b(`transform: translateX(-${s.hScroll}px);`)},null,4),w("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:b(`transform: rotate(90deg) translateX(-${s.vScroll}px);`)},null,4),w("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:e[0]||(e[0]=(...f)=>s.toggleGuides&&s.toggleGuides(...f))},[s.visible?(C(),P(h,{key:0},{default:$e(()=>[ce(d)]),_:1})):(C(),P(h,{key:1},{default:$e(()=>[ce(i)]),_:1}))])])}var bt=N(wt,[["render",$t]]);const Ct={class:"canvas-selection"},Mt=["d"],_t=q({props:{startX:{type:Number,default:0},startY:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0}},setup(s){return(e,t)=>(C(),k("svg",Ct,[w("path",{fill:"none",stroke:"rgba(255,255,255,0.5)",d:`M ${s.startX},${s.startY} L ${s.startX},${s.startY+s.height} L ${s.startX+s.width},${s.startY+s.height} L ${s.startX+s.width},${s.startY} Z`,style:{"stroke-width":"1","stroke-dasharray":"3, 3"}},null,8,Mt)]))}});var St=N(_t,[["__scopeId","data-v-3f06663a"]]);const Lt=[{direction:"lt",angle:0,cursor:"nwse-resize",singleCursor:"nw-resize"},{direction:"t",angle:45,cursor:"ns-resize",singleCursor:"n-resize"},{direction:"rt",angle:90,cursor:"nesw-resize",singleCursor:"ne-resize"},{direction:"r",angle:135,cursor:"ew-resize",singleCursor:"e-resize"},{direction:"rb",angle:180,cursor:"nwse-resize",singleCursor:"se-resize"},{direction:"b",angle:225,cursor:"ns-resize",singleCursor:"s-resize"},{direction:"lb",angle:270,cursor:"nesw-resize",singleCursor:"sw-resize"},{direction:"l",angle:315,cursor:"ew-resize",singleCursor:"w-resize"}],Se=[{start:338,end:23,cursor:"nwse-resize",singleCursor:"nw-resize"},{start:23,end:68,cursor:"ns-resize",singleCursor:"n-resize"},{start:68,end:113,cursor:"nesw-resize",singleCursor:"ne-resize"},{start:113,end:158,cursor:"ew-resize",singleCursor:"e-resize"},{start:158,end:203,cursor:"nwse-resize",singleCursor:"se-resize"},{start:203,end:248,cursor:"ns-resize",singleCursor:"s-resize"},{start:248,end:293,cursor:"nesw-resize",singleCursor:"sw-resize"},{start:293,end:338,cursor:"ew-resize",singleCursor:"w-resize"}],Te=s=>{const e=(s+360)%360,t={};let o=-1;return Lt.forEach(n=>{const a=(n.angle+e)%360,d=Se.length,h=0;for(;h<d;){o=(o+1)%d;const i=Se[o];if(a<23||a>=338){t[n.direction]="nwse-resize";break}if(i.start<=a&&a<i.end){t[n.direction]=i.cursor;break}}}),t};function zt(s,e){return{x:s.x+(e.x-s.x)/2,y:s.y+(e.y-s.y)/2}}function ae(s,e,t){const o=Ze(t);return{x:(s.x-e.x)*Math.cos(o)-(s.y-e.y)*Math.sin(o)+e.x,y:(s.x-e.x)*Math.sin(o)+(s.y-e.y)*Math.cos(o)+e.y}}function kt(s,e,t,o,n,a){const d=zt(t,o),h=ae(o,d,-e.deg),i=ae(t,d,-e.deg);s[0]==="l"?(a.x=Math.round(i.x/n),a.w=Math.round((h.x-i.x)/n)):s[0]==="r"&&(a.x=Math.round(h.x/n),a.w=Math.round((i.x-h.x)/n)),s[1]==="t"?(a.y=Math.round(i.y/n),a.h=Math.round((h.y-i.y)/n)):s[1]==="b"&&(a.y=Math.round(h.y/n),a.h=Math.round((i.y-h.y)/n))}function It(s,e,t,o,n,a,d){const h=ae(o,t,-e.deg);if(s==="t"||s==="b"){const i=ae({x:t.x,y:h.y},t,e.deg),f=Math.sqrt((i.x-n.x)**2+(i.y-n.y)**2);if(f>0){const p={x:i.x-(i.x-n.x)/2,y:i.y+(n.y-i.y)/2};d.h=Math.round(f/a),d.x=Math.round(p.x/a-e.w/2),d.y=Math.round((p.y-f/2)/a)}}if(s==="l"||s==="r"){const i=ae({x:h.x,y:t.y},t,e.deg),f=Math.sqrt((i.x-n.x)**2+(i.y-n.y)**2);if(f>0){const p={x:i.x-(i.x-n.x)/2,y:i.y+(n.y-i.y)/2};d.w=Math.round(f/a),d.x=Math.round((p.x-f/2)/a),d.y=Math.round(p.y/a-e.h/2)}}}function Rt(s,e,t,o,n,a){s==="t"?(a.h=Math.round(e.h+(t.y-o.y)/n),a.y=Math.round(e.y+(o.y-t.y)/n)):s==="rt"?(a.h=Math.round(e.h+(t.y-o.y)/n),a.w=Math.round(e.w+(o.x-t.x)/n),a.y=Math.round(e.y+(o.y-t.y)/n)):s==="r"?a.w=Math.round(e.w+(o.x-t.x)/n):s==="rb"?(a.h=Math.round(e.h+(o.y-t.y)/n),a.w=Math.round(e.w+(o.x-t.x)/n)):s==="b"?a.h=Math.round(e.h+(o.y-t.y)/n):s==="lb"?(a.h=Math.round(e.h+(o.y-t.y)/n),a.w=Math.round(e.w+(t.x-o.x)/n),a.x=Math.round(e.x+(o.x-t.x)/n)):s==="l"?(a.w=Math.round(e.w+(t.x-o.x)/n),a.x=Math.round(e.x+(o.x-t.x)/n)):s==="lt"&&(a.h=Math.round(e.h+(t.y-o.y)/n),a.w=Math.round(e.w+(t.x-o.x)/n),a.x=Math.round(e.x+(o.x-t.x)/n),a.y=Math.round(e.y+(o.y-t.y)/n))}const Xe=(s,e,t,o,n,a,d)=>{const h=ie({},t.attr),i=Object.create(null);let f,p,v;const y={x:0,y:0};if(n)p={x:s.clientX,y:s.clientY};else{const _={x:(h.x+h.w/2)*o,y:(h.y+h.h/2)*o};f=document.getElementById("canvas-coms").getBoundingClientRect(),p={x:s.clientX-f.left,y:s.clientY-f.top},v={x:_.x-(p.x-_.x),y:_.y-(p.y-_.y)}}const I=_=>{n?(y.x=_.clientX,y.y=_.clientY,Rt(e,h,p,y,o,i)):(y.x=_.clientX-f.left,y.y=_.clientY-f.top,e.length===1?It(e,h,p,y,v,o,i):kt(e,h,y,v,o,i)),i.x!=null&&(t.attr.x=i.x),i.y!=null&&(t.attr.y=i.y),i.w!=null&&(t.scaling.w=Math.max(10,i.w)),i.h!=null&&(t.scaling.h=Math.max(10,i.h)),a()},M=()=>{B(document,"mousemove",I),B(document,"mouseup",M),d()};X(document,"mousemove",I),X(document,"mouseup",M)},Be=(s,e,t,o,n,a)=>{const{x:d,y:h}=e.attr,i=p=>{e.attr.x=d+Math.round((p.clientX-s.clientX)/t/o)*o,e.attr.y=h+Math.round((p.clientY-s.clientY)/t/o)*o,n()},f=()=>{B(document,"mousemove",i),B(document,"mouseup",f),a()};X(document,"mousemove",i),X(document,"mouseup",f)},Ye=(s,e,t,o)=>{const n=e.getBoundingClientRect(),a=n.left+n.width/2,d=n.top+n.height/2;let h=0;const i=Math.atan2(d-s.clientY,a-s.clientX)*180/Math.PI-t.attr.deg,f=v=>{const y=Math.atan2(d-v.clientY,a-v.clientX)*180/Math.PI-i;h=Math.round(y%360),t.attr.deg=h<0?h+360:h},p=()=>{B(document,"mousemove",f),B(document,"mouseup",p),o(h)};X(document,"mousemove",f),X(document,"mouseup",p)},De=(s,e)=>{s.attr.deg=0,s.children.forEach(t=>{if(t.type===ge.layer)De(t,e);else{const o=Math.round((t.attr.deg+e)%360);t.attr.deg=o<0?o+360:o}})};const Et=q({name:"ReferLine",props:{pos:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(s){const o=x(()=>({height:`${s.pos.y+60/s.scale}px`,borderLeftWidth:`${.9/s.scale}px`})),n=x(()=>({width:`${s.pos.x+60/s.scale}px`,borderTopWidth:`${.9/s.scale}px`})),a=x(()=>({fontSize:`${12/s.scale}px`,top:`-${6/s.scale}px`,left:`-${6/s.scale}px`}));return{topLineStyle:o,leftLineStyle:n,accountStyle:a}}}),Tt={class:"nav-line"};function Xt(s,e,t,o,n,a){return C(),k("div",Tt,[w("div",{class:"nav-line-top",style:b(s.topLineStyle)},null,4),w("div",{class:"nav-line-left",style:b(s.leftLineStyle)},null,4),w("div",{class:"nav-line-account",style:b(s.accountStyle)},be(s.pos.x)+", "+be(s.pos.y),5)])}var Fe=N(Et,[["render",Xt],["__scopeId","data-v-ef0c624a"]]);const Bt=s=>(pe("data-v-2dbcb332"),s=s(),ve(),s),Yt=["onMouseenter","onMouseleave","onMousedown","onDblclick"],Dt=["onMousedown"],Ft=["onMousedown"],Wt=["onMousedown"],At=Bt(()=>w("div",{class:"transform-bg"},null,-1)),Ht=q({props:{com:{type:Object,required:!0},parentCom:{type:Object},editable:{type:Boolean}},setup(s){const e=s;ke(e.com);const t=ze(),o=le(),n=ye(),{showMenu:a,hideMenu:d}=we(),h=T(!1),i=x(()=>o.canvas.scale),f=x(()=>o.referLine),p=x(()=>{let{x:m,y:g}=e.com.attr;return L().coms.forEach(r=>{m+=r.attr.x,g+=r.attr.y}),{x:m,y:g}}),v=x(()=>({selected:e.com.selected,hided:e.com.hided,locked:e.com.locked})),y=x(()=>{const{x:m,y:g,w:l,h:r}=e.com.attr;return{top:0,left:0,width:`${l}px`,height:`${r}px`,transform:`translate(${m}px, ${g}px)`}}),I=x(()=>{const{zoom:m,sx:g,sy:l}=e.com.scaling;return{display:e.com.hided?"none":"block",transform:m?`scale(${g.toFixed(6)}, ${l.toFixed(6)})`:void 0}}),M=x(()=>({hided:!e.com.selected||e.com.locked})),_=x(()=>{const m={cursor:e.com.selected?"move":"inherit",transform:`rotate(${e.com.attr.deg}deg)`},{zoom:g,sx:l,sy:r}=e.com.scaling;return g&&(m.transform=`scale(${(1/l).toFixed(6)}, ${(1/r).toFixed(6)}) ${m.transform} scale(${l.toFixed(6)}, ${r.toFixed(6)})`),m}),A=x(()=>{const{hided:m,attr:g}=e.com,l=o.pageConfig.styleFilterParams;let r="";return l.enable&&(r=`hue-rotate(${l.hue}deg) contrast(${l.contrast}%) opacity(${l.opacity}%) saturate(${l.saturate}%) brightness(${l.brightness}%)`),{display:m?"none":"block",transform:`scaleX(${g.filpH?-1:1}) scaleY(${g.filpV?-1:1}) rotateZ(360deg)`,filter:r}}),Y=x(()=>({width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`})),D=x(()=>{var m;return{hovered:(m=e.parentCom)==null?void 0:m.selected}}),F=x(()=>Te(e.com.attr.deg)),ee=x(()=>{const{zoom:m,sx:g,sy:l}=e.com.scaling,r=m?`scale(${1/g/i.value}, ${1/l/i.value})`:`scale(${1/i.value}, ${1/i.value})`;return{t:{name:"top",style:{cursor:F.value.t,transform:r}},rt:{name:"top-right",style:{cursor:F.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:r}},r:{name:"right",style:{cursor:F.value.r,transform:r}},rb:{name:"bottom-right",style:{cursor:F.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:r}},b:{name:"bottom",style:{cursor:F.value.b,transform:r}},lb:{name:"bottom-left",style:{cursor:F.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:r}},l:{name:"left",style:{cursor:F.value.l,transform:r}},lt:{name:"top-left",style:{cursor:F.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:r}}}}),te=()=>{e.parentCom?e.editable&&!e.com.selected&&(e.com.hovered=!0):e.com.selected||(e.com.hovered=!0)},j=()=>{e.com.hovered=!1},Z=m=>{const g=Ie(m);!g&&e.com.selected||n.select(e.com.id,e.com.parentId,g)},se=m=>{e.parentCom&&!e.editable?a(m,e.parentCom):a(m,e.com)},J=m=>{if(e.parentCom&&!e.editable){const g=L(),l=g.editables.lastIndexOf(!1);g.instances[l].exposed.onMove(m)}else U(m)},U=m=>{if(o.contextMenu.show)return d(),!1;if(!e.com.selected)return Re(m.target,"mouseup",Z),!1;n.selectedComs.forEach(g=>{Be(m,g,i.value,o.pageConfig.grid,()=>{e.com.id===g.id&&(h.value=!0,o.calcAlignLine(e.com))},()=>{if(e.com.id===g.id)if(h.value){h.value=!1,o.hideAlignLine(e.com.id);const l=L();l.coms.length>0&&n.resizeParents(l.coms)}else m.button===0&&n.select(e.com.id,e.com.parentId)})})},$=(m,g)=>{if(d(),!e.com.selected)return!1;const l=(r,u)=>{r.scaling.w=r.attr.w,r.scaling.h=r.attr.h,Xe(m,g,r,i.value,u,()=>{r.scaling.zoom=!0,r.scaling.sx=r.scaling.w/r.attr.w,r.scaling.sy=r.scaling.h/r.attr.h},()=>{r.scaling.zoom=!1,r.scaling.sx=1,r.scaling.sy=1,r.attr.w=r.scaling.w,r.attr.h=r.scaling.h;const c=L();c.coms.length>0&&n.resizeParents(c.coms)})};n.selectedComs.length>1?n.selectedComs.forEach(r=>{l(r,!0)}):l(e.com,o.isNormalResizeMode)},R=m=>{d(),n.selectedComs.forEach(g=>{Ye(m,t.vnode.el,g,()=>{})})},L=()=>{const m=[],g=[],l=[],r=u=>{var z;const c=u.props.parentCom;c&&(m.push(c),g.push((z=u.props.editable)!=null?z:!1),l.push(u.parent),r(u.parent))};return r(t),{coms:m,editables:g,instances:l}},H=m=>{e.parentCom&&!e.editable&&(e.parentCom.selected?Z(m):L().instances[0].exposed.selectCom(m))};return(m,g)=>(C(),k("div",{class:G(["datav-transform",S(v)]),style:b(S(y))},[S(f).enable&&s.com.selected?(C(),P(Fe,{key:0,pos:S(p),scale:S(i)},null,8,["pos","scale"])):he("",!0),w("div",{class:G(["datav-scale",{hovered:s.com.hovered,"--relative-hovered":S(D).hovered}]),style:b(S(I)),onMouseenter:E(te,["stop"]),onMouseleave:E(j,["stop"]),onMousedown:E(J,["stop"]),onContextmenu:se,onClick:g[0]||(g[0]=E(()=>{},["stop"])),onDblclick:E(H,["stop"])},[w("div",{class:G(["transform-handler",S(M)]),style:b(S(_))},[w("div",{class:"datav-com",style:b(S(A))},[Le(m.$slots,"default",{},void 0,!0),w("div",{class:"datav-wrapper-event-disable",style:b(S(Y))},null,4)],4),(C(!0),k(Q,null,de(S(ee),(l,r)=>(C(),k(Q,{key:r},[l.rotateStyle?(C(),k("i",{key:0,class:G(`${l.name}-handler`),"data-html2canvas-ignore":""},[w("span",{class:"rotate-handler",style:b(l.rotateStyle),onMousedown:E(R,["stop"])},[w("span",{class:"control-point",style:b(l.style),onMousedown:E(u=>$(u,r),["stop"])},null,44,Ft)],44,Dt)],2)):(C(),k("i",{key:1,class:G(`${l.name}-handler`),"data-html2canvas-ignore":""},[w("span",{class:"control-point",style:b(l.style),onMousedown:E(u=>$(u,r),["stop"])},null,44,Wt)],2))],64))),128)),At],6)],46,Yt)],6))}});var Ot=N(Ht,[["__scopeId","data-v-2dbcb332"]]);const Gt=s=>(pe("data-v-c93f8586"),s=s(),ve(),s),Nt=["onMouseenter","onMouseleave","onMousedown","onDblclick"],Vt=["onMousedown"],qt=["onMousedown"],jt=["onMousedown"],Zt=Gt(()=>w("div",{class:"transform-bg"},null,-1)),Jt=q({props:{com:{type:Object,required:!0},parentCom:{type:Object},editable:{type:Boolean}},setup(s,{expose:e}){const t=s;ke(t.com);const o=ze(),n=le(),a=ye(),{showMenu:d,hideMenu:h}=we(),i=T(!1),f=x(()=>n.canvas.scale),p=x(()=>n.referLine),v=x(()=>{let{x:l,y:r}=t.com.attr;return m().coms.forEach(c=>{l+=c.attr.x,r+=c.attr.y}),{x:l,y:r}}),y=x(()=>({selected:t.com.selected,hided:t.com.hided,locked:t.com.locked})),I=x(()=>{const{x:l,y:r,w:u,h:c}=t.com.attr;return{top:0,left:0,width:`${u}px`,height:`${c}px`,transform:`translate(${l}px, ${r}px)`}}),M=x(()=>{const{zoom:l,sx:r,sy:u}=t.com.scaling;return{transform:l?`scale(${r.toFixed(6)}, ${u.toFixed(6)})`:"none"}}),_=x(()=>{const l={transform:`rotate(${t.com.attr.deg}deg)`,opacity:t.com.attr.opacity,overflow:"visible",display:t.com.hided?"none":"block"},{zoom:r,sx:u,sy:c}=t.com.scaling;return r&&(l.transform=`scale(${(1/u).toFixed(6)}, ${(1/c).toFixed(6)}) ${l.transform} scale(${u.toFixed(6)}, ${c.toFixed(6)})`),l}),A=x(()=>({hided:!t.com.selected||t.com.locked})),Y=x(()=>{const{selected:l,attr:r}=t.com,u=l?"move":"inherit";return r.apply3d?{cursor:u,perspective:`${r.perspective}px`,"perspective-origin":`${r.perspectiveOrigin.x}% ${r.perspectiveOrigin.y}%`}:{cursor:u}}),D=x(()=>Te(t.com.attr.deg)),F=x(()=>{const{zoom:l,sx:r,sy:u}=t.com.scaling,c=l?`scale(${1/r/f.value}, ${1/u/f.value})`:`scale(${1/f.value}, ${1/f.value})`;return{t:{name:"top",style:{cursor:D.value.t,transform:c}},rt:{name:"top-right",style:{cursor:D.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:c}},r:{name:"right",style:{cursor:D.value.r,transform:c}},rb:{name:"bottom-right",style:{cursor:D.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:c}},b:{name:"bottom",style:{cursor:D.value.b,transform:c}},lb:{name:"bottom-left",style:{cursor:D.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:c}},l:{name:"left",style:{cursor:D.value.l,transform:c}},lt:{name:"top-left",style:{cursor:D.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:c}}}}),ee=()=>{t.parentCom?t.editable&&!t.com.selected&&(t.com.hovered=!0):t.com.selected||(t.com.hovered=!0)},te=()=>{t.com.hovered=!1},j=l=>{const r=Ie(l);!r&&t.com.selected||a.select(t.com.id,t.com.parentId,r)},Z=l=>{t.parentCom&&!t.editable?d(l,t.parentCom):d(l,t.com)},se=l=>{if(t.parentCom&&!t.editable){const r=m(),u=r.editables.lastIndexOf(!1);r.instances[u].exposed.onMove(l)}else J(l)},J=l=>{if(n.contextMenu.show)return h(),!1;if(!t.com.selected)return Re(l.target,"mouseup",j),!1;a.selectedComs.forEach(r=>{Be(l,r,f.value,n.pageConfig.grid,()=>{t.com.id===r.id&&(i.value=!0,n.calcAlignLine(t.com))},()=>{if(t.com.id===r.id)if(i.value){i.value=!1,n.hideAlignLine(t.com.id);const u=m();u.coms.length>0&&a.resizeParents(u.coms)}else l.button===0&&a.select(t.com.id,t.com.parentId)})})},U=(l,r)=>{if(h(),!t.com.selected)return!1;const u=(c,z)=>{c.scaling.w=c.attr.w,c.scaling.h=c.attr.h,Xe(l,r,c,f.value,z,()=>{c.scaling.zoom=!0,c.scaling.sx=c.scaling.w/c.attr.w,c.scaling.sy=c.scaling.h/c.attr.h},()=>{a.resizeChildren(c),c.scaling.zoom=!1,c.scaling.sx=1,c.scaling.sy=1,c.attr.w=c.scaling.w,c.attr.h=c.scaling.h;const O=m();O.coms.length>0&&a.resizeParents(O.coms)})};a.selectedComs.length>1?a.selectedComs.forEach(c=>{u(c,!0)}):u(t.com,n.isNormalResizeMode)},$=l=>{h(),a.selectedComs.forEach(r=>{Ye(l,o.vnode.el,r,u=>{De(r,u)})})},R=x(()=>{var u;let l=(u=t.parentCom)==null?void 0:u.selected,r=!1;if(!l){const c=Je(t.com);l=c.hovered,r=c.selected}return{hovered:l||r,selected:r}}),L=(l,r)=>{const u=(c,z)=>c===z?1:0;return`rotate3d(${u(l,"x")}, ${u(l,"y")}, ${u(l,"z")}, ${r}deg)`},H=l=>{const{attr:r}=l,u={justifyContent:"center",alignItems:"center",display:"block",opacity:1,transform:"translate3d(0, 0, 0)",width:"auto",height:"auto",position:"absolute",transformOrigin:`${r.w/2+r.x}px ${r.h/2+r.y}`};if(t.com.attr.apply3d){const c=t.com.config.find(We=>We.transform3d.id===l.id),{rotate3d:z,scale3d:O,translate3d:K}=c.transform3d;u.transform=`translate3d(${K.x}px, ${K.y}px, ${K.z}px) scale3d(${O.x}, ${O.y}, 1) ${L(z.axis,z.deg)}`}return u},m=()=>{const l=[],r=[],u=[],c=z=>{var K;const O=z.props.parentCom;O&&(l.push(O),r.push((K=z.props.editable)!=null?K:!1),u.push(z.parent),c(z.parent))};return c(o),{coms:l,editables:r,instances:u}},g=l=>{t.parentCom&&!t.editable&&j(l)};return e({onMove:J,selectCom:j}),(l,r)=>(C(),k("div",{class:G(["datav-transform",S(y)]),style:b(S(I))},[S(p).enable&&s.com.selected?(C(),P(Fe,{key:0,pos:S(v),scale:S(f)},null,8,["pos","scale"])):he("",!0),w("div",{class:G(["datav-scale",{hovered:s.com.hovered,"--relative-hovered":S(R).hovered}]),style:b(S(M)),onMouseenter:E(ee,["stop"]),onMouseleave:E(te,["stop"]),onMousedown:E(se,["stop"]),onContextmenu:Z,onClick:r[0]||(r[0]=E(()=>{},["stop"])),onDblclick:E(g,["stop"])},[w("div",{class:"datav-layer slider",style:b(S(_))},[w("div",{class:G(["transform-handler",S(A)]),style:b(S(Y))},[(C(!0),k(Q,null,de(s.com.children,u=>(C(),k("div",{key:u.id,class:"slider-item",style:b(H(u))},[Le(l.$slots,"default",{data:u,editable:S(R).selected},void 0,!0)],4))),128)),(C(!0),k(Q,null,de(S(F),(u,c)=>(C(),k(Q,{key:c},[u.rotateStyle?(C(),k("i",{key:0,class:G(`${u.name}-handler`),"data-html2canvas-ignore":""},[w("span",{class:"rotate-handler",style:b(u.rotateStyle),onMousedown:E($,["stop"])},[w("span",{class:"control-point",style:b(u.style),onMousedown:E(z=>U(z,c),["stop"])},null,44,qt)],44,Vt)],2)):(C(),k("i",{key:1,class:G(`${u.name}-handler`),"data-html2canvas-ignore":""},[w("span",{class:"control-point",style:b(u.style),onMousedown:E(z=>U(z,c),["stop"])},null,44,jt)],2))],64))),128)),Zt],6)],4)],46,Nt)],6))}});var Ut=N(Jt,[["__scopeId","data-v-c93f8586"]]);const Kt=q({name:"DatavTransform",props:{com:{type:Object,required:!0}},setup(){const s=(e,t,o)=>e.type===ge.com?me(Ot,{com:e,parentCom:t,editable:o},{default:()=>me(V(e.name),{com:e,style:{transform:"translateZ(0)",opacity:e.attr.opacity}})}):me(Ut,{com:e,parentCom:t,editable:o},{default:({data:n,editable:a})=>s(n,e,a)});return{create:s}},render(){return this.create(this.$props.com)}});const Qt=q({name:"CanvasMain",components:{AlignLine:gt,Ruler:bt,CanvasArea:St,DatavTransform:Kt},setup(){const s=Ue(),e=ye(),t=le(),o=Ke(),{hideMenu:n}=we(),{pageConfig:a,canvas:d}=Ce(t),{coms:h}=Ce(e),i=T(!1),f=T(0),p=T(0),v=T(0),y=T(0),I=T(0),M=T(0),_=60,A=60,Y=x(()=>({width:`${d.value.width}px`,height:`${d.value.height}px`})),D=x(()=>({width:`${a.value.width}px`,height:`${a.value.height}px`,transform:`scale(${d.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${a.value.bgimage})`,backgroundColor:a.value.bgcolor})),F=async $=>{$.preventDefault();try{const R=$.dataTransfer.getData("text");if(R){s.addLoading();let L=await et(R);const{scale:H}=d.value,{left:m,top:g}=s.getPanelOffset,l=($.clientX-m)/H,r=($.clientY-g)/H;L.attr.x=Math.round(l-L.attr.w/2),L.attr.y=Math.round(r-L.attr.h/2),await e.add(L),e.select(L.id),s.removeLoading(),L.apis.source&&(await L.loadData(),je(()=>{var u;(u=o.events[L.id])==null||u.requestData()}))}}catch(R){Qe("dropToAddCom",R.message)}},ee=$=>{$.preventDefault(),$.stopPropagation(),$.dataTransfer.dropEffect="copy"},te=$=>{const R=$.target;["canvas-panel","screen-shot","canvas-panel-wrap"].includes(R.className)?i.value=!0:i.value=!1},j=()=>{i.value&&(i.value=!1,e.select(""))},Z=()=>{I.value=0,M.value=0},se=()=>h.value.filter($=>$.locked||$.hided||!$.hovered?($.selected=!1,!1):($.selected=!0,!0)),J=()=>{const{scale:$}=d.value,R=(v.value-_)/$,L=(y.value-A)/$,H=I.value/$,m=M.value/$;h.value.forEach(g=>{if(g.locked||g.hided)return;const{x:l,y:r,w:u,h:c}=g.attr,z={x:R,y:L,w:H,h:m},O={x:l,y:r,w:u,h:c};g.hovered=Pe(z,O)})},U=$=>{if(i.value=!0,t.contextMenu.show)return i.value=!1,n(),!1;const R=document.getElementById("screen-wp");f.value=R.clientWidth,p.value=R.clientHeight;const L=R.getBoundingClientRect(),H=L.x,m=L.y,g=$.clientX,l=$.clientY;v.value=g-H,y.value=l-m;const r=c=>{c.clientX<g&&(v.value=c.clientX-H),c.clientY<l&&(y.value=c.clientY-m),I.value=Math.abs(c.clientX-g),M.value=Math.abs(c.clientY-l),J(),i.value=!1},u=()=>{B(document,"mousemove",r),B(document,"mouseup",u),Z(),se(),i.value&&te($)};X(document,"mousemove",r),X(document,"mouseup",u)};return qe(()=>t.canvas.scale,()=>{Z(),n()}),{ComType:ge,coms:h,canvasPanelStyle:D,screenShotStyle:Y,selectionW:f,selectionH:p,areaStartX:v,areaStartY:y,areaWidth:I,areaHeight:M,dragOver:ee,dropToAddCom:F,handleMouseDown:U,cancelSelected:j}}}),Pt=s=>(pe("data-v-3beab75c"),s=s(),ve(),s),es={class:"canvas-main"},ts=Pt(()=>w("div",{class:"thumbnail"},null,-1));function ss(s,e,t,o,n,a){const d=V("datav-transform"),h=V("align-line"),i=V("ruler"),f=V("canvas-area");return C(),k("div",es,[w("div",{id:"canvas-wp",class:"canvas-panel-wrap",onClick:e[3]||(e[3]=(...p)=>s.cancelSelected&&s.cancelSelected(...p))},[w("div",{id:"screen-wp",class:"screen-shot",style:b(s.screenShotStyle),onMousedown:e[2]||(e[2]=(...p)=>s.handleMouseDown&&s.handleMouseDown(...p))},[w("div",{id:"canvas-coms",class:"canvas-panel",style:b(s.canvasPanelStyle),onDragover:e[0]||(e[0]=(...p)=>s.dragOver&&s.dragOver(...p)),onDrop:e[1]||(e[1]=(...p)=>s.dropToAddCom&&s.dropToAddCom(...p))},[(C(!0),k(Q,null,de(s.coms,p=>(C(),P(d,{key:p.id,com:p},null,8,["com"]))),128))],36),ce(h),ce(i)],36),s.areaWidth>0||s.areaHeight>0?(C(),P(f,{key:0,"start-x":s.areaStartX,"start-y":s.areaStartY,width:s.areaWidth,height:s.areaHeight,style:b({width:`${s.selectionW}px`,height:`${s.selectionH}px`})},null,8,["start-x","start-y","width","height","style"])):he("",!0)]),ts])}var us=N(Qt,[["render",ss],["__scopeId","data-v-3beab75c"]]);export{us as default};
