import{a as V,C as j,E as K,w as P,a5 as A}from"./AppRoot.2c69a8d3.js";import{I as z}from"./warning.07582945.js";import{I as L}from"./document.1838f8cd.js";import{F as O,f as U}from"./filter-collapse-item.b9744034.js";import{a4 as W,a_ as X,bc as q,a9 as I,aB as N,aC as M,bg as x,a5 as u,a7 as D,a$ as p,b6 as G,a6 as F,aX as _,ad as b,ah as S,aa as $,af as H,ae as J,b0 as T}from"./vendor.d03ee3fb.js";import"./arrow-left.6d3aab38.js";import"./edit.e89450ea.js";import"./delete.b42b11b1.js";import"./release.1fd0f10b.js";import"./config.3c16c364.js";const Q=W({name:"FilterManagerDrawer",components:{IconDocument:L,FilterCollapseItem:O},setup(){const t=X(),c=q(),h=j(),d=K(),r=P(),E=I(!1),i=I(null);N(()=>h.filter.show,e=>{E.value=e}),N(E,e=>{e||(h.filter.show=!1)});const v=M(()=>d.dataFilters),m=M(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(a=>{for(const n in a.apiData)a.apiData[n].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(a.id),e[s.id].names.push(a.alias)):e[s.id]={ids:[a.id],names:[a.alias]}})}),e}),g=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})};return x(U,{usedFilters:m,editFilterName:(e,o)=>{const a=e.trim();a&&o.name!==a&&(o.name=a,o.id>0&&d.updateName(o))},removeFilter:e=>{if(e>0){const o=c.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>G(z),onPositiveClick:async()=>{o.loading=!0;try{await d.delete(e);const a=m.value[e];a&&[...r.coms,...r.subComs].filter(n=>a.ids.includes(n.id)).forEach(n=>{for(const f in n.apiData){const s=f,l=n.apiData[s],w=l.pageFilters.find(C=>C.id===e);l.pageFilters=l.pageFilters.filter(C=>C.id!==e),w&&w.enabled&&A(n.id,s,n.apis[s],l)}})}catch(a){t.error(a.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await d.update(e);const o=m.value[e.id];o&&[...r.coms,...r.subComs].filter(a=>o.ids.includes(a.id)).forEach(a=>{for(const n in a.apiData){const f=n,s=a.apiData[f],l=s.pageFilters.find(w=>w.id===e.id);l&&l.enabled&&A(a.id,f,a.apis[f],s)}})}else await d.create(e),i.value=null}}),{visible:E,dataFilters:v,newDataFilter:i,addFilter:g}}}),R={class:"filter-manager-title"},Y=T(" \u6570\u636E\u8FC7\u6EE4\u5668"),Z=b("span",null,"\u5E2E\u52A9\u6587\u6863",-1),ee={key:1,class:"panel-info"},ae=b("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),te=T(" \u65B0\u5EFA ");function se(t,c,h,d,r,E){const i=u("IconDocument"),v=u("n-icon"),m=u("router-link"),g=u("filter-collapse-item"),k=u("n-button"),y=u("n-drawer-content"),B=u("n-drawer");return F(),D(B,{show:t.visible,"onUpdate:show":c[1]||(c[1]=e=>t.visible=e),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp","show-mask":""},{default:p(()=>[_(y,{closable:""},{header:p(()=>[b("p",R,[Y,b("span",{class:"create-filter",onClick:c[0]||(c[0]=(...e)=>t.addFilter&&t.addFilter(...e))},"\u65B0\u5EFA"),_(m,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[_(v,{size:12},{default:p(()=>[_(i)]),_:1}),Z]),_:1})])]),default:p(()=>[t.newDataFilter?(F(),D(g,{key:0,"data-filter":t.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):S("",!0),(F(!0),$(J,null,H(t.dataFilters,e=>(F(),D(g,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),t.dataFilters.length===0&&!t.newDataFilter?(F(),$("div",ee,[ae,_(k,{focusable:!1,onClick:t.addFilter},{default:p(()=>[te]),_:1},8,["onClick"])])):S("",!0)]),_:1})]),_:1},8,["show"])}var me=V(Q,[["render",se]]);export{me as default};
