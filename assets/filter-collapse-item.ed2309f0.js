import{a as K}from"./App.404b9962.js";import{I as z}from"./arrow-left.14d78497.js";import{I as q}from"./edit.4ec2cf6b.js";import{I as H}from"./delete.d67e866a.js";import{I as U}from"./release.7f243710.js";import{I as W}from"./drag.9793705e.js";import{a6 as s,aa as r,ad as a,a4 as P,bb as G,bm as M,a9 as p,al as O,a5 as l,ae as S,aV as o,b1 as n,ah as y,a7 as m,ag as v,b8 as C,ab as R}from"./vendor.891943b7.js";import{s as J}from"./config.3c16c364.js";const Q={},X={t:"1639131683779",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3989",width:"64",height:"64"},Y=a("path",{d:"M832.990625 494.253125","p-id":"3990"},null,-1),Z=a("path",{d:"M567.659375 510.678125L894.134375 185.6375c15.440625-15.384375 15.525-40.275 0.16875-55.74375-15.384375-15.496875-40.246875-15.525-55.6875-0.16875L512.028125 454.821875 188.309375 129.865625C173.009375 114.48125 148.0625 114.425 132.65 129.78125 117.2375 145.165625 117.209375 170.1125 132.565625 185.553125l323.634375 324.871875L129.865625 835.26875c-15.440625 15.384375-15.525 40.275-0.16875 55.74375 7.678125 7.734375 17.803125 11.615625 27.928125 11.615625 10.040625 0 20.08125-3.825 27.759375-11.475l326.390625-324.928125 326.671875 327.909375C846.153125 901.896875 856.25 905.75 866.346875 905.75c10.06875 0 20.1375-3.853125 27.815625-11.503125 15.384375-15.384375 15.440625-40.275 0.084375-55.715625L567.659375 510.678125 567.659375 510.678125zM567.659375 510.678125","p-id":"3991"},null,-1),x=[Y,Z];function ee(e,i){return s(),r("svg",X,x)}var te=K(Q,[["render",ee]]);const ae=Symbol("filterManagerInjectionKey"),oe=Symbol("filterConfigInjectionKey"),ne=P({name:"FilterCollapseItem",components:{IconArrowLeft:z,IconEdit:q,IconRelease:U,IconDelete:H,IconDrag:W,IconClose:te},props:{dataFilter:{type:Object,required:!0},draggable:{type:Boolean,default:!0},hasFeedback:{type:Boolean,default:!0},removable:Boolean,publish:Boolean,isNew:Boolean,index:Number,showTime:Boolean},setup(e){const i=G(),{usedFilters:j,editFilterName:A,removeFilter:D,saveFilter:L}=M(ae),{enabledFilters:_,onUsedChange:g,updateIndicator:k}=M(oe,{}),{dataStatus:b}=M(J,{}),F=p(null),h=p(e.isNew),d=p(e.isNew),w=p(e.isNew),c=p(e.isNew),E=p(!1),f=p(e.dataFilter.origin),I=O(()=>{if(!e.hasFeedback)return"";const t=b==null?void 0:b.value.filter;return t&&t.includes(`/${e.dataFilter.id}]`)?t:""}),B=O(()=>{var t;return(t=_==null?void 0:_.value[e.dataFilter.id])!=null?t:!1});return{panelRef:F,code:f,loading:E,editing:h,collapse:d,isOpened:w,isEdited:c,isEnabled:B,usedFilters:j,errMsg:I,switchEnabled:t=>{g(e.dataFilter.id,t)},editName:t=>{h.value=!1,A(t,e.dataFilter)},removeFilter:D,changeCode:t=>{t.value!=e.dataFilter.origin&&(c.value=!0)},updateCode:t=>{f.value=t.value},cancelEdit:()=>{e.isNew?D(0):(f.value=e.dataFilter.origin,c.value?c.value=!1:d.value=!1)},saveData:async()=>{if(!c.value){d.value=!1;return}try{E.value=!0,e.dataFilter.origin=f.value,e.dataFilter.code=`
          if (!data) {  return data; }
          return filter(...arguments);
          function filter(data) {
            ${f.value}
            return data;
          }
        `,await L(e.dataFilter),c.value=!1,i.success("\u6570\u636E\u8FC7\u6EE4\u5668\u5DF2\u4FDD\u5B58")}catch(t){i.error(t.message)}finally{E.value=!1}},toggleEditor:()=>{w.value=!0,d.value=!d.value},dragStart:t=>{const V=t.target.parentNode.parentNode.parentNode.parentElement,$=document.querySelector(".filter-dragging-wp");$.innerHTML="",$.appendChild(V.cloneNode(!0)),t.dataTransfer.setDragImage($,30,15)},dragEnd:()=>{const t=document.querySelector(".filter-dragging-wp");t.innerHTML="",k(!1,e.index,F.value)},dragEnter:()=>{k(!0,e.index,F.value)},dragOver:t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"}}}}),se={class:"panel-header"},le={class:"panel-title"},ie={class:"filter-title"},re={class:"filter-name"},de=["title"],ce={class:"action-wp --edit"},ue={class:"filter-count"},ge=a("div",{class:"filter-dot"},null,-1),fe={key:1,class:"filter-dot"},pe={key:2,class:"filter-dot --none"},me={class:"panel-content-wp"},ve={class:"cp-wrap"},he=a("p",{title:"function filter(data) {",class:"fake-code --start"},[a("span",{class:"--keyword"},"function"),C(" filter(data) { ")],-1),_e=a("p",{class:"fake-code --end"},"}",-1),be={class:"filter-actions"},Fe={key:0,class:"unsaved"},we={key:1,class:"saved"};function Ee(e,i,j,A,D,L){const _=l("IconDrag"),g=l("n-icon"),k=l("n-checkbox"),b=l("new-input"),F=l("IconEdit"),h=l("g-tooltip-popover"),d=l("n-tooltip"),w=l("n-config-provider"),c=l("IconRelease"),E=l("IconDelete"),f=l("IconClose"),I=l("IconArrowLeft"),B=l("g-monaco-editor"),N=l("n-button"),T=l("n-collapse-transition");return s(),r("div",{ref:"panelRef",class:R(["collapse-panel-wp filter-item ds-panel-filter",{"--create":e.isNew,"--spread":e.collapse||e.isNew,"--draggable":e.draggable,"--unused":e.hasFeedback&&!e.isEnabled,"--error":!!e.errMsg}]),onDragenter:i[3]||(i[3]=(...u)=>e.dragEnter&&e.dragEnter(...u)),onDragover:i[4]||(i[4]=(...u)=>e.dragOver&&e.dragOver(...u))},[a("div",se,[a("div",le,[a("div",ie,[e.draggable?(s(),r(S,{key:0},[o(g,{draggable:"true",class:"drag-btn",onDragstart:e.dragStart,onDragend:e.dragEnd},{default:n(()=>[o(_)]),_:1},8,["onDragstart","onDragend"]),o(k,{checked:e.isEnabled,class:"enable-checkbox","onUpdate:checked":e.switchEnabled},null,8,["checked","onUpdate:checked"])],64)):y("",!0),a("div",re,[e.editing?(s(),m(b,{key:0,"model-value":e.dataFilter.name,autofocus:!0,class:"filter-name-input",onChange:e.editName},null,8,["model-value","onChange"])):(s(),r("div",{key:1,class:"filter-name-text",title:e.dataFilter.name},v(e.dataFilter.name),9,de))]),a("div",ce,[o(h,{content:"\u91CD\u547D\u540D"},{default:n(()=>[o(g,{class:"edit-btn",onClick:i[0]||(i[0]=u=>e.editing=!0)},{default:n(()=>[o(F)]),_:1})]),_:1})]),a("div",ue,[!e.isNew&&e.usedFilters[e.dataFilter.id]?(s(),m(w,{key:0,"theme-overrides":{Tooltip:{arrowHeight:"8px",borderRadius:"2px",padding:"6px",color:"var(--datav-font-color)",textColor:"#000102"}},abstract:""},{default:n(()=>[o(d,{placement:"top",delay:500,style:{maxWidth:"240px"}},{trigger:n(()=>[a("span",null,v(e.usedFilters[e.dataFilter.id].names.length)+" \u4E2A\u7EC4\u4EF6\u6B63\u5728\u8C03\u7528",1)]),default:n(()=>[C(" "+v(e.usedFilters[e.dataFilter.id].names.join(", ")),1)]),_:1})]),_:1},8,["theme-overrides"])):y("",!0)]),a("div",{class:R(["action-wp",{"--flex":e.publish}])},[e.publish?(s(),m(h,{key:0,content:"\u521B\u5EFA\u4EE3\u7801\u7247\u6BB5"},{default:n(()=>[o(g,{class:"save-btn"},{default:n(()=>[o(c)]),_:1})]),_:1})):y("",!0),o(h,{content:"\u5220\u9664"},{default:n(()=>[o(g,{class:"del-btn",onClick:i[1]||(i[1]=u=>e.removeFilter(e.dataFilter.id))},{default:n(()=>[e.removable?(s(),m(E,{key:0})):(s(),m(f,{key:1}))]),_:1})]),_:1})],2),e.hasFeedback?(s(),r(S,{key:1},[e.errMsg?(s(),m(w,{key:0,"theme-overrides":{Tooltip:{color:"var(--datav-error-color)"}},abstract:""},{default:n(()=>[o(d,{placement:"left",style:{maxWidth:"300px"}},{trigger:n(()=>[ge]),default:n(()=>[C(" "+v(e.errMsg),1)]),_:1})]),_:1},8,["theme-overrides"])):(s(),r("div",fe))],64)):(s(),r("div",pe))])]),a("div",{class:"toggle-btn",onClick:i[2]||(i[2]=(...u)=>e.toggleEditor&&e.toggleEditor(...u))},[o(g,{class:"toggle-icon"},{default:n(()=>[o(I)]),_:1})])]),e.isOpened?(s(),m(T,{key:0,show:e.collapse},{default:n(()=>[a("div",me,[a("div",ve,[he,o(B,{language:"javascript",code:e.code,height:180,"editor-class":"filter-editor",onChange:e.changeCode,onBlur:e.updateCode},null,8,["code","onChange","onBlur"]),_e,a("div",be,[e.isEdited?(s(),r("div",Fe,"\u672A\u4FDD\u5B58")):e.showTime?(s(),r("div",we,"\u4E0A\u6B21\u4FDD\u5B58: "+v(e.dataFilter.updateAt),1)):y("",!0),o(N,{size:"tiny",focusable:!1,class:"bolder-btn",onClick:e.cancelEdit},{default:n(()=>[C(v(e.dataFilter.id===0?"\u53D6\u6D88":e.isEdited?"\u64A4\u9500":"\u53D6\u6D88"),1)]),_:1},8,["onClick"]),o(N,{type:"primary",size:"tiny",loading:e.loading,focusable:!1,class:"bolder-btn",onClick:e.saveData},{default:n(()=>[C(v(e.dataFilter.id===0||e.isEdited?"\u4FDD\u5B58":"\u5B8C\u6210"),1)]),_:1},8,["loading","onClick"])])])])]),_:1},8,["show"])):y("",!0)],34)}var Ke=K(ne,[["render",Ee]]);export{Ke as F,oe as a,ae as f};
