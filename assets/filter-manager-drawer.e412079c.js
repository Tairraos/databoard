import{a as $,C as j,E as K,w as z,a5 as B}from"./AppRoot.e99935fe.js";import{I as P}from"./warning.618daeb9.js";import{I as L}from"./document.59ef4e01.js";import{F as O,f as U}from"./filter-collapse-item.d6212b6c.js";import{a4 as W,aY as Y,ba as Z,a9 as I,az as N,aA as M,be as q,a5 as u,a6 as F,a7 as D,aZ as p,b4 as x,aV as _,ad as h,ah as S,aa as V,af as G,ae as H,a_ as T}from"./vendor.d49f6c0b.js";import"./arrow-left.2b284f25.js";import"./edit.11c88b80.js";import"./delete.72d54e44.js";import"./release.31c8924b.js";import"./config.3c16c364.js";const J=W({name:"FilterManagerDrawer",components:{IconDocument:L,FilterCollapseItem:O},setup(){const t=Y(),c=Z(),b=j(),d=K(),r=z(),E=I(!1),i=I(null);N(()=>b.filter.show,e=>{E.value=e}),N(E,e=>{e||(b.filter.show=!1)});const v=M(()=>d.dataFilters),m=M(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(a=>{for(const n in a.apiData)a.apiData[n].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(a.id),e[s.id].names.push(a.alias)):e[s.id]={ids:[a.id],names:[a.alias]}})}),e}),w=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})};return q(U,{usedFilters:m,editFilterName:(e,o)=>{const a=e.trim();a&&o.name!==a&&(o.name=a,o.id>0&&d.updateName(o))},removeFilter:e=>{if(e>0){const o=c.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>x(P),onPositiveClick:async()=>{o.loading=!0;try{await d.delete(e);const a=m.value[e];a&&[...r.coms,...r.subComs].filter(n=>a.ids.includes(n.id)).forEach(n=>{for(const f in n.apiData){const s=f,l=n.apiData[s],g=l.pageFilters.find(C=>C.id===e);l.pageFilters=l.pageFilters.filter(C=>C.id!==e),g&&g.enabled&&B(n.id,s,n.apis[s],l)}})}catch(a){t.error(a.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await d.update(e);const o=m.value[e.id];o&&[...r.coms,...r.subComs].filter(a=>o.ids.includes(a.id)).forEach(a=>{for(const n in a.apiData){const f=n,s=a.apiData[f],l=s.pageFilters.find(g=>g.id===e.id);l&&l.enabled&&B(a.id,f,a.apis[f],s)}})}else await d.create(e),i.value=null}}),{visible:E,dataFilters:v,newDataFilter:i,addFilter:w}}}),Q={class:"filter-manager-title"},R=T(" \u6570\u636E\u8FC7\u6EE4\u5668"),X=h("span",null,"\u5E2E\u52A9\u6587\u6863",-1),ee={key:1,class:"panel-info"},ae=h("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),te=T(" \u65B0\u5EFA ");function se(t,c,b,d,r,E){const i=u("IconDocument"),v=u("n-icon"),m=u("router-link"),w=u("filter-collapse-item"),k=u("n-button"),y=u("n-drawer-content"),A=u("n-drawer");return F(),D(A,{show:t.visible,"onUpdate:show":c[1]||(c[1]=e=>t.visible=e),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp","show-mask":""},{default:p(()=>[_(y,{closable:""},{header:p(()=>[h("p",Q,[R,h("span",{class:"create-filter",onClick:c[0]||(c[0]=(...e)=>t.addFilter&&t.addFilter(...e))},"\u65B0\u5EFA"),_(m,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[_(v,{size:12},{default:p(()=>[_(i)]),_:1}),X]),_:1})])]),default:p(()=>[t.newDataFilter?(F(),D(w,{key:0,"data-filter":t.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):S("",!0),(F(!0),V(H,null,G(t.dataFilters,e=>(F(),D(w,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),t.dataFilters.length===0&&!t.newDataFilter?(F(),V("div",ee,[ae,_(k,{focusable:!1,onClick:t.addFilter},{default:p(()=>[te]),_:1},8,["onClick"])])):S("",!0)]),_:1})]),_:1},8,["show"])}var me=$(J,[["render",se]]);export{me as default};
