import{a as V,E as z,w as R}from"./AppRoot.2c69a8d3.js";import{I as L}from"./plus.ded0f33a.js";import{F as M,f as O,a as T}from"./filter-collapse-item.b9744034.js";import{b as X,s as q}from"./config.3c16c364.js";import{a4 as G,a9 as m,bd as w,aC as F,bg as y,a5 as v,aa as D,ad as u,ae as H,af as J,a7 as k,ah as Q,aX as _,a$ as P,ac as W,ab as Y,a6 as g}from"./vendor.d03ee3fb.js";import"./arrow-left.6d3aab38.js";import"./edit.e89450ea.js";import"./delete.b42b11b1.js";import"./release.1fd0f10b.js";const Z=G({name:"FilterPanel",components:{IconPlus:L,FilterCollapseItem:M},setup(){const l=m(void 0),n=m(null),b=m(null),o=m({visible:!1,top:"4px",from:0,to:0}),d=z(),C=R(),{apiDataConfig:s}=w(X),{refreshData:i}=w(q),E=F(()=>{const a=s.value.pageFilters.map(e=>e.id);return d.dataFilters.filter(e=>!a.includes(e.id)).map(e=>({value:e.id,label:e.name}))}),c=F(()=>s.value.pageFilters.reduce((a,e)=>{const t=d.dataFilters.find(I=>I.id==e.id);return t&&a.push(t),a},[])),r=F(()=>{const a=[...C.coms,...C.subComs],e=Object.create(null);return a.forEach(t=>{for(const I in t.apiData)t.apiData[I].pageFilters.forEach(f=>{e[f.id]?(e[f.id].ids.push(t.id),e[f.id].names.push(t.alias)):e[f.id]={ids:[t.id],names:[t.alias]}})}),e}),p=F(()=>s.value.pageFilters.reduce((a,e)=>(a[e.id]=e.enabled,a),{})),A=a=>{s.value.pageFilters.push({id:a,enabled:!0}),i()},B=(a,e)=>{s.value.pageFilters.find(t=>t.id===a).enabled=e,i()},j=(a,e)=>{const t=a.trim();t&&e.name!==t&&(e.name=t,e.id>0&&d.updateName(e))},N=()=>{n.value||(n.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},$=a=>{a>0?(s.value.pageFilters=s.value.pageFilters.filter(e=>e.id!==a),i()):n.value=null},S=async a=>{if(a.id>0)await d.update(a),p.value[a.id]&&i();else{const e=await d.create(a);s.value.pageFilters.push({id:e,enabled:!0}),n.value=null,i()}},K=()=>{const{from:a,to:e}=o.value;if(a!==e){const t=s.value.pageFilters;t.splice(e,0,...t.splice(a,1)),i()}},h=(a,e,t)=>{o.value.visible=a,o.value.top=`${t.offsetTop-6}px`,a?o.value.to=e:(o.value.from=e,K())},U=()=>{h(!0,c.value.length,b.value)};return y(O,{usedFilters:r,editFilterName:j,removeFilter:$,saveFilter:S}),y(T,{enabledFilters:p,onUsedChange:B,updateIndicator:h}),{filterId:l,apiDataConfig:s,dataFilters:E,selectedFilters:c,newDataFilter:n,addPanelRef:b,dragInfo:o,selectFilter:A,addFilter:N,dragEnter:U}}}),x={class:"filter-list"},ee=u("span",{class:"datav-empty"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),ae=u("div",{class:"filter-dragging-wp"},null,-1);function te(l,n,b,o,d,C){const s=v("filter-collapse-item"),i=v("n-select"),E=v("IconPlus"),c=v("n-icon");return g(),D("div",{class:Y(["filter-wp",{"--disabled":!l.apiDataConfig.config.useFilter}])},[u("div",x,[(g(!0),D(H,null,J(l.selectedFilters,(r,p)=>(g(),k(s,{key:r.id,index:p,"data-filter":r},null,8,["index","data-filter"]))),128)),l.newDataFilter?(g(),k(s,{key:0,"data-filter":l.newDataFilter,index:l.selectedFilters.length,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter","index"])):Q("",!0),u("div",{ref:"addPanelRef",class:"add-filter",onDragenter:n[1]||(n[1]=(...r)=>l.dragEnter&&l.dragEnter(...r))},[_(i,{value:l.filterId,options:l.dataFilters,filterable:"","fallback-option":!1,placeholder:"\u6DFB\u52A0\u8FC7\u6EE4\u5668",class:"datav-new-select filter-select","onUpdate:value":l.selectFilter},{empty:P(()=>[ee]),_:1},8,["value","options","onUpdate:value"]),u("div",{class:"new-filter-btn",onClick:n[0]||(n[0]=(...r)=>l.addFilter&&l.addFilter(...r))},[_(c,{class:"icon-add"},{default:P(()=>[_(E)]),_:1})])],544)]),ae,u("div",{class:"drag-indicator",style:W({display:l.dragInfo.visible?"block":"none",top:l.dragInfo.top})},null,4)],2)}var fe=V(Z,[["render",te]]);export{fe as default};
