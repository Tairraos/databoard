import{e as P,aE as D,I,r as K,aq as d,o as m,f as _,h as o,j as a,w as b,q as R,t as w,K as A,z as q,L as B,O as z,p as T,bg as U,x as J,aI as Z,J as G,aj as H,c3 as O,aF as Q,bZ as W,s as V}from"./App.93664d39.js";import{I as L}from"./arrow-right.f7741cc8.js";import{i as M,c as X}from"./config.3c16c364.js";import{C as Y,a as N}from"./children-manager.12f34576.js";import{E as x}from"./empty-panel.ebfa7eff.js";import{I as ee}from"./plus.7435b342.js";import{I as te}from"./delete.f2c34d22.js";import"./document.97772ac7.js";import"./back.d163cde1.js";import"./warning.e27f11ec.js";import"./edit.27fd812e.js";import"./copy.c9deedb9.js";import"./show.083f77d8.js";import"./hide.354d2acb.js";import"./drag.bb2d70d2.js";import"./index.e5956367.js";import"./templates.1175c3bd.js";const ne=P({name:"EventItem",components:{IconArrowRight:L,IconDelete:te,IconPlus:ee},props:{item:{type:Object,required:!0}},setup(t){const s=D(M),y=I(!0),C=I(t.item.enable);return{visible:y,isEnabled:C,addField:()=>{s.addField(t.item.name)},deleteField:u=>{s.deleteField(t.item.name,u)},updateField:(u,h,F)=>{u[h]=F;const k=t.item.fields.filter(v=>v.name).map(v=>({name:v.name,map:v.map}));s.updateField(t.item.name,k)},onEnableChange:u=>{t.item.enable=u,s.toggleEnable(t.item.name,u)}}}}),se={class:"event"},oe={class:"event-text"},ie={key:0,class:"variables"},le={class:"variables-table"},ae=o("thead",null,[o("tr",null,[o("th",{width:"80"},[o("span",null,"\u5B57\u6BB5")]),o("th",{width:"110",style:{position:"relative"}},[o("span",null,"\u7ED1\u5B9A\u5230\u53D8\u91CF")]),o("th",{width:"110"},[o("span",null,"\u5B57\u6BB5\u8BF4\u660E")])])],-1),ce={class:"variables-tbody"},de={class:"variable-input"},ue={class:"variable-input"},re={class:"variable-btn"},me={class:"variable-input"},pe={class:"desc"},ve={class:"add-variable"};function _e(t,s,y,C,E,l){const f=d("IconArrowRight"),p=d("n-icon"),u=d("n-checkbox"),h=d("new-input"),F=d("IconDelete"),k=d("IconPlus"),v=d("n-button");return m(),_("div",se,[o("div",{class:"events-title",onClick:s[2]||(s[2]=e=>t.visible=!t.visible)},[a(p,{class:R(t.visible?"events-down":"events-up")},{default:b(()=>[a(f)]),_:1},8,["class"]),o("div",oe,w(t.item.description),1),a(u,{checked:t.isEnabled,"onUpdate:checked":[s[0]||(s[0]=e=>t.isEnabled=e),t.onEnableChange],class:"enable-checkbox",onClick:s[1]||(s[1]=q(()=>{},["stop"]))},{default:b(()=>[A(" \u542F\u7528 ")]),_:1},8,["checked","onUpdate:checked"])]),t.visible?(m(),_("div",ie,[o("table",le,[ae,o("tbody",ce,[(m(!0),_(B,null,z(t.item.fields,(e,i)=>(m(),_("tr",{key:i},[e.custom?(m(),_(B,{key:0},[o("td",de,[a(h,{"model-value":e.name,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:n=>t.updateField(e,"name",n)},null,8,["model-value","onChange"])]),o("td",ue,[a(h,{"model-value":e.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:n=>t.updateField(e,"map",n)},null,8,["model-value","onChange"])]),o("td",re,[a(p,{class:"delete-btn",onClick:n=>t.deleteField(i)},{default:b(()=>[a(F)]),_:2},1032,["onClick"])])],64)):(m(),_(B,{key:1},[o("td",null,w(e.name),1),o("td",me,[a(h,{"model-value":e.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:n=>t.updateField(e,"map",n)},null,8,["model-value","onChange"])]),o("td",pe,w(e.description),1)],64))]))),128))])]),o("div",ve,[a(v,{focusable:!1,size:"tiny",onClick:t.addField},{icon:b(()=>[a(p,{size:12},{default:b(()=>[a(k)]),_:1})]),default:b(()=>[A(" \u65B0\u5EFA\u4E00\u4E2A\u5B57\u6BB5 ")]),_:1},8,["onClick"])])])):T("",!0)])}const fe=K(ne,[["render",_e]]),he=P({name:"InteractionPanel",components:{IconArrowRight:L,ConfigTitle:Y,EmptyPanel:x,EventItem:fe,ChildrenManager:N},setup(){const t=U(),s=D(X),y=I(!0),C=J(()=>Object.keys(s.value.events)),E=I([]);let l=I(t.componentsView[s.value.id]);const f=(e,i,n,r=!1)=>({name:e,map:i||e,description:n,custom:r}),p=e=>{if(l.value||(l.value={}),!l.value[e]){const i=Object.keys(s.value.events[e].fields);l.value[e]={enable:!1,fields:O(i)}}},u=()=>{const e=[];for(const[i,n]of Object.entries(s.value.events)){const r={name:i,description:n.description,enable:!1,fields:Object.entries(n.fields).map(([c,g])=>f(c,"",g.description))};if(l.value){const c=l.value[i];if(c){r.enable=c.enable;for(const[g,$]of Object.entries(c.fields)){const j=r.fields.find(S=>S.name===g);j?j.map=$:r.fields.push(f(g,$,"",!0))}}}e.push(r)}E.value.push(...e)};return Z(M,{addField:e=>{const i=E.value.find(n=>n.name===e);i.fields.some(n=>n.name==="")||i.fields.push(f("","","",!0))},deleteField:(e,i)=>{const r=E.value.find(c=>c.name===e).fields.splice(i,1)[0].name;if(r){delete l.value[e].fields[r];const c=l.value[e];c.enable&&t.setPublishersView(s.value.id,Object.entries(c.fields).map(g=>g[1]||g[0]),!0)}},updateField:(e,i)=>{p(e),l.value[e].fields=O(i,"name","map"),l.value[e].enable&&t.setPublishersView(s.value.id,i.map(n=>n.map||n.name),!0)},toggleEnable:(e,i)=>{p(e);const n=l.value[e];n.enable=i;const r=[];for(const c in n.fields)i&&!n.fields[c]&&(n.fields[c]=c),r.push(n.fields[c]);t.setPublishersView(s.value.id,r,i)}}),G(l,()=>{t.componentsView[s.value.id]=l.value}),H(()=>{u()}),{com:s,eventKeys:C,visible:y,eventList:E}}});const be={class:"interaction-panle"},Ee={key:0},ge={class:"com-events"},Fe=o("span",null,w("\u4EA4\u4E92\u4E8B\u4EF6"),-1),ke={class:"extra"},ye={class:"event-list"};function Ce(t,s,y,C,E,l){const f=d("config-title"),p=d("children-manager"),u=d("IconArrowRight"),h=d("n-icon"),F=d("router-link"),k=d("event-item"),v=d("empty-panel");return m(),_("div",be,[a(f),a(p),t.eventKeys.length>0?(m(),_("div",Ee,[o("div",ge,[o("div",{class:"events-title",onClick:s[0]||(s[0]=e=>t.visible=!t.visible)},[a(h,{class:R(t.visible?"events-down":"events-up")},{default:b(()=>[a(u)]),_:1},8,["class"]),Fe,o("span",ke,[a(F,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"tutorial-link"},{default:b(()=>[A("\u6559\u7A0B")]),_:1})])]),Q(o("div",ye,[(m(!0),_(B,null,z(t.eventList,e=>(m(),V(k,{key:e.name,item:e},null,8,["item"]))),128))],512),[[W,t.visible]])])])):(m(),V(v,{key:1,content:"\u8BE5\u7EC4\u4EF6\u6CA1\u6709\u4EA4\u4E92\u4E8B\u4EF6"}))])}const Te=K(he,[["render",Ce]]);export{Te as default};
