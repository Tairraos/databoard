var Ee=Object.defineProperty;var xe=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var ye=(e,t,n)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,oe=(e,t)=>{for(var n in t||(t={}))Xe.call(t,n)&&ye(e,n,t[n]);if(xe)for(var n of xe(t))Ye.call(t,n)&&ye(e,n,t[n]);return e};var X=(e,t,n)=>(ye(e,typeof t!="symbol"?t+"":t,n),n);import{a6 as Y,aa as q,ad as $,a4 as J,aA as w,ac as R,ah as Se,a9 as z,aD as Be,aj as De,aw as Fe,a5 as j,a7 as ae,aZ as we,aV as ie,ag as $e,b4 as M,aL as N,bn as We,bi as be,az as He,ae as Ae,af as Oe,n as Ge,b8 as Ve,b9 as Ne}from"./vendor.d49f6c0b.js";import{a as Z,x as le,J as P,a0 as je,a1 as qe,w as ze,a2 as Ze,Y as Je,C as Ue,y as Ke,I as Qe,a3 as Pe}from"./AppRoot.e99935fe.js";import{c as et}from"./index.bc30072f.js";import{a as U,o as L,b as _,c as tt}from"./dom.022ad87e.js";import{u as ke}from"./index.9cf894d9.js";import"./templates.a29625ea.js";import"./warning.618daeb9.js";const nt={},st={t:"1639130833808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},ot=$("path",{d:"M341.33333333 579.33333333C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c85.336 0 170.664 58 256 174C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-85.336 0-170.664-48.664-256-146z m96-5.6C490.66933333 632.13333333 543.99733333 661.33333333 597.33333333 661.33333333s106.664-29.2 160-87.6C703.99733333 504.13333333 650.66933333 469.33333333 597.33333333 469.33333333s-106.664 34.8-160 104.4zM597.33333333 629.33333333a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"3986"},null,-1),at=[ot];function it(e,t){return Y(),q("svg",st,at)}var rt=Z(nt,[["render",it]]);const lt={},ct={t:"1639130872871",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4135",width:"64",height:"64"},dt=$("path",{d:"M651.14133333 413.01333333l-56.344 56.344C542.30933333 470.45333333 489.82133333 505.23733333 437.33333333 573.73333333a416 416 0 0 0 26.48 26.6l-49.976 49.984c-24.168-19.76-48.336-43.416-72.504-70.984C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c17.936 0 35.872 2.56 53.808 7.68z m113.968 67.056c29.408 26.2 58.816 59.28 88.224 99.264C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-22.456 0-44.92-3.368-67.376-10.112l54.456-54.456c4.304 0.376 8.616 0.568 12.92 0.568 53.336 0 106.664-29.2 160-87.6-13.368-17.44-26.736-32.704-40.112-45.784l47.888-47.88zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"4136"},null,-1),ut=$("path",{d:"M770.34933333 339.06133333l45.256 45.256-407.288 407.288-45.256-45.256z","p-id":"4137"},null,-1),ht=[dt,ut];function ft(e,t){return Y(),q("svg",ct,ht)}var vt=Z(lt,[["render",ft]]);const mt=J({name:"AlignLine",setup(){const e=le();return{alignLine:w(()=>e.alignLine),canvas:w(()=>e.canvas)}}}),gt={key:0,class:"ident-line-wp"};function yt(e,t,n,o,s,a){return e.alignLine.enable&&e.alignLine.show?(Y(),q("div",gt,[$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.top}px`})},null,4),$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.horizontal}px`})},null,4),$("div",{class:"ident-line x-line",style:R({width:`${e.canvas.width}px`,top:`${e.alignLine.bottom}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.left}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.vertical}px`})},null,4),$("div",{class:"ident-line y-line",style:R({height:`${e.canvas.height}px`,left:`${e.alignLine.right}px`})},null,4)])):Se("",!0)}var pt=Z(mt,[["render",yt],["__scopeId","data-v-0f9e3b7f"]]);const ee=e=>`${e}px`,Ce=(e,t,n,o)=>{const s=e!=null?e:document.createElement("canvas");s.width=t*o,s.height=n*o,s.style.width=ee(t),s.style.height=ee(n);const a=s.getContext("2d");return a&&a.setTransform(o,0,0,o,0,0),s},Ie=(e,t,n,o)=>{var v,m;const s=parseFloat(e.style.transform.match(/(?<=X\()(.+)/ig)[0]),{height:a,scale:r,offset:u}=t;let i=0;return t.direction=="TB"?i=n-(((v=e.parentElement)==null?void 0:v.offsetLeft)||0)-s:i=o-(((m=e.parentElement)==null?void 0:m.offsetTop)||0)-s,i=i-a+t.indicatorLineWidth,{coor:Math.floor((i-u)/r),dist:i}},xt=(e,t)=>{const{scale:n,offset:o}=t;return{coor:e,dist:parseFloat((e*n+o).toFixed(3))}},re=class{constructor(t,n,o,s=0){X(this,"guideLine");X(this,"coor",-1);this.el=t,this.options=n,this.constructGuide(o,s)}constructGuide(t,n){const{el:o}=this,s=document.createElement("div");s.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",U(s,"ruler-line"),this.guideLine=s;const{coor:a}=this;this.setLine(t,n),t&&this.coorChange("add",this.coor,a);let r=o.querySelector(".lines-wrapper");r||(r=document.createElement("div"),U(r,"lines-wrapper"),o.appendChild(r)),r.appendChild(s),L(s,"mousedown",this.moving.bind(this)),L(s,"dblclick",this.dblclick.bind(this))}moving(t){re.isMoveing=!0;const{options:n}=this;t.preventDefault(),t.stopPropagation();const{coor:o}=this,s=r=>{n.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(r)},a=()=>{re.isMoveing=!1,document.body.style.cursor="",_(document,"mousemove",s),_(document,"mouseup",a);const{coor:r}=this;r<0?this.coorChange("delete",o,o):this.coorChange("update",r,o)};L(document,"mousemove",s),L(document,"mouseup",a)}setLine(t,n=0){const{el:o,options:s,guideLine:a}=this,r=t?Ie(o,s,t.clientX,t.clientY):xt(n,s);s.direction==="TB"?a.style.left=ee(r.dist):a.style.top=ee(r.dist),a.innerHTML=`
      <div class="line-action">
        <span class="line-value">${r.coor}</span>
      </div>`,this.coor=r.coor}dblclick(t){t.preventDefault(),t.stopPropagation(),this.destroy()}coorChange(t,n,o){const{options:s}=this;s.coorChange&&s.coorChange(t,n,o)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:t,coor:n}=this;this.coorChange("delete",n,n),_(t,"mousedown",this.moving.bind(this)),_(t,"dblclick",this.dblclick.bind(this)),t.remove()}};let K=re;X(K,"isMoveing",!1);class Me{constructor(t,n){X(this,"el");X(this,"canvas");X(this,"ctx");X(this,"ruler",{width:0,height:0});X(this,"indicator");X(this,"indicatorValue");X(this,"guideLines",[]);X(this,"options",{direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2});this.el=t,this.options=oe(oe({},this.options),n),this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:o,width:s,height:a,ratio:r}=n,u=Math.max(o==="TB"?t.offsetWidth:t.offsetHeight,s),i=a;this.ruler.width=u,this.ruler.height=i;const h=Ce(null,u,i,r);U(h,"canvas-ruler"),t.appendChild(h),this.canvas=h,this.ctx=h.getContext("2d"),this.drawRuler(),L(h,"mouseenter",this.constructIndicator.bind(this)),L(h,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,s,a),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:o}=this,{width:s,height:a}=o,{offset:r,scale:u}=n,i=0,h=a/1.5,v=a/1.2;for(let m=0;m<=s;m+=1){const g=m-r;if(g<0)continue;let C=-1,p=-1;g%50===0?(C=Math.floor(g/u),p=i):g%25===0?p=h:g%5===0&&(p=v),p>=0&&(t.moveTo(m+.5,a+.5),t.lineTo(m+.5,p),C>-1&&t.fillText(`${C}`,m+2.5,a/1.5))}}constructIndicator(t){if(K.isMoveing)return;const{el:n,options:o,canvas:s}=this,a=document.createElement("div"),r=document.createElement("span");U(a,"ruler-indicator"),U(r,"indicator-value"),a.appendChild(r),this.indicator=a,this.indicatorValue=r,n.appendChild(a);const u=v=>{const m=Ie(n,o,v.clientX,v.clientY);a.style.left=ee(m.dist),r.textContent=`${m.coor}`};u(t);const i=v=>{u(v)},h=()=>{_(s,"mousemove",i),_(s,"mouseout",h),a.remove()};L(s,"mousemove",i),L(s,"mouseout",h)}createGuideLine(t){t.preventDefault(),t.stopPropagation();const{el:n,options:o}=this;this.guideLines.push(new K(n,o,t))}setGuideLines(t){const{el:n,options:o}=this;t.forEach(s=>{this.guideLines.push(new K(n,o,null,s))})}setSize(t,n,o){const{el:s,options:a}=this;a.width=t,a.height=n,a.scale=o;const{direction:r,width:u,height:i,ratio:h}=a,v=Math.max(r==="TB"?s.offsetWidth:s.offsetHeight,u),m=i;this.ruler.width=v,this.ruler.height=m,Ce(this.canvas,v,m,h),this.drawRuler(),this.guideLines.forEach(g=>g.setLine(null,g.coor))}setScale(t){this.options.scale=t,this.drawRuler(),this.guideLines.forEach(n=>n.setLine(null,n.coor))}toggleGuide(t){const n=t?"show":"hide";this.guideLines.forEach(o=>o[n]())}clearGuides(){this.guideLines.forEach(t=>t.destroy()),this.guideLines=[]}destroy(){const{el:t,canvas:n}=this;this.clearGuides(),_(n,"mouseenter",this.constructIndicator.bind(this)),_(n,"mousedown",this.createGuideLine.bind(this)),t.remove()}}const wt=J({name:"Ruler",components:{IconLineShow:rt,IconLineHide:vt},setup(){const e=le(),t=z(null),n=z(null),o=z(null),s=z(null),a=z(!0),r=z(0),u=z(0),i=document.documentElement.clientWidth;Be(()=>{if(t.value&&n.value){const{canvas:m,guideLine:g}=e,C=Math.max(m.width,i);o.value?o.value.setSize(C,20,m.scale):(o.value=new Me(t.value,{direction:"TB",width:C,scale:m.scale,coorChange:(p,x,H)=>{p==="add"?g.h.push(x):p==="update"&&x!==H?(g.h=g.h.filter(B=>B!==H),g.h.push(x)):p==="delete"&&(g.h=g.h.filter(B=>B!==x))}}),o.value.setGuideLines(g.h)),s.value?s.value.setSize(m.height,20,m.scale):(s.value=new Me(n.value,{direction:"LR",width:m.height,scale:m.scale,coorChange:(p,x,H)=>{p==="add"?g.v.push(x):p==="update"&&x!==H?(g.v=g.v.filter(B=>B!==H),g.v.push(x)):p==="delete"&&(g.v=g.v.filter(B=>B!==x))}}),s.value.setGuideLines(g.v))}});const h=()=>{o.value&&s.value&&(a.value=!a.value,o.value.toggleGuide(a.value),s.value.toggleGuide(a.value))},v=m=>{const g=m.target;r.value=g.scrollLeft,u.value=g.scrollTop};return De(()=>{const m=document.getElementById("canvas-wp");m==null||m.addEventListener("scroll",v)}),Fe(()=>{const m=document.getElementById("canvas-wp");m==null||m.removeEventListener("scroll",v)}),{visible:a,hRulerWpRef:t,vRulerWpRef:n,toggleGuides:h,vScroll:u,hScroll:r}}}),$t={class:"canvas-ruler-wp"};function bt(e,t,n,o,s,a){const r=j("IconLineShow"),u=j("n-icon"),i=j("IconLineHide");return Y(),q("div",$t,[$("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:R(`transform: translateX(-${e.hScroll}px);`)},null,4),$("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:R(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),$("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:t[0]||(t[0]=(...h)=>e.toggleGuides&&e.toggleGuides(...h))},[e.visible?(Y(),ae(u,{key:0},{default:we(()=>[ie(r)]),_:1})):(Y(),ae(u,{key:1},{default:we(()=>[ie(i)]),_:1}))])])}var Ct=Z(wt,[["render",bt]]);const Mt={class:"canvas-selection"},Lt=["d"],_t=J({__name:"canvas-area",props:{startX:{type:Number,default:0},startY:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0}},setup(e){return(t,n)=>(Y(),q("svg",Mt,[$("path",{fill:"none",stroke:"rgba(255,255,255,0.5)",d:`M ${e.startX},${e.startY} L ${e.startX},${e.startY+e.height} L ${e.startX+e.width},${e.startY+e.height} L ${e.startX+e.width},${e.startY} Z`,style:{"stroke-width":"1","stroke-dasharray":"3, 3"}},null,8,Lt)]))}});var St=Z(_t,[["__scopeId","data-v-3f06663a"]]);const zt=[{direction:"lt",angle:0,cursor:"nwse-resize",singleCursor:"nw-resize"},{direction:"t",angle:45,cursor:"ns-resize",singleCursor:"n-resize"},{direction:"rt",angle:90,cursor:"nesw-resize",singleCursor:"ne-resize"},{direction:"r",angle:135,cursor:"ew-resize",singleCursor:"e-resize"},{direction:"rb",angle:180,cursor:"nwse-resize",singleCursor:"se-resize"},{direction:"b",angle:225,cursor:"ns-resize",singleCursor:"s-resize"},{direction:"lb",angle:270,cursor:"nesw-resize",singleCursor:"sw-resize"},{direction:"l",angle:315,cursor:"ew-resize",singleCursor:"w-resize"}],Le=[{start:338,end:23,cursor:"nwse-resize",singleCursor:"nw-resize"},{start:23,end:68,cursor:"ns-resize",singleCursor:"n-resize"},{start:68,end:113,cursor:"nesw-resize",singleCursor:"ne-resize"},{start:113,end:158,cursor:"ew-resize",singleCursor:"e-resize"},{start:158,end:203,cursor:"nwse-resize",singleCursor:"se-resize"},{start:203,end:248,cursor:"ns-resize",singleCursor:"s-resize"},{start:248,end:293,cursor:"nesw-resize",singleCursor:"sw-resize"},{start:293,end:338,cursor:"ew-resize",singleCursor:"w-resize"}],kt=e=>{const t=(e+360)%360,n={};let o=-1;return zt.forEach(s=>{const a=(s.angle+t)%360,r=Le.length,u=0;for(;u<r;){o=(o+1)%r;const i=Le[o];if(a<23||a>=338){n[s.direction]="nwse-resize";break}if(i.start<=a&&a<i.end){n[s.direction]=i.cursor;break}}}),n};function It(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}function Q(e,t,n){const o=je(n);return{x:(e.x-t.x)*Math.cos(o)-(e.y-t.y)*Math.sin(o)+t.x,y:(e.x-t.x)*Math.sin(o)+(e.y-t.y)*Math.cos(o)+t.y}}function Rt(e,t,n,o,s,a){const r=It(n,o),u=Q(o,r,-t.deg),i=Q(n,r,-t.deg);e[0]==="l"?(a.x=Math.round(i.x/s),a.w=Math.round((u.x-i.x)/s)):e[0]==="r"&&(a.x=Math.round(u.x/s),a.w=Math.round((i.x-u.x)/s)),e[1]==="t"?(a.y=Math.round(i.y/s),a.h=Math.round((u.y-i.y)/s)):e[1]==="b"&&(a.y=Math.round(u.y/s),a.h=Math.round((i.y-u.y)/s))}function Tt(e,t,n,o,s,a,r){const u=Q(o,n,-t.deg);if(e==="t"||e==="b"){const i=Q({x:n.x,y:u.y},n,t.deg),h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(h>0){const v={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};r.h=Math.round(h/a),r.x=Math.round(v.x/a-t.w/2),r.y=Math.round((v.y-h/2)/a)}}if(e==="l"||e==="r"){const i=Q({x:u.x,y:n.y},n,t.deg),h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2);if(h>0){const v={x:i.x-(i.x-s.x)/2,y:i.y+(s.y-i.y)/2};r.w=Math.round(h/a),r.x=Math.round((v.x-h/2)/a),r.y=Math.round(v.y/a-t.h/2)}}}function Et(e,t,n,o,s,a){e==="t"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="rt"?(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s)):e==="r"?a.w=Math.round(t.w+(o.x-n.x)/s):e==="rb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(o.x-n.x)/s)):e==="b"?a.h=Math.round(t.h+(o.y-n.y)/s):e==="lb"?(a.h=Math.round(t.h+(o.y-n.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="l"?(a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s)):e==="lt"&&(a.h=Math.round(t.h+(n.y-o.y)/s),a.w=Math.round(t.w+(n.x-o.x)/s),a.x=Math.round(t.x+(o.x-n.x)/s),a.y=Math.round(t.y+(o.y-n.y)/s))}const Xt=(e,t,n,o,s,a,r)=>{const u=oe({},n.attr),i=Object.create(null);let h,v,m;const g={x:0,y:0};if(s)v={x:e.clientX,y:e.clientY};else{const x={x:(u.x+u.w/2)*o,y:(u.y+u.h/2)*o};h=document.getElementById("canvas-coms").getBoundingClientRect(),v={x:e.clientX-h.left,y:e.clientY-h.top},m={x:x.x-(v.x-x.x),y:x.y-(v.y-x.y)}}const C=x=>{s?(g.x=x.clientX,g.y=x.clientY,Et(t,u,v,g,o,i)):(g.x=x.clientX-h.left,g.y=x.clientY-h.top,t.length===1?Tt(t,u,v,g,m,o,i):Rt(t,u,g,m,o,i)),i.x!=null&&(n.attr.x=i.x),i.y!=null&&(n.attr.y=i.y),i.w!=null&&(n.scaling.w=Math.max(10,i.w)),i.h!=null&&(n.scaling.h=Math.max(10,i.h)),a()},p=()=>{_(document,"mousemove",C),_(document,"mouseup",p),r()};L(document,"mousemove",C),L(document,"mouseup",p)},Yt=(e,t,n,o,s,a)=>{const{x:r,y:u}=t.attr,i=v=>{t.attr.x=r+Math.round((v.clientX-e.clientX)/n/o)*o,t.attr.y=u+Math.round((v.clientY-e.clientY)/n/o)*o,s()},h=()=>{_(document,"mousemove",i),_(document,"mouseup",h),a()};L(document,"mousemove",i),L(document,"mouseup",h)},Bt=(e,t,n,o)=>{const s=t.getBoundingClientRect(),a=s.left+s.width/2,r=s.top+s.height/2;let u=0;const i=Math.atan2(r-e.clientY,a-e.clientX)*180/Math.PI-n.attr.deg,h=m=>{const g=Math.atan2(r-m.clientY,a-m.clientX)*180/Math.PI-i;u=Math.round(g%360),n.attr.deg=u<0?u+360:u},v=()=>{_(document,"mousemove",h),_(document,"mouseup",v),o(u)};L(document,"mousemove",h),L(document,"mouseup",v)},Re=(e,t)=>{e.attr.deg=0,e.children.forEach(n=>{if(n.type===P.layer)Re(n,t);else{const o=Math.round((n.attr.deg+t)%360);n.attr.deg=o<0?o+360:o}})};const Dt=J({name:"ReferLine",props:{pos:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(e){const o=w(()=>({height:`${e.pos.y+60/e.scale}px`,borderLeftWidth:`${.9/e.scale}px`})),s=w(()=>({width:`${e.pos.x+60/e.scale}px`,borderTopWidth:`${.9/e.scale}px`})),a=w(()=>({fontSize:`${12/e.scale}px`,top:`-${6/e.scale}px`,left:`-${6/e.scale}px`}));return{topLineStyle:o,leftLineStyle:s,accountStyle:a}}}),Ft={class:"nav-line"};function Wt(e,t,n,o,s,a){return Y(),q("div",Ft,[$("div",{class:"nav-line-top",style:R(e.topLineStyle)},null,4),$("div",{class:"nav-line-left",style:R(e.leftLineStyle)},null,4),$("div",{class:"nav-line-account",style:R(e.accountStyle)},$e(e.pos.x)+", "+$e(e.pos.y),5)])}var Ht=Z(Dt,[["render",Wt],["__scopeId","data-v-ef0c624a"]]);const At=J({name:"TransformLayer",props:{com:{type:Object,required:!0},parentCom:{type:Object},editable:Boolean},setup(e,t){qe(e.com);const n=We(),o=le(),s=ze(),{showMenu:a,hideMenu:r}=ke(),u=z(!1),i=w(()=>e.com.type===P.layer),h=w(()=>o.canvas.scale),v=w(()=>o.referLine),m=w(()=>{let{x:d,y:c}=e.com.attr;return I().coms.forEach(l=>{d+=l.attr.x,c+=l.attr.y}),{x:d,y:c}}),g=w(()=>({"datav-transform":!0,selected:e.com.selected,hided:e.com.hided,locked:e.com.locked})),C=w(()=>{const{x:d,y:c,w:f,h:l}=e.com.attr;return{top:0,left:0,width:`${f}px`,height:`${l}px`,transform:`translate(${d}px, ${c}px)`}}),p=w(()=>({"datav-scale":!0,hovered:e.com.hovered,"--relative-hovered":te.value.hovered})),x=w(()=>{const{zoom:d,sx:c,sy:f}=e.com.scaling,l=d?`scale(${c.toFixed(6)}, ${f.toFixed(6)})`:void 0;return i.value?{transform:l||"none"}:{display:e.com.hided?"none":"block",transform:l}}),H=w(()=>{const{hided:d,attr:c,scaling:f}=e.com,l={overflow:"visible",display:d?"none":"block",transform:`rotate(${c.deg}deg)`,opacity:c.opacity},{zoom:S,sx:T,sy:V}=f;return S&&(l.transform=`scale(${(1/T).toFixed(6)}, ${(1/V).toFixed(6)}) ${l.transform} scale(${T.toFixed(6)}, ${V.toFixed(6)})`),l}),B=w(()=>{const{selected:d,attr:c}=e.com,f={cursor:d?"move":"inherit"};if(i.value)c.apply3d&&(f.perspective=`${c.perspective}px`,f.perspectiveOrigin=`${c.perspectiveOrigin.x}% ${c.perspectiveOrigin.y}%`);else{const{zoom:l,sx:S,sy:T}=e.com.scaling;f.transform=l?`scale(${(1/S).toFixed(6)}, ${(1/T).toFixed(6)}) ${f.transform} scale(${S.toFixed(6)}, ${T.toFixed(6)})`:`rotate(${e.com.attr.deg}deg)`}return f}),ce=w(()=>{const{hided:d,attr:c}=e.com,f=o.pageConfig.styleFilterParams;let l="";return f.enable&&(l=`hue-rotate(${f.hue}deg) contrast(${f.contrast}%) opacity(${f.opacity}%) saturate(${f.saturate}%) brightness(${f.brightness}%)`),{display:d?"none":"block",transform:`scaleX(${c.filpH?-1:1}) scaleY(${c.filpV?-1:1}) rotateZ(360deg)`,filter:l}}),de=w(()=>({width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`})),D=w(()=>kt(e.com.attr.deg)),ue=w(()=>{const{zoom:d,sx:c,sy:f}=e.com.scaling,l=d?`scale(${1/c/h.value}, ${1/f/h.value})`:`scale(${1/h.value}, ${1/h.value})`;return{t:{name:"top",style:{cursor:D.value.t,transform:l}},rt:{name:"top-right",style:{cursor:D.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:l}},r:{name:"right",style:{cursor:D.value.r,transform:l}},rb:{name:"bottom-right",style:{cursor:D.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:l}},b:{name:"bottom",style:{cursor:D.value.b,transform:l}},lb:{name:"bottom-left",style:{cursor:D.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:l}},l:{name:"left",style:{cursor:D.value.l,transform:l}},lt:{name:"top-left",style:{cursor:D.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:l}}}}),te=w(()=>{var f;let d=(f=e.parentCom)==null?void 0:f.selected,c=!1;if(i.value&&!d){const l=Ze(e.com);d=l.hovered||l.selected,c=l.selected}return{hovered:d,selected:c}}),ne=(d,c)=>{const f=(l,S)=>l===S?1:0;return`rotate3d(${f(d,"x")}, ${f(d,"y")}, ${f(d,"z")}, ${c}deg)`},he=d=>{const{attr:c}=d,f={justifyContent:"center",alignItems:"center",display:"block",opacity:1,transform:"translate3d(0, 0, 0)",width:"auto",height:"auto",position:"absolute",transformOrigin:`${c.w/2+c.x}px ${c.h/2+c.y}`},{attr:l,config:S}=e.com;if(l.apply3d){const T=S.find(Te=>Te.transform3d.id===d.id),{rotate3d:V,scale3d:pe,translate3d:ge}=T.transform3d;f.transform=`translate3d(${ge.x}px, ${ge.y}px, ${ge.z}px) scale3d(${pe.x}, ${pe.y}, 1) ${ne(V.axis,V.deg)}`}return f},fe=()=>{e.parentCom?e.editable&&!e.com.selected&&(e.com.hovered=!0):e.com.selected||(e.com.hovered=!0)},ve=()=>{e.com.hovered=!1},y=d=>{const c=Je(d);(c||!e.com.selected)&&s.select(e.com.id,e.com.parentId,c)},k=d=>{if(e.parentCom&&!e.editable){const c=I(),f=c.editables.lastIndexOf(!1);a(d,c.coms[f])}else a(d,e.com)},b=d=>{if(e.parentCom&&!e.editable){const c=I(),f=c.editables.lastIndexOf(!1);c.instances[f].proxy.onMove(d)}else F(d)},F=d=>{if(o.contextMenu.show)return r(),!1;if(!e.com.selected)return tt(d.target,"mouseup",y),!1;s.selectedComs.forEach(c=>{Yt(d,c,h.value,o.pageConfig.grid,()=>{e.com.id===c.id&&(u.value=!0,o.calcAlignLine(e.com))},()=>{if(e.com.id===c.id)if(u.value){u.value=!1,o.hideAlignLine(e.com.id);const f=I();f.coms.length>0&&s.resizeParents(f.coms)}else d.button===0&&s.select(e.com.id,e.com.parentId)})})},O=(d,c)=>{if(r(),!e.com.selected)return!1;const f=(l,S)=>{l.scaling.w=l.attr.w,l.scaling.h=l.attr.h,Xt(d,c,l,h.value,S,()=>{l.scaling.zoom=!0,l.scaling.sx=l.scaling.w/l.attr.w,l.scaling.sy=l.scaling.h/l.attr.h},()=>{i.value&&s.resizeChildren(l),l.scaling.zoom=!1,l.scaling.sx=1,l.scaling.sy=1,l.attr.w=l.scaling.w,l.attr.h=l.scaling.h;const T=I();T.coms.length>0&&s.resizeParents(T.coms)})};s.selectedComs.length>1?s.selectedComs.forEach(l=>{f(l,!0)}):f(e.com,o.isNormalResizeMode)},E=d=>{r(),s.selectedComs.forEach(c=>{Bt(d,n.vnode.el,c,f=>{i.value&&Re(c,f)})})},I=()=>{const d=[],c=[],f=[],l=S=>{var V;const T=S.props.parentCom;T&&(d.push(T),c.push((V=S.props.editable)!=null?V:!1),f.push(S.parent),l(S.parent))};return l(n),{coms:d,editables:c,instances:f}},G=d=>{e.parentCom&&!e.editable&&(e.parentCom.selected?y(d):I().instances[0].proxy.selectCom(d))},A=d=>M("div",{key:d.id,class:"slider-item",style:he(d)},{default:()=>t.slots.default({data:d,editable:te.value.selected})}),W=()=>M("div",{class:"datav-com",style:ce.value},{default:()=>[t.slots.default(),M("div",{class:"datav-wrapper-event-disable",style:de.value})]}),me=(d,c)=>{const f=M("span",{class:"control-point",style:c.style,onMousedown:N(l=>{O(l,d)},["stop"])});return c.rotateStyle?M("i",{class:`${c.name}-handler`,"data-html2canvas-ignore":!0},M("span",{class:"rotate-handler",style:c.rotateStyle,onMousedown:N(l=>{E(l)},["stop"])},f)):M("i",{class:`${c.name}-handler`,"data-html2canvas-ignore":!0},f)},se=()=>M("div",{class:{"transform-handler":!0,hided:!e.com.selected||e.com.locked},style:B.value},{default:()=>{let d=[];i.value?d=e.com.children.map(c=>A(c)):d.push(W());for(const[c,f]of Object.entries(ue.value))d.push(me(c,f));return d.push(M("div",{class:"transform-bg"})),d}});return{scale:h,referLine:v,referLinePos:m,transformClass:g,transformStyle:C,scaleClass:p,scaleStyle:x,createTransform:se,createSlider:()=>M("div",{class:"datav-layer slider",style:H.value},se()),onEnter:fe,onLeave:ve,onDown:b,onMove:F,selectCom:y,showContextMenu:k,selectInnerItem:G}},render(){const{scale:e,referLine:t,referLinePos:n}=this;return M("div",{class:this.transformClass,style:this.transformStyle},{default:()=>[t.enable&&this.$props.com.selected?M(Ht,{scale:e,pos:n}):null,M("div",{class:this.scaleClass,style:this.scaleStyle,onMouseenter:N(this.onEnter,["stop"]),onMouseleave:N(this.onLeave,["stop"]),onMousedown:N(this.onDown,["stop"]),onContextmenu:N(this.showContextMenu,["stop"]),onDblclick:N(this.selectInnerItem,["stop"]),onClick:N(()=>{},["stop"])},this.$props.com.type===P.layer?this.createSlider():this.createTransform())]})}});var _e=Z(At,[["__scopeId","data-v-9e8be2b0"]]);const Ot=J({name:"DatavTransform",props:{com:{type:Object,required:!0}},setup(){const e=(t,n,o)=>t.type===P.com?M(_e,{com:t,parentCom:n,editable:o},{default:()=>M(j(t.name),{com:t,style:{transform:"translateZ(0)",opacity:t.attr.opacity}})}):M(_e,{com:t,parentCom:n,editable:o},{default:({data:s,editable:a})=>e(s,t,a)});return{create:e}},render(){return this.create(this.$props.com)}});const Gt=J({name:"CanvasMain",components:{AlignLine:pt,Ruler:Ct,CanvasArea:St,DatavTransform:Ot},setup(){const e=Ue(),t=ze(),n=le(),o=Ke(),{hideMenu:s}=ke(),{pageConfig:a,canvas:r}=be(n),{coms:u}=be(t),i=z(!1),h=z(0),v=z(0),m=z(0),g=z(0),C=z(0),p=z(0),x=60,H=60,B=w(()=>({width:`${r.value.width}px`,height:`${r.value.height}px`})),ce=w(()=>({width:`${a.value.width}px`,height:`${a.value.height}px`,transform:`scale(${r.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${a.value.bgimage})`,backgroundColor:a.value.bgcolor})),de=async y=>{y.preventDefault();try{const k=y.dataTransfer.getData("text");if(k){e.addLoading();let b=await et(k);const{scale:F}=r.value,{left:O,top:E}=e.getPanelOffset,I=(y.clientX-O)/F,G=(y.clientY-E)/F;b.attr.x=Math.round(I-b.attr.w/2),b.attr.y=Math.round(G-b.attr.h/2),await t.add(b),t.select(b.id),e.removeLoading(),b.apis.source&&(await b.loadData(),Ge(()=>{var A;(A=o.events[b.id])==null||A.requestData()}))}}catch(k){Qe("dropToAddCom",k.message)}},D=y=>{y.preventDefault(),y.stopPropagation(),y.dataTransfer.dropEffect="copy"},ue=y=>{const k=y.target;["canvas-panel","screen-shot","canvas-panel-wrap"].includes(k.className)?i.value=!0:i.value=!1},te=()=>{i.value&&(i.value=!1,t.select(""))},ne=()=>{C.value=0,p.value=0},he=()=>u.value.filter(y=>y.locked||y.hided||!y.hovered?(y.selected=!1,!1):(y.selected=!0,!0)),fe=()=>{const{scale:y}=r.value,k=(m.value-x)/y,b=(g.value-H)/y,F=C.value/y,O=p.value/y;u.value.forEach(E=>{if(E.locked||E.hided)return;const{x:I,y:G,w:A,h:W}=E.attr,me={x:k,y:b,w:F,h:O},se={x:I,y:G,w:A,h:W};E.hovered=Pe(me,se)})},ve=y=>{if(i.value=!0,n.contextMenu.show)return i.value=!1,s(),!1;const k=document.getElementById("screen-wp");h.value=k.clientWidth,v.value=k.clientHeight;const b=k.getBoundingClientRect(),F=b.x,O=b.y,E=y.clientX,I=y.clientY;m.value=E-F,g.value=I-O;const G=W=>{W.clientX<E&&(m.value=W.clientX-F),W.clientY<I&&(g.value=W.clientY-O),C.value=Math.abs(W.clientX-E),p.value=Math.abs(W.clientY-I),fe(),i.value=!1},A=()=>{_(document,"mousemove",G),_(document,"mouseup",A),ne(),he(),i.value&&ue(y)};L(document,"mousemove",G),L(document,"mouseup",A)};return He(()=>n.canvas.scale,()=>{ne(),s()}),{ComType:P,coms:u,canvasPanelStyle:ce,screenShotStyle:B,selectionW:h,selectionH:v,areaStartX:m,areaStartY:g,areaWidth:C,areaHeight:p,dragOver:D,dropToAddCom:de,handleMouseDown:ve,cancelSelected:te}}}),Vt=e=>(Ve("data-v-3beab75c"),e=e(),Ne(),e),Nt={class:"canvas-main"},jt=Vt(()=>$("div",{class:"thumbnail"},null,-1));function qt(e,t,n,o,s,a){const r=j("datav-transform"),u=j("align-line"),i=j("ruler"),h=j("canvas-area");return Y(),q("div",Nt,[$("div",{id:"canvas-wp",class:"canvas-panel-wrap",onClick:t[3]||(t[3]=(...v)=>e.cancelSelected&&e.cancelSelected(...v))},[$("div",{id:"screen-wp",class:"screen-shot",style:R(e.screenShotStyle),onMousedown:t[2]||(t[2]=(...v)=>e.handleMouseDown&&e.handleMouseDown(...v))},[$("div",{id:"canvas-coms",class:"canvas-panel",style:R(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...v)=>e.dragOver&&e.dragOver(...v)),onDrop:t[1]||(t[1]=(...v)=>e.dropToAddCom&&e.dropToAddCom(...v))},[(Y(!0),q(Ae,null,Oe(e.coms,v=>(Y(),ae(r,{key:v.id,com:v},null,8,["com"]))),128))],36),ie(u),ie(i)],36),e.areaWidth>0||e.areaHeight>0?(Y(),ae(h,{key:0,"start-x":e.areaStartX,"start-y":e.areaStartY,width:e.areaWidth,height:e.areaHeight,style:R({width:`${e.selectionW}px`,height:`${e.selectionH}px`})},null,8,["start-x","start-y","width","height","style"])):Se("",!0)]),jt])}var sn=Z(Gt,[["render",qt],["__scopeId","data-v-3beab75c"]]);export{sn as default};
