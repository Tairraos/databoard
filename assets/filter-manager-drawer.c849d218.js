import{a as $,B as j,C as K,v as P,a6 as A}from"./App.404b9962.js";import{I as z}from"./warning.078b14f6.js";import{I as L}from"./document.8fdddbc1.js";import{F as O,f as U}from"./filter-collapse-item.ed2309f0.js";import{a4 as W,bb as q,bl as x,a9 as I,aD as N,al as M,bp as G,a5 as u,a6 as F,a7 as D,b1 as p,bf as H,aV as _,ad as w,ah as S,aa as V,af as J,ae as Q,b8 as T}from"./vendor.891943b7.js";import"./arrow-left.14d78497.js";import"./edit.4ec2cf6b.js";import"./delete.d67e866a.js";import"./release.7f243710.js";import"./drag.9793705e.js";import"./config.3c16c364.js";const R=W({name:"FilterManagerDrawer",components:{IconDocument:L,FilterCollapseItem:O},setup(){const a=q(),c=x(),h=j(),d=K(),r=P(),b=I(!1),i=I(null);N(()=>h.filter.show,e=>{b.value=e}),N(b,e=>{e||(h.filter.show=!1)});const v=M(()=>d.dataFilters),m=M(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(t=>{for(const n in t.apiData)t.apiData[n].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(t.id),e[s.id].names.push(t.alias)):e[s.id]={ids:[t.id],names:[t.alias]}})}),e}),E=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})};return G(U,{usedFilters:m,editFilterName:(e,o)=>{const t=e.trim();t&&o.name!==t&&(o.name=t,o.id>0&&d.updateName(o))},removeFilter:e=>{if(e>0){const o=c.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>H(z),onPositiveClick:async()=>{o.loading=!0;try{await d.delete(e);const t=m.value[e];t&&[...r.coms,...r.subComs].filter(n=>t.ids.includes(n.id)).forEach(n=>{for(const f in n.apiData){const s=f,l=n.apiData[s],g=l.pageFilters.find(C=>C.id===e);l.pageFilters=l.pageFilters.filter(C=>C.id!==e),g&&g.enabled&&A(n.id,s,n.apis[s],l)}})}catch(t){a.error(t.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await d.update(e);const o=m.value[e.id];o&&[...r.coms,...r.subComs].filter(t=>o.ids.includes(t.id)).forEach(t=>{for(const n in t.apiData){const f=n,s=t.apiData[f],l=s.pageFilters.find(g=>g.id===e.id);l&&l.enabled&&A(t.id,f,t.apis[f],s)}})}else await d.create(e),i.value=null}}),{visible:b,dataFilters:v,newDataFilter:i,addFilter:E}}}),X={class:"filter-manager-title"},Y=T(" \u6570\u636E\u8FC7\u6EE4\u5668"),Z=w("span",null,"\u5E2E\u52A9\u6587\u6863",-1),ee={key:1,class:"panel-info"},te=w("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),ae=T(" \u65B0\u5EFA ");function se(a,c,h,d,r,b){const i=u("IconDocument"),v=u("n-icon"),m=u("router-link"),E=u("filter-collapse-item"),k=u("n-button"),y=u("n-drawer-content"),B=u("n-drawer");return F(),D(B,{show:a.visible,"onUpdate:show":c[1]||(c[1]=e=>a.visible=e),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp","show-mask":""},{default:p(()=>[_(y,{closable:""},{header:p(()=>[w("p",X,[Y,w("span",{class:"create-filter",onClick:c[0]||(c[0]=(...e)=>a.addFilter&&a.addFilter(...e))},"\u65B0\u5EFA"),_(m,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[_(v,{size:12},{default:p(()=>[_(i)]),_:1}),Z]),_:1})])]),default:p(()=>[a.newDataFilter?(F(),D(E,{key:0,"data-filter":a.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):S("",!0),(F(!0),V(Q,null,J(a.dataFilters,e=>(F(),D(E,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),a.dataFilters.length===0&&!a.newDataFilter?(F(),V("div",ee,[te,_(k,{focusable:!1,onClick:a.addFilter},{default:p(()=>[ae]),_:1},8,["onClick"])])):S("",!0)]),_:1})]),_:1},8,["show"])}var Fe=$(R,[["render",se]]);export{Fe as default};
