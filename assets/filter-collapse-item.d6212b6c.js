import{a as A}from"./AppRoot.e99935fe.js";import{I as V}from"./arrow-left.2b284f25.js";import{I as z}from"./edit.11c88b80.js";import{I as q}from"./delete.72d54e44.js";import{I as H}from"./release.31c8924b.js";import{a6 as s,aa as r,ad as a,a4 as U,aY as W,bb as M,a9 as f,aA as S,a5 as l,ae as Z,aV as n,aZ as o,ah as y,a7 as m,ag as v,a_ as C,ab as R}from"./vendor.d49f6c0b.js";import{s as P}from"./config.3c16c364.js";const Y={},G={t:"1632575311693",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3931",width:"64",height:"64"},J=a("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3932"},null,-1),Q=a("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3933"},null,-1),X=a("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3934"},null,-1),x=a("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3935"},null,-1),ee=a("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3936"},null,-1),te=a("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3937"},null,-1),ae=[J,Q,X,x,ee,te];function ne(e,i){return s(),r("svg",G,ae)}var oe=A(Y,[["render",ne]]);const se={},ie={t:"1639131683779",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3989",width:"64",height:"64"},le=a("path",{d:"M832.990625 494.253125","p-id":"3990"},null,-1),re=a("path",{d:"M567.659375 510.678125L894.134375 185.6375c15.440625-15.384375 15.525-40.275 0.16875-55.74375-15.384375-15.496875-40.246875-15.525-55.6875-0.16875L512.028125 454.821875 188.309375 129.865625C173.009375 114.48125 148.0625 114.425 132.65 129.78125 117.2375 145.165625 117.209375 170.1125 132.565625 185.553125l323.634375 324.871875L129.865625 835.26875c-15.440625 15.384375-15.525 40.275-0.16875 55.74375 7.678125 7.734375 17.803125 11.615625 27.928125 11.615625 10.040625 0 20.08125-3.825 27.759375-11.475l326.390625-324.928125 326.671875 327.909375C846.153125 901.896875 856.25 905.75 866.346875 905.75c10.06875 0 20.1375-3.853125 27.815625-11.503125 15.384375-15.384375 15.440625-40.275 0.084375-55.715625L567.659375 510.678125 567.659375 510.678125zM567.659375 510.678125","p-id":"3991"},null,-1),de=[le,re];function ce(e,i){return s(),r("svg",ie,de)}var ue=A(se,[["render",ce]]);const ge=Symbol("filterManagerInjectionKey"),pe=Symbol("filterConfigInjectionKey"),fe=U({name:"FilterCollapseItem",components:{IconArrowLeft:V,IconEdit:z,IconRelease:H,IconDelete:q,IconDrag:oe,IconClose:ue},props:{dataFilter:{type:Object,required:!0},draggable:{type:Boolean,default:!0},hasFeedback:{type:Boolean,default:!0},removable:Boolean,publish:Boolean,isNew:Boolean,index:Number,showTime:Boolean},setup(e){const i=W(),{usedFilters:j,editFilterName:L,removeFilter:D,saveFilter:T}=M(ge),{enabledFilters:_,onUsedChange:g,updateIndicator:k}=M(pe,{}),{dataStatus:w}=M(P,{}),b=f(null),h=f(e.isNew),d=f(e.isNew),F=f(e.isNew),c=f(e.isNew),E=f(!1),p=f(e.dataFilter.origin),I=S(()=>{if(!e.hasFeedback)return"";const t=w==null?void 0:w.value.filter;return t&&t.includes(`/${e.dataFilter.id}]`)?t:""}),B=S(()=>{var t;return(t=_==null?void 0:_.value[e.dataFilter.id])!=null?t:!1});return{panelRef:b,code:p,loading:E,editing:h,collapse:d,isOpened:F,isEdited:c,isEnabled:B,usedFilters:j,errMsg:I,switchEnabled:t=>{g(e.dataFilter.id,t)},editName:t=>{h.value=!1,L(t,e.dataFilter)},removeFilter:D,changeCode:t=>{t.value!=e.dataFilter.origin&&(c.value=!0)},updateCode:t=>{p.value=t.value},cancelEdit:()=>{e.isNew?D(0):(p.value=e.dataFilter.origin,c.value?c.value=!1:d.value=!1)},saveData:async()=>{if(!c.value){d.value=!1;return}try{E.value=!0,e.dataFilter.origin=p.value,e.dataFilter.code=`
          if (!data) {  return data; }
          return filter(...arguments);
          function filter(data) {
            ${p.value}
            return data;
          }
        `,await T(e.dataFilter),c.value=!1,i.success("\u6570\u636E\u8FC7\u6EE4\u5668\u5DF2\u4FDD\u5B58")}catch(t){i.error(t.message)}finally{E.value=!1}},toggleEditor:()=>{F.value=!0,d.value=!d.value},dragStart:t=>{const K=t.target.parentNode.parentNode.parentNode.parentElement,N=document.querySelector(".filter-dragging-wp");N.innerHTML="",N.appendChild(K.cloneNode(!0)),t.dataTransfer.setDragImage(N,30,15)},dragEnd:()=>{const t=document.querySelector(".filter-dragging-wp");t.innerHTML="",k(!1,e.index,b.value)},dragEnter:()=>{k(!0,e.index,b.value)},dragOver:t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"}}}}),me={class:"panel-header"},ve={class:"panel-title"},he={class:"filter-title"},_e={class:"filter-name"},we=["title"],be={class:"action-wp --edit"},Fe={class:"filter-count"},Ee=a("div",{class:"filter-dot"},null,-1),ye={key:1,class:"filter-dot"},Ce={key:2,class:"filter-dot --none"},ke={class:"panel-content-wp"},De={class:"cp-wrap"},Ie=a("p",{title:"function filter(data) {",class:"fake-code --start"},[a("span",{class:"--keyword"},"function"),C(" filter(data) { ")],-1),Be=a("p",{class:"fake-code --end"},"}",-1),$e={class:"filter-actions"},Ne={key:0,class:"unsaved"},Me={key:1,class:"saved"};function Ae(e,i,j,L,D,T){const _=l("IconDrag"),g=l("n-icon"),k=l("n-checkbox"),w=l("new-input"),b=l("IconEdit"),h=l("g-tooltip-popover"),d=l("n-tooltip"),F=l("n-config-provider"),c=l("IconRelease"),E=l("IconDelete"),p=l("IconClose"),I=l("IconArrowLeft"),B=l("g-monaco-editor"),$=l("n-button"),O=l("n-collapse-transition");return s(),r("div",{ref:"panelRef",class:R(["collapse-panel-wp filter-item ds-panel-filter",{"--create":e.isNew,"--spread":e.collapse||e.isNew,"--draggable":e.draggable,"--unused":e.hasFeedback&&!e.isEnabled,"--error":!!e.errMsg}]),onDragenter:i[3]||(i[3]=(...u)=>e.dragEnter&&e.dragEnter(...u)),onDragover:i[4]||(i[4]=(...u)=>e.dragOver&&e.dragOver(...u))},[a("div",me,[a("div",ve,[a("div",he,[e.draggable?(s(),r(Z,{key:0},[n(g,{draggable:"true",class:"drag-btn",onDragstart:e.dragStart,onDragend:e.dragEnd},{default:o(()=>[n(_)]),_:1},8,["onDragstart","onDragend"]),n(k,{checked:e.isEnabled,class:"enable-checkbox","onUpdate:checked":e.switchEnabled},null,8,["checked","onUpdate:checked"])],64)):y("",!0),a("div",_e,[e.editing?(s(),m(w,{key:0,"model-value":e.dataFilter.name,autofocus:!0,class:"filter-name-input",onChange:e.editName},null,8,["model-value","onChange"])):(s(),r("div",{key:1,class:"filter-name-text",title:e.dataFilter.name},v(e.dataFilter.name),9,we))]),a("div",be,[n(h,{content:"\u91CD\u547D\u540D"},{default:o(()=>[n(g,{class:"edit-btn",onClick:i[0]||(i[0]=u=>e.editing=!0)},{default:o(()=>[n(b)]),_:1})]),_:1})]),a("div",Fe,[!e.isNew&&e.usedFilters[e.dataFilter.id]?(s(),m(F,{key:0,"theme-overrides":{Tooltip:{arrowHeight:"8px",borderRadius:"2px",padding:"6px",color:"var(--datav-font-color)",textColor:"#000102"}},abstract:""},{default:o(()=>[n(d,{placement:"top",delay:500,style:{maxWidth:"240px"}},{trigger:o(()=>[a("span",null,v(e.usedFilters[e.dataFilter.id].names.length)+" \u4E2A\u7EC4\u4EF6\u6B63\u5728\u8C03\u7528",1)]),default:o(()=>[C(" "+v(e.usedFilters[e.dataFilter.id].names.join(", ")),1)]),_:1})]),_:1},8,["theme-overrides"])):y("",!0)]),a("div",{class:R(["action-wp",{"--flex":e.publish}])},[e.publish?(s(),m(h,{key:0,content:"\u521B\u5EFA\u4EE3\u7801\u7247\u6BB5"},{default:o(()=>[n(g,{class:"save-btn"},{default:o(()=>[n(c)]),_:1})]),_:1})):y("",!0),n(h,{content:"\u5220\u9664"},{default:o(()=>[n(g,{class:"del-btn",onClick:i[1]||(i[1]=u=>e.removeFilter(e.dataFilter.id))},{default:o(()=>[e.removable?(s(),m(E,{key:0})):(s(),m(p,{key:1}))]),_:1})]),_:1})],2),e.hasFeedback?(s(),r(Z,{key:1},[e.errMsg?(s(),m(F,{key:0,"theme-overrides":{Tooltip:{color:"var(--datav-error-color)"}},abstract:""},{default:o(()=>[n(d,{placement:"left",style:{maxWidth:"300px"}},{trigger:o(()=>[Ee]),default:o(()=>[C(" "+v(e.errMsg),1)]),_:1})]),_:1},8,["theme-overrides"])):(s(),r("div",ye))],64)):(s(),r("div",Ce))])]),a("div",{class:"toggle-btn",onClick:i[2]||(i[2]=(...u)=>e.toggleEditor&&e.toggleEditor(...u))},[n(g,{class:"toggle-icon"},{default:o(()=>[n(I)]),_:1})])]),e.isOpened?(s(),m(O,{key:0,show:e.collapse},{default:o(()=>[a("div",ke,[a("div",De,[Ie,n(B,{language:"javascript",code:e.code,height:180,"editor-class":"filter-editor",onChange:e.changeCode,onBlur:e.updateCode},null,8,["code","onChange","onBlur"]),Be,a("div",$e,[e.isEdited?(s(),r("div",Ne,"\u672A\u4FDD\u5B58")):e.showTime?(s(),r("div",Me,"\u4E0A\u6B21\u4FDD\u5B58: "+v(e.dataFilter.updateAt),1)):y("",!0),n($,{size:"tiny",focusable:!1,class:"bolder-btn",onClick:e.cancelEdit},{default:o(()=>[C(v(e.dataFilter.id===0?"\u53D6\u6D88":e.isEdited?"\u64A4\u9500":"\u53D6\u6D88"),1)]),_:1},8,["onClick"]),n($,{type:"primary",size:"tiny",loading:e.loading,focusable:!1,class:"bolder-btn",onClick:e.saveData},{default:o(()=>[C(v(e.dataFilter.id===0||e.isEdited?"\u4FDD\u5B58":"\u5B8C\u6210"),1)]),_:1},8,["loading","onClick"])])])])]),_:1},8,["show"])):y("",!0)],34)}var Ye=A(fe,[["render",Ae]]);export{Ye as F,pe as a,ge as f};
