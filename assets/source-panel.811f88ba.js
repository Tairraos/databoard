import{r as F,o as i,f as p,h as e,e as j,c1 as f,x as m,L as N,q as B,t as y,as as M,at as K,O as J,p as z,b6 as O,_ as V,b9 as Q,c2 as W,I as L,c3 as X,aE as P,aI as Y,c4 as G,c5 as st,bV as Z,aq as n,s as T,w as c,j as a,K as S,c6 as H,aF as at,bT as ot}from"./App.c8de2d3d.js";import{I as nt}from"./arrow-right.d715366d.js";import{I as it}from"./search.ec21aede.js";import{c as x,b as tt,s as ut,a as lt}from"./config.3c16c364.js";const ct={},dt={t:"1639131563580",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4137",width:"64",height:"64"},rt=e("path",{d:"M250.52 209.31999969A398.44000031 398.44000031 0 0 1 512 111.99999969c220.92 0 400.00000031 179.08000031 400.00000031 400.00000031 0 85.44-26.80000031 164.64-72.40000031 229.60000031L711.99999969 512h120A319.99999969 319.99999969 0 0 0 290.40000031 281.12l-39.88000031-71.80000031z m522.96 605.36000062A398.44000031 398.44000031 0 0 1 512 912.00000031C291.08 912.00000031 111.99999969 732.92 111.99999969 512c0-85.44 26.80000031-164.64 72.40000031-229.60000031L312.00000031 512H192.00000031a319.99999969 319.99999969 0 0 0 541.59999938 230.88l39.88000031 71.80000031z","p-id":"4138"},null,-1),pt=[rt];function _t(t,o){return i(),p("svg",dt,pt)}const et=F(ct,[["render",_t]]),ft=j({name:"DisplayApiStatus",props:{status:{type:String,default:f.incomplete},loadingText:{type:String,default:"\u5339\u914D\u4E2D"},successText:{type:String,default:"\u5339\u914D\u6210\u529F"},failedText:{type:String,default:"\u672A\u627E\u5230\u5B57\u6BB5"},completedText:{type:String,default:"\u914D\u7F6E\u5B8C\u6210"},incompleteText:{type:String,default:"\u914D\u7F6E\u672A\u5B8C\u6210"},optional:{type:Boolean,default:!1}},setup(t){const o=m(()=>t.status===f.loading?t.loadingText:t.status===f.success?t.successText:t.status===f.completed?t.completedText:t.optional?"\u53EF\u9009":t.status===f.failed?t.failedText:t.status===f.incomplete?t.incompleteText:t.status);return{apiStatus:f,statusText:o}}});const q=t=>(M("data-v-21b2d9d9"),t=t(),K(),t),mt=q(()=>e("i",{class:"status-icon validating"},null,-1)),ht=q(()=>e("i",{class:"status-icon validating"},null,-1)),vt=q(()=>e("i",{class:"status-icon validating"},null,-1)),gt={key:2,class:"status-icon --success"},Et={class:"status-text"};function yt(t,o,g,D,E,w){return i(),p("div",null,[t.status===t.apiStatus.loading?(i(),p(N,{key:0},[mt,ht,vt],64)):t.status===t.apiStatus.success||t.status===t.apiStatus.completed?(i(),p("i",{key:1,class:B(["status-icon",`--${t.status}`])},null,2)):t.optional?(i(),p("i",gt)):(i(),p("i",{key:3,class:B(["status-icon",`--${t.status}`])},null,2)),e("span",Et,y(t.statusText),1)])}const Dt=F(ft,[["render",yt],["__scopeId","data-v-21b2d9d9"]]),wt=j({name:"FieldGrid",props:{fields:{type:Object}}});const R=t=>(M("data-v-ef3f186e"),t=t(),K(),t),Ct={key:0,class:"field-wp"},bt=R(()=>e("div",{class:"field-info"},"\u6570\u636E\u76F8\u5E94\u7ED3\u679C\u5E94\u4E3A\u5217\u8868\uFF0C\u5217\u8868\u5143\u7D20\u5305\u542B\u5982\u4E0B\u5B57\u6BB5",-1)),$t={class:"field-grid"},St=R(()=>e("div",{class:"field-item field-title"},"\u5B57\u6BB5",-1)),Bt=R(()=>e("div",{class:"field-item field-title"},"\u6620\u5C04",-1)),kt=R(()=>e("div",{class:"field-item field-title"},"\u8BF4\u660E",-1)),At={class:"field-item"},It={class:"field-item"},Ft={class:"field-item"};function Tt(t,o,g,D,E,w){return t.fields?(i(),p("div",Ct,[bt,e("div",$t,[St,Bt,kt,(i(!0),p(N,null,J(t.fields,(l,u)=>(i(),p(N,{key:u},[e("div",At,y(u),1),e("div",It,y(l.map||"-"),1),e("div",Ft,y(l.description||"-"),1)],64))),128))])])):z("",!0)}const Nt=F(wt,[["render",Tt],["__scopeId","data-v-ef3f186e"]]),Pt=j({name:"SourceDrawer",components:{IconSearch:it,IconRefresh:et,FieldGrid:Nt,FilterPanel:O(()=>V(()=>import("./filter-panel.7eeb447c.js"),["assets/filter-panel.7eeb447c.js","assets/App.c8de2d3d.js","assets/App.4717e360.css","assets/plus.a9d8f7d9.js","assets/filter-collapse-item.2b54b176.js","assets/arrow-left.9afce2be.js","assets/edit.4ad17d44.js","assets/delete.bcfacf57.js","assets/release.077b5d20.js","assets/drag.9aba45a6.js","assets/config.3c16c364.js","assets/filter-panel.bd36f52c.css"])),DsStaticEditor:O(()=>V(()=>import("./ds-static-editor.15968215.js"),["assets/ds-static-editor.15968215.js","assets/config.3c16c364.js","assets/App.c8de2d3d.js","assets/App.4717e360.css"])),DsApiEditor:O(()=>V(()=>import("./ds-api-editor.7fe06c5d.js"),["assets/ds-api-editor.7fe06c5d.js","assets/App.c8de2d3d.js","assets/App.4717e360.css","assets/config.3c16c364.js","assets/ds-api-editor.32f56fac.css"]))},setup(){const t=Q(),o=W(),g=L(!1),D=L(!1),E=G,w=Object.entries(X()).map(([s,r])=>({value:s,label:r})),l=()=>{g.value=!0},u=P(x),{apiName:d,apiConfig:h,apiDataConfig:_}=P(tt),v=m(()=>{var r;const s=t.dataStatusMap[u.value.id];return s?(r=s[d])!=null?r:{}:{}}),C=m(()=>{const s=t.originMap[u.value.id];return s?s[d]:""}),A=s=>{switch(s){case G.api:st(_.value.config);break}},I=m(()=>{const s=o.dataMap[u.value.id];return s?s[d]:""}),b=async()=>{await Z(u.value.id,d,h.value,_.value)};return Y(ut,{dataStatus:v,refreshData:b}),{visible:g,visiblePreview:D,apiType:E,datasources:w,apiConfig:h,apiDataConfig:_,dataStatus:v,dataOrign:C,resData:I,open:l,changeSource:A,refreshData:b}}});const jt=e("p",{class:"source-drawer-title"},"\u8BBE\u7F6E\u6570\u636E\u6E90",-1),Rt={class:"datasource-selector"},Ut=e("label",{class:"datasource-selector-title"},"\u6570\u636E\u6E90\u7C7B\u578B",-1),Ot={class:"datasource-select"},Vt={class:"datav-new-select-wp"},Lt={class:"ds-response-btn"},Mt={class:"ds-preview-content"},Kt=e("span",{class:"use-filter-text"},"\u6570\u636E\u8FC7\u6EE4\u5668",-1),zt=e("span",{class:"tutorial-popup"},"\u6559\u7A0B",-1),qt=e("span",null,"\u6570\u636E\u54CD\u5E94\u7ED3\u679C",-1),Gt={class:"data-response"};function Ht(t,o,g,D,E,w){const l=n("n-select"),u=n("ds-static-editor"),d=n("ds-api-editor"),h=n("IconSearch"),_=n("n-icon"),v=n("g-monaco-editor"),C=n("n-popover"),A=n("n-checkbox"),I=n("filter-panel"),b=n("field-grid"),s=n("IconRefresh"),r=n("n-drawer-content"),U=n("n-drawer");return i(),T(U,{show:t.visible,"onUpdate:show":o[3]||(o[3]=$=>t.visible=$),width:"500px","trap-focus":!1,class:"source-drawer",to:"#edit-main-wp","show-mask":""},{default:c(()=>[a(r,{closable:""},{header:c(()=>[jt]),default:c(()=>[e("div",{class:B(["step-title",{"--error":!!t.dataStatus.api}])}," \u6570\u636E\u6E90 ",2),e("div",Rt,[Ut,e("div",Ot,[e("div",Vt,[a(l,{value:t.apiDataConfig.type,"onUpdate:value":[o[0]||(o[0]=$=>t.apiDataConfig.type=$),t.changeSource],options:t.datasources,filterable:"",class:"datav-new-select"},null,8,["value","options","onUpdate:value"])])])]),t.apiDataConfig.type===t.apiType.static?(i(),T(u,{key:0})):t.apiDataConfig.type===t.apiType.api?(i(),T(d,{key:1})):z("",!0),a(C,{show:t.visiblePreview,"onUpdate:show":o[1]||(o[1]=$=>t.visiblePreview=$),placement:"left",width:400,class:"editor-popover",style:{"--n-color":"#0000"}},{trigger:c(()=>[e("div",Lt,[a(_,{class:"refresh-btn"},{default:c(()=>[a(h)]),_:1}),S(" \u9884\u89C8\u6570\u636E\u6E90\u8FD4\u56DE\u7ED3\u679C ")])]),default:c(()=>[e("div",Mt,[a(v,{language:"json","read-only":!0,"auto-format":!0,height:180,code:t.dataOrign},null,8,["code"])])]),_:1},8,["show"]),e("div",{class:B(["step-title",{"--error":!!t.dataStatus.filter}])},[a(A,{checked:t.apiDataConfig.config.useFilter,"onUpdate:checked":o[2]||(o[2]=$=>t.apiDataConfig.config.useFilter=$),class:"use-filter-btn"},null,8,["checked"]),Kt,zt],2),a(I),a(b,{fields:t.apiConfig.fields},null,8,["fields"]),e("div",{class:B(["step-title",{"--error":!!t.dataStatus.api||!!t.dataStatus.filter}])},[qt,a(_,{class:"refresh-btn",onClick:t.refreshData},{default:c(()=>[a(s)]),_:1},8,["onClick"])],2),e("div",Gt,[a(v,{language:"json","read-only":!0,"auto-format":!0,code:t.resData},null,8,["code"])])]),_:1})]),_:1},8,["show"])}const Jt=F(Pt,[["render",Ht]]),Qt=j({name:"SourcePanel",components:{DisplayApiStatus:Dt,SourceDrawer:Jt,IconArrowRight:nt,IconRefresh:et},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(t){const o=Q(),g=W(),D=m(()=>t.apiName===t.activeName),E=L(null),w=X(),l=P(x),u=m(()=>l.value.apis[t.apiName]),d=m(()=>l.value.apiData[t.apiName]);Y(tt,{apiName:t.apiName,apiConfig:u,apiDataConfig:d});const h=m(()=>{const s=g.dataMap[l.value.id];return s?s[t.apiName]:""}),_=m(()=>{var r;const s=o.fieldStatusMap[l.value.id];return(r=s==null?void 0:s[t.apiName])!=null?r:{}}),v=m(()=>{const s=Object.values(_.value);return s.includes(H.loading)?f.loading:s.includes(H.failed)?f.incomplete:f.completed}),C=P(lt);return{visible:D,sourceDrawerRef:E,datasources:w,com:l,apiConfig:u,apiDataConfig:d,fieldsStatus:_,totalStatus:v,datav_data:h,toggle:()=>{t.collapse&&C(t.apiName)},openSourceDrawer:()=>{var s;(s=E.value)==null||s.open()},refreshData:()=>{Z(l.value.id,t.apiName,u.value,d.value)}}}});const k=t=>(M("data-v-08214c58"),t=t(),K(),t),Wt={class:"api-editor-title"},Xt={class:"api-status success"},Yt={class:"attr-source-wp"},Zt={class:"data-attr-table-container"},xt={class:"data-attr-table"},te=k(()=>e("thead",{class:"table-head"},[e("tr",{class:"table-head-row"},[e("th",{class:"th-item column-item attr-name"}," \u5B57\u6BB5 "),e("th",{class:"th-item column-item attr-value"}," \u6620\u5C04 "),e("th",{class:"th-item column-item attr-status"}," \u72B6\u6001 ")])],-1)),ee={class:"table-body"},se={class:"column-item attr-name"},ae={class:"ellipsis2"},oe={class:"column-item attr-value"},ne={class:"column-item attr-status"},ie={key:1,class:"table-body-row"},ue=k(()=>e("td",{class:"column-item attr-name"},[e("span",null,"\u4EFB\u610F")],-1)),le=k(()=>e("td",{class:"column-item attr-value"},null,-1)),ce={class:"column-item attr-status"},de={class:"data-source"},re=k(()=>e("div",{class:"data-result-title"}," \u6570\u636E\u54CD\u5E94\u7ED3\u679C ",-1)),pe={class:"auto-update-config"},_e={class:"data-flow-wp"},fe={class:"ds-line"},me={class:"ds-title"},he={class:"ds-type-text"},ve={class:"ds-line mt5"},ge=k(()=>e("span",null,"\u6570\u636E\u54CD\u5E94\u7ED3\u679C ( \u53EA\u8BFB ) ",-1)),Ee={class:"ds-dots"},ye=k(()=>e("span",{class:"ds-dot"},null,-1)),De=k(()=>e("span",{class:"ds-dot"},null,-1)),we={class:"data-response"};function Ce(t,o,g,D,E,w){const l=n("IconArrowRight"),u=n("n-icon"),d=n("display-api-status"),h=n("n-tooltip"),_=n("new-input"),v=n("n-checkbox"),C=n("n-button"),A=n("IconRefresh"),I=n("g-monaco-editor"),b=n("source-drawer");return i(),p("div",{class:B(["api-editor",{"--disable-fold":!t.collapse,"--fold":t.collapse&&t.visible}])},[e("div",Wt,[e("div",{class:"api-desc ellipsis2",onClick:o[0]||(o[0]=(...s)=>t.toggle&&t.toggle(...s))},[t.collapse?(i(),T(u,{key:0,class:"api-fold-icon"},{default:c(()=>[a(l)]),_:1})):z("",!0),S(" "+y(t.apiConfig.description||"\u6570\u636E\u63A5\u53E3"),1)]),e("div",Xt,[a(d,{status:t.totalStatus,"success-text":"\u914D\u7F6E\u5B8C\u6210"},null,8,["status"])])]),at(e("div",Yt,[e("div",Zt,[e("table",xt,[te,e("tbody",ee,[Object.keys(t.apiConfig.fields).length>0?(i(!0),p(N,{key:0},J(t.apiConfig.fields,(s,r)=>(i(),p("tr",{key:r,class:"table-body-row"},[e("td",se,[a(h,{placement:"left"},{trigger:c(()=>[e("span",ae,y(r),1)]),default:c(()=>[S(" "+y(s.description),1)]),_:2},1024)]),e("td",oe,[a(_,{"model-value":s.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:U=>s.map=U},null,8,["model-value","onChange"])]),e("td",ne,[a(d,{status:t.fieldsStatus[r],optional:s.optional},null,8,["status","optional"])])]))),128)):(i(),p("tr",ie,[ue,le,e("td",ce,[a(d,{status:"completed"})])]))])])]),e("div",de,[re,e("div",pe,[a(v,{checked:t.apiConfig.useAutoUpdate,"onUpdate:checked":o[1]||(o[1]=s=>t.apiConfig.useAutoUpdate=s),class:"auto-update-checkbox"},{default:c(()=>[S(" \u81EA\u52A8\u66F4\u65B0\u9009\u9879 ")]),_:1},8,["checked"]),a(_,{"model-value":t.apiConfig.autoUpdate,type:"number",disabled:!t.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:o[2]||(o[2]=s=>t.apiConfig.autoUpdate=s)},null,8,["model-value","disabled"]),S(" \u79D2\u4E00\u6B21 ")]),e("div",_e,[e("div",fe,[e("div",me,[e("span",he,y(t.datasources[t.apiDataConfig.type]),1)]),a(C,{size:"tiny",class:"ds-action-btn",onClick:t.openSourceDrawer},{default:c(()=>[S(" \u914D\u7F6E\u6570\u636E\u6E90 ")]),_:1},8,["onClick"])]),e("div",ve,[ge,a(h,{placement:"left"},{trigger:c(()=>[a(u,{class:"refresh-btn",onClick:t.refreshData},{default:c(()=>[a(A)]),_:1},8,["onClick"])]),default:c(()=>[S(" \u5237\u65B0\u6570\u636E ")]),_:1})]),e("div",Ee,[e("span",{class:B(["ds-dot",[t.totalStatus==="completed"?"active":"error"]])},null,2),ye,De])]),e("div",we,[a(I,{language:"json","read-only":!0,"auto-format":!0,code:t.datav_data,height:250,"full-screen-title":"\u6570\u636E\u54CD\u5E94\u7ED3\u679C"},null,8,["code"])])])],512),[[ot,t.visible]]),a(b,{ref:"sourceDrawerRef"},null,512)],2)}const ke=F(Qt,[["render",Ce],["__scopeId","data-v-08214c58"]]);export{ke as default};
